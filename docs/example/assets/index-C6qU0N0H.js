var ae=Object.defineProperty;var le=(h,t,e)=>t in h?ae(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var n=(h,t,e)=>le(h,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class f extends EventTarget{constructor(t=0,e=0){super(),this.x=t,this.y=e}}class g extends f{constructor(t=0,e=0,i=0,s=0){super(t,e),this.width=i,this.height=s}}class $ extends g{get children(){return this._children}constructor(){super(),this._children=new Array}add(...t){t.forEach(e=>{this._children.push(e),this.initializeChild(e)})}insert(t,...e){return t<0||t>=this._children.length||this._children.length<1?!1:(e.forEach(i=>{this._children.splice(t,0,i),this.initializeChild(i)}),!0)}remove(...t){t.forEach(e=>{const i=this._children.indexOf(e);i<0||i>=this._children.length||(this._children.splice(i,1),this.destroyChild(e))})}destroy(){this._children.forEach(t=>this.destroyChild(t))}}class ue extends Event{get style(){return this._style}constructor(t,e,i){super(e,i),this._style=t}}const R=class b extends ${constructor(){super(),this.invalidate=this.invalidate.bind(this),this.refresh=this.refresh.bind(this),this.cursorChanged=this.cursorChanged.bind(this)}invalidate(){this.dispatchEvent(new Event(b.invalidateEvent))}refresh(){this.dispatchEvent(new Event(b.refreshEvent))}changeCursor(t){this.dispatchEvent(new ue(t,b.changeCursorEvent))}initializeChild(t){t.addEventListener(b.invalidateEvent,this.invalidate),t.addEventListener(b.refreshEvent,this.refresh),t.addEventListener(b.changeCursorEvent,this.cursorChanged)}destroyChild(t){t.removeEventListener(b.invalidateEvent,this.invalidate),t.removeEventListener(b.refreshEvent,this.refresh),t.removeEventListener(b.changeCursorEvent,this.cursorChanged),t.destroy()}cursorChanged(t){const e=t;this.changeCursor(e.style)}};R.invalidateEvent="invalidate",R.refreshEvent="refresh",R.changeCursorEvent="changecursor";let ce=R;class j extends ce{get isActive(){return this._isActive}set isActive(t){this._isActive!==t&&(this._isActive=t,this.isActiveChanged(t))}get isVisible(){return this._isVisible}set isVisible(t){this._isVisible!==t&&(this._isVisible&&(this._isEnabledVisible=this._isEnabled),this._isVisible=t,this.isEnabled=t&&this._isEnabledVisible,this.isVisibleChanged(t))}get isEnabled(){return this._isEnabled}set isEnabled(t){this._isEnabled!==t&&(this._isEnabled=t,this.isEnabledChanged(t))}constructor(){super(),this._isActive=!0,this._isVisible=!0,this._isEnabled=!0,this._isEnabledVisible=!0}}class de extends j{constructor(){super(),this._hitBoxOffsetX=0,this._hitBoxOffsetY=0,this._drawHitBox=!1,this._lastHitBox=new g,this.zIndex=0,this.opacity=1,this.scale=1,this.velocity=0,this.rotation=0,this.hitBox=new g,this.direction=new f,this.transformOrigin=new f(.5,.5)}isActiveChanged(t){this.children.forEach(e=>e.isActive=t)}isVisibleChanged(t){this.children.forEach(e=>e.isVisible=t)}isEnabledChanged(t){this.children.forEach(e=>e.isEnabled=t)}}class D extends Error{constructor(t){super(`InvalidOperation: ${t}.`)}}class E extends D{constructor(t){super(`${t} is not initialized`)}}class _ extends de{get assets(){if(!this._assets)throw new E("Entity");return this._assets}get surface(){if(!this._surface)throw new E("Entity");return this._surface}initialize(t,e){this._assets=t,this._surface=e,this.onInitialized()}update(t){if(this.hitBox&&(this._lastHitBox=this.setHitBox(this._hitBoxOffsetX,this._hitBoxOffsetY)),this.onUpdate(t),this.hitBox){const e=this.setHitBox(this._hitBoxOffsetX,this._hitBoxOffsetY);this.hitBox=this._lastHitBox.combine(e)}}collision(...t){this.onCollision(...t)}draw(t){var e;if(!this.isVisible)return;const i=this.x+this.width*this.transformOrigin.x,s=this.y+this.height*this.transformOrigin.y;t.save(),t.globalAlpha=this.opacity,t.translate(i,s),t.scale(this.scale,this.scale),t.rotate(this.rotation*Math.PI/180),t.translate(-i,-s),(e=this._imageSource)!=null&&e.image&&t.drawImage(this._imageSource.image,this.x,this.y,this.width,this.height),this.onDraw(t),t.restore(),this._drawHitBox&&(t.save(),t.strokeStyle="red",t.strokeRect(this.hitBox.x,this.hitBox.y,this.hitBox.width,this.hitBox.height),t.restore())}getCalculatedValue(t,e){if(!this.surface||t.fps<=0)return 0;const i=e/t.fps,s=this.surface.settings.frameRate;return i*s}hitTest(t){return t=this.getLocalPositionBounds(t),this.hitBox.contains(t)}destroy(){super.destroy(),this.onDestroy()}initializeChild(t){super.initializeChild(t),t.initialize(this.assets,this.surface)}setHitBox(t,e){return this._hitBoxOffsetX=t,this._hitBoxOffsetY=e,this.hitBox=new g,this.hitBox.x=this.x+this._hitBoxOffsetX,this.hitBox.y=this.y+this._hitBoxOffsetY,this.hitBox.width=this.width-this._hitBoxOffsetX*2,this.hitBox.height=this.height-this._hitBoxOffsetY*2,this.hitBox}getLocalPositionBounds(t){if(Array.isArray(t)){const o=new Array;return t.forEach(a=>{const l=this.getLocalPositionBounds(a);o.push(l)}),o}const e=this.surface.clientBounds,i=this.surface.width/e.width,s=this.surface.height/e.height,r=new g;return r.x=(t.x-e.x)*i,r.y=(t.y-e.y)*s,r}setAudio(t,e=1,i=!1){return this._audioSource=this.assets.getAudio(t),this._audioSource&&(this._audioSource.loop=i,this._audioSource.volume=this.assets.isAudioMuted?0:e,(!this._audioSource.loop||!this._audioSource.isPlaying)&&this._audioSource.play()),this._audioSource}setImage(t){return this._imageSource=this.assets.getImage(t),this._imageSource}isActiveChanged(t){super.isActiveChanged(t),this.onIsActiveChanged(t)}isVisibleChanged(t){super.isVisibleChanged(t),this.onVisibleChanged(this.isEnabled)}isEnabledChanged(t){super.isEnabledChanged(t),this.onEnabledChanged(t)}onInitialized(){}onIsActiveChanged(t){}onVisibleChanged(t){}onEnabledChanged(t){}onUpdate(t){}onCollision(...t){}onDraw(t){}onDestroy(){}}class S extends _{constructor(){super(),this.isHovered=!1,this.isPointerEntered=!1,this.isPointerPressed=!1,this.isHitTestVisible=!0,this.isTouchHitBoxDisabled=!1,this.receivePointerInput=!1,this.receiveKeyboardInput=!1}pointerEnter(t){t=this.getLocalPositionBounds(t),this.onPointerEnter(t),this.refresh()}pointerLeave(t){t=this.getLocalPositionBounds(t),this.onPointerLeave(t),this.refresh()}pointerMove(t){t=this.getLocalPositionBounds(t),this.onPointerMove(t),this.refresh()}pointerHover(t){t=this.getLocalPositionBounds(t),this.onPointerHover(t),this.refresh()}pointerPressed(t){t=this.getLocalPositionBounds(t),this.onPointerPressed(t),this.refresh()}pointerReleased(t){t=this.getLocalPositionBounds(t),this.onPointerReleased(t),this.refresh()}pointerTapped(t){t=this.getLocalPositionBounds(t),this.onPointerTapped(t),this.refresh()}touchStart(t){t=this.getLocalPositionBounds(t),this.onTouchStart(t),this.refresh()}touchMove(t){t=this.getLocalPositionBounds(t),this.onTouchMove(t),this.refresh()}touchEnd(t){t=this.getLocalPositionBounds(t),this.onTouchEnd(t),this.refresh()}keyDown(t){this.onKeyDown(t),this.refresh()}keyUp(t){this.onKeyUp(t),this.refresh()}onEnabledChanged(t){super.onEnabledChanged(t),this.invalidate(),this.refresh()}onPointerEnter(t){}onPointerLeave(t){}onPointerMove(t){}onPointerHover(t){}onPointerPressed(t){}onPointerReleased(t){}onPointerTapped(t){}onTouchStart(t){}onTouchMove(t){}onTouchEnd(t){}onKeyDown(t){}onKeyUp(t){}}const C=class L extends EventTarget{get frameRate(){return this._frameRate}set frameRate(t){if(this._frameRate===t)return;this._frameRate=t;const e=new Event(L.frameRateChangeEvent);this.dispatchEvent(e)}get frameLimit(){return this._frameLimit}set frameLimit(t){if(this._frameLimit===t)return;this._frameLimit=t;const e=new Event(L.frameLimitChangeEvent);this.dispatchEvent(e)}get targetResolution(){return this._targetResolution}set targetResolution(t){if(this._targetResolution.x===t.x&&this._targetResolution.y===t.y)return;this._targetResolution=t;const e=new Event(L.targetResolutionChangeEvent);this.dispatchEvent(e)}get maxResolution(){return this._maxResolution}set maxResolution(t){var e,i;if(((e=this._maxResolution)==null?void 0:e.x)===(t==null?void 0:t.x)&&((i=this._maxResolution)==null?void 0:i.y)===(t==null?void 0:t.y))return;this._maxResolution=t;const s=new Event(L.maxResolutionChangeEvent);this.dispatchEvent(s)}constructor(t,e,i,s){super(),this._frameRate=t,this._frameLimit=e,this._targetResolution=i,this._maxResolution=s}};C.frameRateChangeEvent="frameratechange",C.frameLimitChangeEvent="framelimitchange",C.targetResolutionChangeEvent="targetresolutionchange",C.maxResolutionChangeEvent="maxresolutionchange";let O=C;const Z=class J extends g{get context2d(){return this._context2d}get settings(){return this._settings}get clientBounds(){return this._clientBounds}constructor(t){super(0,0,t.targetResolution.x,t.targetResolution.y),this._settings=t,this._clientBounds=new g,this._update=()=>this.update()}initialize(t,e){this._window=e,this._context2d=t,this._window.addEventListener("resize",this._update),this._window.addEventListener("orientationchange",this._update),this._settings.addEventListener(O.maxResolutionChangeEvent,this._update),this.update()}update(){const t=this._context2d.canvas,e=t.parentElement.getBoundingClientRect(),i=this._window.devicePixelRatio>2?2:this._window.devicePixelRatio,s=new g(e.x,e.y,e.width,e.height),r=new g(0,0,this.width,this.height),o=s.getScale(r),a=new g(0,0,this.width*o,this.height*o),l=a.getCenter(s);t.style.left=`${l.x}px`,t.style.top=`${l.y}px`,t.style.width=`${a.width}px`,t.style.height=`${a.height}px`,i<=1?(t.width=this.width,t.height=this.height,this._context2d.setTransform(1,0,0,1,0,0)):(t.width=this.width*i,t.height=this.height*i,this._context2d.setTransform(i,0,0,i,0,0));const u=this._settings.maxResolution;u&&u.x>0&&u.y>0&&(t.width=t.width>u.x?u.x:t.width,t.height=t.height>u.y?u.y:t.height);const d=t.getBoundingClientRect();this._clientBounds.x=d.x,this._clientBounds.y=d.y,this._clientBounds.width=d.width,this._clientBounds.height=d.height,this.dispatchEvent(new Event(J.surfaceChangeEvent))}clear(){this._context2d&&this._context2d.clearRect(0,0,this.width,this.height)}destroy(){this._window.removeEventListener("resize",this._update),this._window.removeEventListener("orientationchange",this._update),this._settings.removeEventListener(O.maxResolutionChangeEvent,this._update)}};Z.surfaceChangeEvent="surfacechange";let z=Z;class w extends j{get isLoop(){return this._isLoop}set isLoop(t){this._isLoop!==t&&(this._isLoop=t)}get assets(){if(!this._assets)throw new E("Scene");return this._assets}get surface(){if(!this._surface)throw new E("Scene");return this._surface}get input(){if(!this._input)throw new E("Scene");return this._input}constructor(t){super(),this._isLoop=!0,this._assets=t}initialize(t,e){this._surface&&this._surface.removeEventListener(z.surfaceChangeEvent,this.refresh),this._input=e,this._surface=t,this._surface.addEventListener(z.surfaceChangeEvent,this.refresh),this.onInitialized()}destroy(){super.destroy(),this.surface.removeEventListener(z.surfaceChangeEvent,this.refresh)}update(t){var e;!this.isActive||!this.isVisible||(this.isLoop||(this.isActive=!1),(e=this._surface)==null||e.clear(),this.updateEntities(this.children,t))}refresh(){this.isLoop||(this.isActive=!0)}invalidate(){var t;(t=this._input)==null||t.refresh()}onInitialized(){}initializeChild(t){super.initializeChild(t),t.initialize(this.assets,this.surface)}changeCursor(t){const e=this.input.get("Pointer");e==null||e.setStyle(t)}isActiveChanged(t){this.children.forEach(e=>e.isActive=t)}isVisibleChanged(t){var e;t||(e=this._surface)==null||e.clear()}isEnabledChanged(t){this.children.forEach(e=>e.isEnabled=t)}updateEntities(t,e){const i=new Array,s=this.surface.context2d;this.getGroups(t,i).forEach(r=>r.forEach(o=>{o.update(e),o.collision(...this.getCollisions(o,i)),o.draw(s),this.updateEntities(o.children,e)}))}getGroups(t,e){return t.reduce((i,s)=>(i[s.zIndex]=i[s.zIndex]??[],i[s.zIndex].push(s),s.hitBox&&e.push(s),i),[])}getCollisions(t,e){return e.reduce((i,s)=>(s!==t&&t.hitBox.intersectsWith(s.hitBox)&&i.push(s),i),[])}}class ge{get volume(){return this._gaineNode?this._gaineNode.gain.value:0}set volume(t){this._gaineNode&&(this._volume=t,this._gaineNode.gain.setValueAtTime(this._volume,0))}get loop(){var t;return((t=this._audioNode)==null?void 0:t.loop)??!1}set loop(t){this._audioNode&&(this._audioNode.loop=t)}get isPlaying(){return this._isPlaying}constructor(t,e){this._volume=1,this._startTime=0,this._endTime=0,this._isPlaying=!1,this._isPaused=!1,this._audioBuffer=t,this._audioContext=e,this._ended=i=>this.onEnded(i),this.createAudioNodes()}play(t,e,i){if(!this._audioNode)return;this._isPlaying&&(this._audioNode.stop(),this.createAudioNodes()),this._isPlaying=!0;const s=this._isPaused?this._endTime:void 0,r=e??s;this._audioContext.resume(),this._startTime=Date.now(),this._audioNode.addEventListener("ended",this._ended),this._audioNode.start(t,r,i),this._isPaused=!1}pause(){var t;this._isPaused=!0,(t=this._audioNode)==null||t.stop()}stop(){var t;this._isPaused=!1,(t=this._audioNode)==null||t.stop()}createAudioNodes(){let t=1,e=!1;this._audioNode&&(e=this._audioNode.loop),this._gaineNode&&(t=this._gaineNode.gain.value),this._gaineNode=this._audioContext.createGain(),this._audioNode=this._audioContext.createBufferSource(),this._audioNode.buffer=this._audioBuffer,this._audioNode.connect(this._gaineNode),this._gaineNode.connect(this._audioContext.destination),this.loop=e,this.volume=t}onEnded(t){this._isPlaying=!1,this._endTime=Date.now()-this._startTime,t.target.removeEventListener("ended",this._ended),this.createAudioNodes()}}class _e extends Map{constructor(){super(),this._audioPaths=new Array}add(...t){this._audioPaths.push(...t)}remove(...t){t.forEach(e=>{const i=this._audioPaths.indexOf(e);i<0||i>=this._audioPaths.length||(this._audioPaths.splice(i,1),this.delete(e))})}async loadAsync(){const t=new AudioContext;await Promise.all(this._audioPaths.map(async e=>{await this.loadAudioAsync(e,t)})),await t.resume()}async loadAudioAsync(t,e){let i=!1;const s=new XMLHttpRequest,r=()=>{s.removeEventListener("error",r),s.removeEventListener("load",r);const o=a=>{const l=new ge(a,e);this.set(t.split("/").pop(),l)};e.decodeAudioData(s.response,o),i=!0};for(s.responseType="arraybuffer",s.open("GET",t,!0),s.addEventListener("error",r),s.addEventListener("load",r),s.send();!i;)await this.delay(1)}delay(t){return new Promise(e=>setTimeout(e,t))}}class pe{get name(){return this._name}get image(){return this._image}constructor(t,e){this._name=t,this._image=e}}class fe extends Map{constructor(){super(),this._imagePaths=new Array}add(...t){this._imagePaths.push(...t)}remove(...t){t.forEach(e=>{const i=this._imagePaths.indexOf(e);i<0||i>=this._imagePaths.length||(this._imagePaths.splice(i,1),this.delete(e))})}async loadAsync(){await Promise.all(this._imagePaths.map(async t=>{const e=new Image;e.src=t,await e.decode();const i=t.split("/").pop();this.set(i,new pe(i,e))}))}}class ye{constructor(t,e){this._images=t,this._audios=e,this._audiosLoaded=!1,this._imagesLoaded=!1,this.isAudioMuted=!0}async loadImagesAsync(){this._imagesLoaded||(this._imagesLoaded=!0,await this._images.loadAsync())}async loadAudiosAsync(){this._audiosLoaded||(this._audiosLoaded=!0,await this._audios.loadAsync())}addImage(...t){this._images.add(...t)}addAudio(...t){this._audios.add(...t)}removeImage(...t){this._images.remove(...t)}removeAudio(...t){this._audios.remove(...t)}setImage(t,e){this._images.set(t,e)}setAudio(t,e){this._audios.set(t,e)}getImage(t){return this._images.get(t)}getAudio(t){return this._audios.get(t)}}class me extends KeyboardEvent{get focused(){return this._focused}constructor(t,e,i){super(e,i),this._focused=t}}class we extends Event{get position(){return this._position}constructor(t,e,i){super(e,i),this._position=t}}class ve extends Event{get positions(){return this._positions}constructor(t,e,i){super(e,i),this._positions=t}}class Q{get engineCore(){if(!this._engineCore)throw new E("EngineCore");return this._engineCore}get inputReceiver(){if(!this._inputReceiver)throw new E("InputReceiver");return this._inputReceiver}initialize(t,e){this._inputReceiver=e,this._engineCore=t}}class be extends Q{constructor(){super(),this.onKeyboardEventUp=this.onKeyboardEventUp.bind(this),this.onKeyboardEventDown=this.onKeyboardEventDown.bind(this)}initialize(t,e){super.initialize(t,e),this.inputReceiver.addEventListener("keyup",this.onKeyboardEventUp),this.inputReceiver.addEventListener("keydown",this.onKeyboardEventDown)}destroy(){this.inputReceiver.removeEventListener("keyup",this.onKeyboardEventUp),this.inputReceiver.removeEventListener("keydown",this.onKeyboardEventDown)}onKeyboardEventDown(t){const e=t,i=this.engineCore.children,s=r=>r.keyDown(e);this.updateScenes(i,s)}onKeyboardEventUp(t){const e=t,i=this.engineCore.children,s=r=>r.keyUp(e);this.updateScenes(i,s)}updateScenes(t,e){for(const i of t)!i.isVisible||!i.isEnabled||this.updateEntities(i.children,e)}updateEntities(t,e){for(const i of t){const s=i,r=s.receiveKeyboardInput??!1;this.updateEntities(i.children,e),r&&e(s)}}}class Se extends Q{constructor(t){super(),this._hoveredEntity=null,this._pressedEntity=null,this._pointerPostion=new g,this._engineCanvas=t,this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerLeave=this.onPointerLeave.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)}initialize(t,e){super.initialize(t,e),this.inputReceiver.addEventListener("mousedown",this.onPointerDown),this.inputReceiver.addEventListener("mouseup",this.onPointerUp),this.inputReceiver.addEventListener("mousemove",this.onPointerMove),this.inputReceiver.addEventListener("mouseleave",this.onPointerLeave),this.inputReceiver.addEventListener("touchstart",this.onTouchStart,{passive:!0}),this.inputReceiver.addEventListener("touchmove",this.onTouchMove,{passive:!0}),this.inputReceiver.addEventListener("touchcancel",this.onTouchEnd,{passive:!0}),this.inputReceiver.addEventListener("touchend",this.onTouchEnd,{passive:!0})}destroy(){this.inputReceiver.removeEventListener("mousedown",this.onPointerDown),this.inputReceiver.removeEventListener("mouseup",this.onPointerUp),this.inputReceiver.removeEventListener("mousemove",this.onPointerMove),this.inputReceiver.removeEventListener("mouseleave",this.onPointerLeave),this.inputReceiver.removeEventListener("touchstart",this.onTouchStart),this.inputReceiver.removeEventListener("touchmove",this.onTouchMove),this.inputReceiver.removeEventListener("touchcancel",this.onTouchEnd),this.inputReceiver.removeEventListener("touchend",this.onTouchEnd)}setStyle(t){const e=this._engineCanvas;if(t!=="default"){e.style.cursor=t;return}e.style.removeProperty("cursor"),e.getAttribute("style")||e.removeAttribute("style")}refresh(){this.onPointerUpdate(this._pointerPostion)}onPointerDown(t){const e=t;this.pressed(this._hoveredEntity,e.position)}onPointerUp(t){const e=t;this.tapped(this._hoveredEntity,e.position)}onPointerMove(t){const e=t;this.onPointerUpdate(e.position)}onPointerLeave(t){const e=t;this.onPointerExit(e.position)}onTouchStart(t){const e=t;e.positions.forEach(i=>{var s;this.onPointerUpdate(i)&&(this.pressed(this._hoveredEntity,i,!0),(s=this._hoveredEntity)==null||s.touchStart(e.positions))})}onTouchMove(t){t.positions.forEach(e=>{this.onPointerUpdate(e)})}onTouchEnd(t){t.positions.forEach(e=>this.tapped(this._hoveredEntity,e)),this.removeHoveredEntity(this._hoveredEntity,this._pointerPostion)}onPointerUpdate(t){let e=!1;this._pointerPostion=t;let i=this.engineCore.children;i=[...i].reverse();for(const s of i)!s.isVisible||!s.isEnabled||(this.moveEnitities(s.children,t),this.updateEntities(s.children,e,t)&&(e=!0));return e||this.removeHoveredEntity(this._hoveredEntity,t),e}moveEnitities(t,e){t.forEach(i=>{const s=i;((s==null?void 0:s.receivePointerInput)??!1)&&this.move(s,e),this.moveEnitities(i.children,e)})}updateEntities(t,e,i){const s=[...t].reverse();for(const r of s)this.updateEntity(r,e,i)&&(e=!0);return e}updateEntity(t,e,i){const s=t,r=(s==null?void 0:s.receivePointerInput)??!1;if(this.isHovered(t,i)){if(!e)return this.addHoveredEntity(t,e,i)}else r&&s.isHovered&&(s.isHitTestVisible||this.leave(s,i));return!1}addHoveredEntity(t,e,i){var s;let r=this.updateEntities(t.children,e,i);if(r)return r;const o=t,a=(o==null?void 0:o.receivePointerInput)??!1,l=((s=this._hoveredEntity)==null?void 0:s.isPointerPressed)??!1;return a&&!r&&(o.isHitTestVisible&&!l&&(o!==this._hoveredEntity&&(this.removeHoveredEntity(this._hoveredEntity,i),this.setPointerStyle(o,!0),this._hoveredEntity=o),r=!0),o.isHovered=!0,this.hover(o,!0,l,i)),r}removeHoveredEntity(t,e){!(t!=null&&t.isPointerEntered)||t.isEnabled&&t.isPointerPressed||(t.isHovered=!1,this.setPointerStyle(t,!1),this.hover(t,!1,!1,e),this._hoveredEntity=null)}onPointerExit(t){this.engineCore.children.forEach(e=>this.exitEntities(e.children,t))}exitEntities(t,e){t.forEach(i=>{const s=i,r=(s==null?void 0:s.receivePointerInput)??!1;this.exitEntities(s.children,e),r&&s.isHovered&&this.leave(s,e)})}hover(t,e,i,s){if(t){if(e||t.isPointerPressed){!t.isPointerEntered&&!i&&(t.isPointerEntered=!0,t.pointerEnter(s)),t.pointerHover(s);return}t.isPointerEntered&&(t.isPointerEntered=!1,t.pointerLeave(s))}}move(t,e){t&&(!t.isEnabled||!t.isPointerPressed||t.pointerMove(e))}pressed(t,e,i=!1){if(!t)return;const s=this.isHovered(t,e),r=i&&t.isTouchHitBoxDisabled;!t.isEnabled||!r&&!s||(this._pressedEntity=t,this._pressedEntity.isPointerPressed=!0,this._pressedEntity.pointerPressed(e))}tapped(t,e){if(!t){if(!this._pressedEntity)return;t=this._pressedEntity}const i=this.isHovered(t,e),s=t.isPointerPressed;(i||s)&&t.pointerTapped(e),t.isPointerPressed=!1,t.pointerReleased(e),this.removeHoveredEntity(t,e),i&&this.onPointerUpdate(this._pointerPostion)}leave(t,e){t&&(t.isPointerPressed=!1,this.removeHoveredEntity(t,e))}isHovered(t,e){return t?t.isEnabled&&t.hitTest(e):!1}setPointerStyle(t,e){!(t!=null&&t.isHitTestVisible)||t.isEnabled&&t.isPointerPressed||this.setStyle(e&&t.isEnabled?"pointer":"default")}}function Pe(h){h=h,h.refresh&&h.refresh()}function H(h){h=h,h.destroy&&h.destroy()}class Ee{constructor(t,e){this._engineCore=t,this._inputReceiver=e,this._inputTypes=new Map}add(t,e){this._inputTypes.set(t,e),e.initialize(this._engineCore,this._inputReceiver)}get(t){return this._inputTypes.get(t)}remove(t){const e=this._inputTypes.get(t);e&&(H(e),this._inputTypes.delete(t))}clear(){this._inputTypes.forEach(t=>H(t)),this._inputTypes.clear()}refresh(){this._inputTypes.forEach(t=>Pe(t))}destroy(){this.clear()}}class Te extends EventTarget{constructor(t){super(),this._engineCanvas=t;const e=this._engineCanvas.ownerDocument.defaultView;this.onKey=this.onKey.bind(this),this.onMouse=this.onMouse.bind(this),this.onTouch=this.onTouch.bind(this),e.addEventListener("keydown",this.onKey),e.addEventListener("keyup",this.onKey),this._engineCanvas.addEventListener("keydown",this.onKey),this._engineCanvas.addEventListener("keyup",this.onKey),this._engineCanvas.addEventListener("mousedown",this.onMouse),this._engineCanvas.addEventListener("mouseup",this.onMouse),this._engineCanvas.addEventListener("mousemove",this.onMouse),this._engineCanvas.addEventListener("mouseleave",this.onMouse),this._engineCanvas.addEventListener("touchstart",this.onTouch,!1),this._engineCanvas.addEventListener("touchend",this.onTouch,!1),this._engineCanvas.addEventListener("touchcancel",this.onTouch,!1),this._engineCanvas.addEventListener("touchmove",this.onTouch,!1)}destroy(){const t=this._engineCanvas.ownerDocument.defaultView;t.removeEventListener("keydown",this.onKey),t.removeEventListener("keyup",this.onKey),this._engineCanvas.removeEventListener("keydown",this.onKey),this._engineCanvas.removeEventListener("keyup",this.onKey),this._engineCanvas.removeEventListener("mousedown",this.onMouse),this._engineCanvas.removeEventListener("mouseup",this.onMouse),this._engineCanvas.removeEventListener("mousemove",this.onMouse),this._engineCanvas.removeEventListener("mouseleave",this.onMouse),this._engineCanvas.removeEventListener("touchstart",this.onTouch,!1),this._engineCanvas.removeEventListener("touchend",this.onTouch,!1),this._engineCanvas.removeEventListener("touchcancel",this.onTouch,!1),this._engineCanvas.removeEventListener("touchmove",this.onTouch,!1)}onKey(t){const e=this._engineCanvas.ownerDocument.activeElement===this._engineCanvas;e&&t.currentTarget instanceof Window||this.dispatchEvent(new me(e,t.type,t))}onMouse(t){const e=new g(t.clientX,t.clientY);this.dispatchEvent(new we(e,t.type,t))}onTouch(t){const e=this.getTouchPositions(t.changedTouches);this.dispatchEvent(new ve(e,t.type,t))}getTouchPositions(t){const e=new Array,i=Array.from(t);for(let s of i){const r=new g(s.clientX,s.clientY);e.push(r)}return e}}g.prototype.set=function(h){this.x=h.x,this.y=h.y,this.width=h.width,this.height=h.height};g.prototype.getScale=function(h){const t=this.width/h.width,e=this.height/h.height;return t<e?t:e};g.prototype.getCenter=function(h){const t=new f;return t.x=h.x+h.width*.5-this.width*.5,t.y=h.y+h.height*.5-this.height*.5,t};g.prototype.getRight=function(){return this.x+this.width};g.prototype.getBottom=function(){return this.y+this.height};g.prototype.getTopRight=function(){return new f(this.x+this.width,this.y)};g.prototype.getBottomRight=function(){return new f(this.x+this.width,this.y+this.height)};g.prototype.getBottomLeft=function(){return new f(this.x,this.y+this.height)};g.prototype.intersectTop=function(h){return this.y<=h.y+h.height};g.prototype.intersectBottom=function(h){return this.y+this.height>=h.y};g.prototype.intersectLeft=function(h){return this.x<=h.x+h.width};g.prototype.intersectRight=function(h){return this.x+this.width>=h.x};g.prototype.intersectsWith=function(h){return this.intersectLeft(h)&&this.intersectRight(h)&&this.intersectTop(h)&&this.intersectBottom(h)};g.prototype.contains=function(h){return this.width===0||this.height===0?!1:this.x<=h.x&&this.x+this.width>=h.x+h.width&&this.y<=h.y&&this.y+this.height>=h.y+h.height};g.prototype.combine=function(h){if(this.width===0||this.height===0||h.width===0||h.height===0)return h;const t=this.getBottomLeft(),e=h.getBottomLeft(),i=this.getBottomRight(),s=h.getBottomRight(),r=t.y>e.y?t.y:e.y,o=i.x>s.x?i.x:s.x,a=new g;return a.x=this.x<h.x?this.x:h.x,a.y=this.y<h.y?this.y:h.y,a.width=o-a.x,a.height=r-a.y,a};_.prototype.moveX=function(h,t){this.x+=this.getCalculatedValue(h,t)};_.prototype.moveY=function(h,t){this.y+=this.getCalculatedValue(h,t)};_.prototype.scaleTo=function(h,t){this.scale+=this.getCalculatedValue(h,t)};_.prototype.rotateTo=function(h,t){this.rotation+=this.getCalculatedValue(h,t)};f.prototype.set=function(h){this.x=h.x,this.y=h.y};f.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};f.prototype.getNormalize=function(){const h=this.getLength(),t=new f;return this.x!=0&&(t.x=this.x/h),this.y!=0&&(t.y=this.y/h),t};f.prototype.getScalar=function(h){return this.x*h.x+this.y*h.y};class c extends f{constructor(t=0,e=0,i=0){super(t,e),this.z=i}}c.prototype.set=function(h){this.x=h.x,this.y=h.y,this.z=h.z};c.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};c.prototype.getNormalize=function(){const h=this.getLength(),t=new c;return this.x!=0&&(t.x=this.x/h),this.y!=0&&(t.y=this.y/h),this.z!=0&&(t.z=this.z/h),t};c.prototype.getScalar=function(h){return this.x*h.x+this.y*h.y+this.z*h.z};class M{}class W extends M{create(){const t=new fe,e=new _e;return new ye(t,e)}}class xe extends M{constructor(t,e){super(),this._document=e,this._engineCanvas=t,this._engineCanvas.style.width="100%",this._engineCanvas.style.height="100%",this._shadowRoot=this._engineCanvas.attachShadow({mode:"closed"});const i=this._document.createElement("div");i.style.width="100%",i.style.height="100%",i.tabIndex=0,this._shadowRoot.innerHTML="<style>div:focus{outline: none;}</style>",this._shadowRoot.appendChild(i)}create(){var t;const e=this._document.createElement("canvas");return e.style.position="absolute",e.style.pointerEvents="none",(t=this._shadowRoot.lastChild)==null||t.appendChild(e),e.getContext("2d")}}class Ce extends M{constructor(t){super(),this._engineCanvas=t,this._inputReceiver=new Te(t)}create(t){if(!t)throw new D("IEngineCore is needed for creation.");const e=new Ee(t,this._inputReceiver);return e.add("Pointer",new Se(this._engineCanvas)),e.add("Keyboard",new be),e}}class Le extends M{constructor(t,e){super(),this._window=e,this._surfaceSettings=t}create(t){if(!t)throw new D("IFactoryContext is needed for creation.");const e=new z(this._surfaceSettings),i=t.create();return e.initialize(i,this._window),e}}class Be{constructor(t,e){this.start=t,this.end=e,this.delta=e-t,this.fps=this.delta>0?1/(this.delta*.001):0}}class ke extends ${get isActive(){return this._isActive}constructor(t,e){super(),this._isActive=!1,this._window=e,this._surfaceSettings=t}start(){this._isActive||(this._isActive=!0,this.request(0))}stop(){this._isActive=!1}destroy(){super.destroy(),this.stop()}request(t){const e=i=>{const s=new Be(t,i);this.loop(s)};this._window.requestAnimationFrame(e)}loop(t){const e=this._surfaceSettings,i=e.frameLimit>0?1e3/e.frameLimit:t.delta;if(Math.round(i-t.delta)<=0){this.children.forEach(s=>s.update(t)),this._isActive&&this.request(t.end);return}this._isActive&&this.request(t.start)}}class Ae extends ke{constructor(t,e,i,s,r){super(t,r),this._contextFactory=i,this._surfaceFactory=e,this._input=s.create(this)}initializeChild(t){const e=this._surfaceFactory.create(this._contextFactory);t.initialize(e,this._input)}destroyChild(t){t.destroy()}}class T extends HTMLElement{static getCanvas(t,e){return this.connectCanvas(e),this._window.document.getElementById(t)}static getEngine(t,e){this.connectCanvas(e);const i=T.getCanvas(t,e);return i==null?void 0:i._engineCore}static connectCanvas(t){!t||this._window===t||(this._window=t,t.customElements.define("engine-canvas",this))}connectedCallback(){const t=T._window;this.initializeEngine(t)}disconnectedCallback(){var t;(t=this._engineCore)==null||t.destroy(),this.replaceChildren()}initializeEngine(t){const e=this.getAttributeValue("target-frame-rate",60),i=this.getAttributeValue("target-frame-limit",0),s=this.getAttributeValue("target-resolution",new f(1920,1080)),r=this.getAttributeValue("max-resolution",new f),o=new Ce(this),a=new xe(this,t.document),l=new O(e,i,s,r),u=new Le(l,t);this._engineCore=new Ae(l,u,a,o,t)}getAttributeValue(t,e){let i=e;const s=this.getAttribute(t);if(!s)return i;if(e instanceof f){const r=s.toLowerCase().split("x");if(r.length>1){const o=new f;return o.x=parseInt(r[0]),o.y=parseInt(r[1]),o}}return parseInt(s)}}function P(h,t){let e=h.toString();if(e.length>t)return e;let i="";const s=1+e.length-t;for(let r=0;r<s;r++)i+="0";return i+e}class A extends Event{constructor(){super(...arguments);n(this,"gameState");n(this,"player");n(this,"playerCount")}}var m=(h=>(h[h.Menu=0]="Menu",h[h.Play=1]="Play",h[h.Score=2]="Score",h[h.Over=3]="Over",h))(m||{}),y=(h=>(h[h.None=0]="None",h[h.One=1]="One",h[h.Two=2]="Two",h))(y||{});class N extends S{constructor(e,i){super();n(this,"_player");n(this,"_service");n(this,"_playerText");n(this,"_selectedText");n(this,"_isSelected");n(this,"_sibling");this._player=e,this._service=i,e===y.One?this._playerText="One Player":this._playerText="Two Players";const s=this._player===y.One;this._selectedText=s?"":"",this._isSelected=s}setSibling(e){this._sibling=e}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.receiveKeyboardInput=!0,this.setHitBox(-220,-40),this.width=300,this.height=60}onPointerEnter(e){super.onPointerEnter(e),this.isEnabled&&this.setSelection(!0)}onPointerTapped(e){super.onPointerTapped(e),this.isEnabled&&this.startGame()}onDraw(e){super.onDraw(e),e.font="80px Roboto Medium",e.fillStyle="#fff",e.globalAlpha=this._isSelected?.8:.4,e.fillText(this._playerText,this.x,this.y+this.height),this._isSelected&&(e.font="100px Material Icons",e.fillText(this._selectedText,this.x-140,this.y+this.height+20))}onKeyUp(e){if(super.onKeyUp(e),!!this.isEnabled)switch(e.key){case"w":case"s":case"ArrowDown":case"ArrowUp":this._isSelected=!this._isSelected;break;case" ":case"Enter":this.startGame();break}}setSelection(e){this._isSelected!==e&&(this._isSelected=e,this._sibling.setSelection(!e))}startGame(){this._isSelected&&(this._service.gamePlay(this._player),this.setAudio("select.aac"))}}function k(h,t,e,i,s){e<2*s&&(s=e/2),i<2*s&&(s=i/2);const r=new Path2D;return r.moveTo(h+s,t),r.arcTo(h+e,t,h+e,t+i,s),r.arcTo(h+e,t+i,h,t+i,s),r.arcTo(h,t+i,h,t,s),r.arcTo(h,t,h+e,t,s),r.closePath(),r}class Ie extends S{constructor(e){super();n(this,"_gameService");n(this,"_playerOne");n(this,"_playerTwo");n(this,"_selectionBounds");this._gameService=e,this._selectionBounds=new g,this._selectionBounds.x=810,this._selectionBounds.y=462,this._playerOne=new N(y.One,this._gameService),this._playerTwo=new N(y.Two,this._gameService),this._playerOne.setSibling(this._playerTwo),this._playerTwo.setSibling(this._playerOne),this._playerOne.set(this._selectionBounds),this._playerTwo.set(this._selectionBounds),this._playerTwo.y=this._playerOne.y+150}onInitialized(){super.onInitialized(),this.add(this._playerOne,this._playerTwo),this.set(this.surface),this.receiveKeyboardInput=!0}onDraw(e){super.onDraw(e);const i=k(565,300,790,640,20);e.globalAlpha=.6,e.fillStyle="#333",e.strokeStyle="#fff",e.lineWidth=3,e.fillRect(this.x,this.y,this.width,this.height),e.fill(i),e.stroke(i),e.globalAlpha=.8,e.font="40px Roboto Medium",e.fillStyle="#fff",e.fillText("Menu",600,360)}}class V extends _{constructor(e,i){super();n(this,"_upText");n(this,"_downText");this._upText=e,this._downText=i}onDraw(e){super.onDraw(e),e.globalAlpha=.6,e.fillStyle="#333",e.strokeStyle="#fff",e.lineWidth=3,e.font="60px Roboto Medium",e.fillStyle="#fff",e.fillText(this._upText,this.x+110,this.y+90),e.fillText(this._downText,this.x+270,this.y+90),e.font="70px Material Icons",e.fillText("",this.x+25,this.y+100),e.fillText("",this.x+190,this.y+105)}}class Re extends _{constructor(){super();n(this,"_playerOneControl");n(this,"_playerTwoControl");this._playerOneControl=new V("W","S"),this._playerOneControl.x=565,this._playerOneControl.y=810,this._playerTwoControl=new V("8","5"),this._playerTwoControl.x=1005,this._playerTwoControl.y=this._playerOneControl.y}onInitialized(){super.onInitialized(),this.add(this._playerOneControl,this._playerTwoControl)}onDraw(e){super.onDraw(e),e.globalAlpha=.8,e.font="40px Roboto Medium",e.fillStyle="#fff",e.fillText("Controls",600,790)}}class ze extends w{constructor(e,i){super(i);n(this,"_gameService");this._gameService=e}onInitialized(){super.onInitialized(),this.add(new Ie(this._gameService),new Re),this.isLoop=!1}}class Me extends S{constructor(e){super();n(this,"_gameService");n(this,"_gameChanged");n(this,"_gameOverText");n(this,"_iconText");n(this,"_gameState");this._gameService=e,this._gameOverText="Game Over",this._iconText="",this._gameChanged=i=>this.onGameChanged(i)}onInitialized(){super.onInitialized(),this.set(this.surface),this.receivePointerInput=!0,this.receiveKeyboardInput=!0,this._gameService.addEventListener("gamechanged",this._gameChanged)}onGameChanged(e){this._gameState=e.gameState,this._gameState===m.Over&&this.setAudio("select.aac")}onKeyUp(e){super.onKeyUp(e),this.isEnabled&&(e.key===" "||e.key==="Enter"||e.key==="Escape")&&this._gameService.gameMenu()}onPointerTapped(e){super.onPointerTapped(e),this._gameState===m.Over&&this._gameService.gameMenu()}onDraw(e){super.onDraw(e);const i=k(565,425,790,230,20);e.globalAlpha=.6,e.fillStyle="#333",e.strokeStyle="#fff",e.lineWidth=4,e.fillRect(this.x,this.y,this.width,this.height),e.fill(i),e.stroke(i),e.font="70px Roboto Medium",e.fillStyle="#fff",e.globalAlpha=.7,e.fillText(this._gameOverText,855,565),e.font="100px Material Icons",e.fillText(this._iconText,695,590)}}class We extends w{constructor(e,i){super(i);n(this,"_gameService");this._gameService=e}onInitialized(){super.onInitialized(),this.add(new Me(this._gameService)),this.isLoop=!1}}class Y extends _{onInitialized(){super.onInitialized(),this.set(this.surface),this.setHitBox(50,70)}}class ee extends S{constructor(e,i){super();n(this,"_gameService");n(this,"_player");n(this,"_gameChanged");n(this,"_imageName");n(this,"_imageNormal");n(this,"_imageCollision");n(this,"_imageScore");n(this,"_isArrowKeyUp");n(this,"_isArrowKeyDown");n(this,"_touchPosition");n(this,"_keyUpKeys");n(this,"_keyDownKeys");n(this,"_collisionTime");n(this,"_scoreTime");n(this,"_computedInput");n(this,"_playerCount");n(this,"_touchY");this.velocity=10,this._player=e,this._touchY=0,this._playerCount=0,this._scoreTime=0,this._collisionTime=0,this._imageName="",this._computedInput=!0,this._isArrowKeyUp=!1,this._isArrowKeyDown=!1,this._gameService=i,this._keyUpKeys=new Array,this._keyDownKeys=new Array;const s=this._player===y.One;this._keyUpKeys.push(...s?["w","ArrowUp"]:["8"]),this._keyDownKeys.push(...s?["s","ArrowDown"]:["5"]),this.setHitBox(140,45),this._gameChanged=r=>this.onGameChanged(r)}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.receiveKeyboardInput=!0,this.isTouchHitBoxDisabled=!0,this._gameService.addEventListener("gamechanged",this._gameChanged)}onUpdate(e){if(super.onUpdate(e),this.isEnabled=!this._computedInput,this.isEnabled&&(this._isArrowKeyUp&&this.moveY(e,-this.velocity),this._isArrowKeyDown&&this.moveY(e,this.velocity),this._touchY>0&&(this.y=this._touchY)),this._collisionTime>0){if(this._collisionTime-=e.delta,this._imageName!==this._imageCollision){const i=this.setImage(this._imageCollision);this._imageName=i.name}return}if(this._scoreTime>0){if(this._scoreTime-=e.delta,this._imageName!==this._imageScore){const i=this.setImage(this._imageScore);this._imageName=i.name}return}if(this._imageName!==this._imageNormal){const i=this.setImage(this._imageNormal);this._imageName=i.name}this._computedInput&&this.computedInput(e)}onCollision(...e){super.onCollision(...e),e.forEach(i=>{this.ballCollision(i),this.backgroundCollision(i)})}setImages(e,i,s){let r=this.setImage(e);return this._imageNormal=r.name,r=this.setImage(i),this._imageCollision=r.name,r=this.setImage(s),this._imageScore=r.name,r}onKeyDown(e){super.onKeyDown(e),this.onKeyChanged(e)}onKeyUp(e){super.onKeyUp(e),this.onKeyChanged(e)}onPointerMove(e){super.onPointerMove(e),this.onTouchChanged(e,!1)}onPointerReleased(e){super.onPointerReleased(e),this.onTouchChanged(e,!0)}onTouchChanged(e,i){if(!(!this.isEnabled||this._computedInput)){if(this._touchPosition){const s=this.surface.width/2;this._player===y.One&&e.x<s&&(this._touchY=e.y-this.height/2),this._player===y.Two&&e.x>s&&(this._touchY=e.y-this.height/2)}this._touchPosition=e,i&&(this._touchY=0)}}onKeyChanged(e){if(!this._computedInput){if(this._keyUpKeys.indexOf(e.key)>-1){this._isArrowKeyUp=e.type==="keydown";return}this._keyDownKeys.indexOf(e.key)>-1&&(this._isArrowKeyDown=e.type==="keydown")}}onGameChanged(e){switch(e.gameState){case m.Menu:case m.Play:case m.Over:this.y=this.getCenter(this.surface).y,this._playerCount=e.playerCount,this._computedInput=this._player>this._playerCount;break;case m.Score:e.player!==this._player&&(this._scoreTime=600);break}}ballCollision(e){e instanceof se&&(this._collisionTime=200)}backgroundCollision(e){if(!(e instanceof Y)||e.hitBox.contains(this.hitBox))return;const i=this._lastHitBox;this.y=i.y-this._hitBoxOffsetY}computedInput(e){this.shouldMoveToCenterY()?this.moveToCenterY(e):this.moveToBallY(e)}shouldMoveToCenterY(){const e=this._gameService.ballPosition,i=this._gameService.ballDirection,s=this.surface.width/2,r=s>e.x,o=s<e.x,a=this._player===y.One?r:o,l=this._player===y.One&&i.x>0,u=this._player===y.Two&&i.x<0;return!a||(l||u)}moveToCenterY(e){let i=this.velocity/2,s=this.y+this.height/2;const r=this.surface.height/2;for(;s>r&&i>0;)i--,this.moveY(e,-1),s=this.y+this.height/2;for(;s<r&&i>0;)i--,this.moveY(e,1),s=this.y+this.height/2}moveToBallY(e){let i=this.velocity,s=this.y+this.height/2;const r=this._gameService.ballPosition;for(;r.y<s&&i>0;)i--,this.moveY(e,-1),s=this.y+this.height/2;for(;r.y>s&&i>0;)i--,this.moveY(e,1),s=this.y+this.height/2}}class te extends ee{constructor(t){super(y.One,t)}onInitialized(){super.onInitialized();const e=this.setImages("bat00.png","bat01.png","bat02.png").image;this.width=e.width*2,this.height=e.height*2,this.x=-80,this.y=this.getCenter(this.surface).y}}class ie extends ee{constructor(t){super(y.Two,t)}onInitialized(){super.onInitialized();const e=this.setImages("bat03.png","bat04.png","bat05.png").image;this.width=e.width*2,this.height=e.height*2;const i=this.getCenter(this.surface);this.x=this.surface.width-240,this.y=i.y}}class Oe extends _{constructor(){super();n(this,"_runTime");this._runTime=200}onUpdate(e){if(super.onUpdate(e),this._runTime<=0){this.isVisible=!1;return}this._runTime<40?this.setImage("impact04.png"):this._runTime<80?this.setImage("impact03.png"):this._runTime<120?this.setImage("impact02.png"):this._runTime<160?this.setImage("impact01.png"):this._runTime<200&&this.setImage("impact00.png"),this._runTime-=e.delta}}function K(h,t){return Math.random()*(t-h)+h}class se extends _{constructor(e){super();n(this,"_gameService");n(this,"_pauseTime");n(this,"_playerCount");n(this,"_gameChanged");this._gameService=e,this._playerCount=0,this._pauseTime=1e3,this._gameChanged=i=>this.onGameChanged(i),this._gameService.addEventListener("gamechanged",this._gameChanged)}onInitialized(){super.onInitialized();const i=this.setImage("ball.png").image;this.width=i.width*2.5,this.height=i.height*2.5,this.setHitBox(15,15),this.reset(!0)}onUpdate(e){if(super.onUpdate(e),this.setAudio("theme.aac",.1,!0),this._pauseTime>0)this._pauseTime-=e.delta;else{this._pauseTime=0;const i=this.direction.getNormalize(),s=i.x*this.velocity,r=i.y*this.velocity;this.moveX(e,s),this.moveY(e,r)}this._gameService.ballPosition=this,this._gameService.ballDirection=this.direction,this.removeObsolete()}onCollision(...e){super.onCollision(...e),e.forEach(i=>{this.backgroundCollision(i),this._pauseTime<=0&&this.playerCollision(i)})}onGameChanged(e){if(this._playerCount=e.playerCount,e.gameState===m.Play){this.play();return}e.gameState===m.Menu&&(this.velocity=15)}playerCollision(e){if(!(e instanceof te)&&!(e instanceof ie))return;const i=e.hitBox,s=this.direction.x<0?i.x+i.width+this.velocity:i.x-this.hitBox.width-this.velocity;this.direction.x*=-1,this.direction.y=this.getCollisionAngle(i),this.x=s-this._hitBoxOffsetX,this.y=this.hitBox.y-this._hitBoxOffsetY,this.increaseSpeed(),this.playEffect(),this.playHitSound()}backgroundCollision(e){const i=e.hitBox;if(!(!(e instanceof Y)||i.contains(this.hitBox))){if(this.hitBox.x<=i.x||this.hitBox.x+this.hitBox.width>=i.x+i.width){const s=this.hitBox.x<=i.x;this.direction.x*=-1,this._gameService.gameState===m.Play&&this._gameService.gameScore(s?2:1),this.reset(s)}else if(this.hitBox.y<=i.y||this.hitBox.y+this.hitBox.height>=i.y+i.height){const s=this.hitBox.y<=i.y;this.direction.y*=-1,this.y=s?i.y-this._hitBoxOffsetY+this.velocity:i.y+i.height-(this._hitBoxOffsetY+this.hitBox.height+this.velocity),this.playHitSound(),this.playEffect()}}}getCollisionAngle(e){const i=e.y+e.height/2,s=i-e.y,o=this.hitBox.y+this.hitBox.height/2-i;let l=.5*Math.abs(o/s);return(this.direction.y<0&&l>0||this.direction.y>0&&l<0)&&(l*=-1),l!==0?l:K(-.1,.1)}playEffect(){const e=new Oe;e.set(this.hitBox),e.width=this.width*2,e.height=this.height*2,e.x-=this.width/2,e.y-=this.height/2,this.add(e)}play(){const e=Math.round(K(0,1));this.reset(e)}reset(e){const i=this.getCenter(this.surface);this.x=i.x,this.y=i.y,this.velocity=15,this.direction.y=0,this.direction.x=e?-1:1,this._lastHitBox=this.setHitBox(15,15),this._pauseTime=1e3}removeObsolete(){this.children.forEach(e=>{e.isVisible||this.remove(e)})}increaseSpeed(){!(this._playerCount<1)&&this.velocity<40&&(this.velocity+=1)}playHitSound(){this.setAudio("hit.aac",.5)}}class U extends _{constructor(){super();n(this,"_number");n(this,"_imageName");n(this,"_useHighlight");n(this,"_highlightStep");n(this,"_scoreMap");this._number=0,this._highlightStep=0,this._imageName="",this._useHighlight=!1,this._scoreMap=new Map}set number(e){this._number=e}set highlight(e){this._useHighlight=e}addGreenNumbers(){for(let e=20;e<30;e++)this.addScoreImage(e);this._highlightStep=20}addBlueNumbers(){for(let e=10;e<20;e++)this.addScoreImage(e);this._highlightStep=10}onInitialized(){var i;super.onInitialized();for(let s=0;s<10;s++)this.addScoreImage(s);const e=(i=this._imageSource)==null?void 0:i.image;e&&(this.width=e.width*1.4,this.height=e.height*1.4)}onUpdate(e){super.onUpdate(e);let i=this.getScoreName(this._number);if(this._useHighlight){const s=this._number+this._highlightStep;i=this.getScoreName(s)}if(this._imageName!=i){const s=this.setImage(i);this._imageName=s.name}}addScoreImage(e){const i=this.getScoreName(e),s=this.setImage(i);this._imageName=s.name,this._scoreMap.set(e,i)}getScoreName(e){return`digit${P(e,1)}.png`}}class he extends _{constructor(e,i){super();n(this,"_numberLeft");n(this,"_numberRight");n(this,"_gameChanged");n(this,"_gameService");n(this,"_player");n(this,"_effectTime");n(this,"_number");n(this,"_gameState");this._number=0,this._effectTime=0,this._player=e,this._gameService=i,this._gameState=m.Menu,this._numberLeft=new U,this._numberRight=new U,this._gameChanged=s=>this.onGameChanged(s),this._gameService.addEventListener("gamechanged",this._gameChanged)}set number(e){e>0&&e!=this._number&&(this._effectTime=600),this._number=e,this._numberRight.number=e%10,this._numberLeft.number=Math.trunc(e/10)}set highlight(e){this._numberRight.highlight=e,this._numberLeft.highlight=e}onInitialized(){super.onInitialized(),this.add(this._numberLeft,this._numberRight)}onGameChanged(e){this._gameState=e.gameState}onUpdate(e){if(super.onUpdate(e),this._numberLeft.x=this.x,this._numberLeft.y=this.y,this._numberRight.x=this._numberLeft.x+this._numberLeft.width,this._numberRight.y=this.y,this._effectTime>0){this.highlight=!0,this._effectTime-=e.delta;return}this.highlight=this._gameState===m.Over}addBlueNumbers(){this._numberLeft.addBlueNumbers(),this._numberRight.addBlueNumbers()}addGreenNumbers(){this._numberLeft.addGreenNumbers(),this._numberRight.addGreenNumbers()}}class De extends he{constructor(t){super(y.One,t),this.x=700,this.y=135}onInitialized(){super.onInitialized(),this.addGreenNumbers()}onUpdate(t){super.onUpdate(t),this.number=this._gameService.playerOneScore}}class Ye extends he{constructor(t){super(y.Two,t),this.x=1015,this.y=135}onInitialized(){super.onInitialized(),this.addBlueNumbers()}onUpdate(t){super.onUpdate(t),this.number=this._gameService.playerTwoScore}}class He extends w{constructor(e,i){super(i);n(this,"_gameService");this._gameService=e}onInitialized(){super.onInitialized(),this.add(new Y,new te(this._gameService),new ie(this._gameService),new De(this._gameService),new Ye(this._gameService),new se(this._gameService))}}class ne extends S{constructor(e){super();n(this,"_backgroundOpacity");n(this,"_backgroundOpacityNormal");n(this,"_backgroundOpacityHover");n(this,"_backgroundOpacityPressed");n(this,"_disabledOpacity");n(this,"_iconText");this._iconText=e,this.width=100,this.height=100,this._disabledOpacity=.1,this._backgroundOpacityNormal=.2,this._backgroundOpacityHover=.4,this._backgroundOpacityPressed=.5,this._backgroundOpacity=this._backgroundOpacityNormal}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.setHitBox(0,0)}onPointerEnter(e){super.onPointerEnter(e),this._backgroundOpacity=this._backgroundOpacityHover}onPointerLeave(e){super.onPointerLeave(e),this._backgroundOpacity=this._backgroundOpacityNormal}onPointerPressed(e){super.onPointerPressed(e),this._backgroundOpacity=this._backgroundOpacityPressed}onPointerReleased(e){super.onPointerReleased(e),this._backgroundOpacity=this._backgroundOpacityNormal}onDraw(e){super.onDraw(e),e.font="70px Material Icons",e.textAlign="left",e.textBaseline="top",e.fillStyle="#000",e.strokeStyle="#fff",e.lineWidth=3,e.globalAlpha=this.isEnabled?this._backgroundOpacity:this._backgroundOpacityNormal;const i=this.width/2,s=16;e.beginPath(),e.arc(this.x+i,this.y+i,i,0,2*Math.PI),e.fill(),e.globalAlpha=this.isEnabled?.5:this._disabledOpacity,e.stroke(),e.fillStyle="#fff",e.fillText(this._iconText,this.x+s,this.y+s)}}class Ne extends ne{constructor(){super("");n(this,"_onIconText");n(this,"_offIconText");this._offIconText="",this._onIconText=""}onPointerTapped(e){super.onPointerTapped(e),this.setAudio("select.aac",.5),this.onToggle()}async onToggle(){const e=this._iconText===this._onIconText;if(this._iconText=e?this._offIconText:this._onIconText,!e){await this.assets.loadAudiosAsync(),this.assets.isAudioMuted=!1;return}this.assets.isAudioMuted=!0}}class Ve extends ne{constructor(e){super("");n(this,"_gameService");this._gameService=e}onPointerTapped(e){super.onPointerTapped(e),this._gameService.gameMenu(),this.setAudio("select.aac")}}class Ke extends _{constructor(e){super();n(this,"_gameService");n(this,"_gameChanged");n(this,"_audioButton");n(this,"_exitButton");n(this,"_leftPosition");n(this,"_rightPosition");this._gameService=e,this._audioButton=new Ne,this._exitButton=new Ve(e),this._leftPosition=new f(570,140),this._rightPosition=new f(1260,140),this._exitButton.isEnabled=!1,this._gameChanged=i=>this.onGameChanged(i)}onInitialized(){super.onInitialized(),this.add(this._audioButton,this._exitButton),this.set(this.surface),this.setPositions(this._audioButton,this._exitButton),this._gameService.addEventListener("gamechanged",this._gameChanged)}onGameChanged(e){switch(e.gameState){case m.Play:this._exitButton.isEnabled=!0;break;case m.Menu:this._exitButton.isEnabled=!1;break}}setPositions(e,i){e&&(e.x=this._leftPosition.x,e.y=this._leftPosition.y),i&&(i.x=this._rightPosition.x,i.y=this._rightPosition.y)}}class Ue extends w{constructor(e,i){super(i);n(this,"_gameService");this._gameService=e}onInitialized(){super.onInitialized(),this.add(new Ke(this._gameService)),this.isLoop=!1}}class F extends _{constructor(e){super();n(this,"_runTime");n(this,"_runTimeCount");n(this,"_imageName");this.isVisible=!1,this._imageName=e,this._runTime=0,this._runTimeCount=0}play(){this._runTime=this._runTimeCount,this.setAudio("score.aac",1)}onInitialized(){super.onInitialized(),this.setImage(this._imageName),this.set(this.surface)}onUpdate(e){if(super.onUpdate(e),this._runTimeCount=this.getCalculatedValue(e,600),this._runTime<=0){const i=this.isVisible;this.isVisible=!1,i&&this.refresh();return}this.isVisible=!0,this._runTime-=e.delta,this.refresh()}}class Fe extends _{constructor(e){super();n(this,"_gameService");n(this,"_gameChanged");n(this,"_effectLeft");n(this,"_effectRight");this._effectLeft=new F("effect00.png"),this._effectRight=new F("effect01.png"),this._gameService=e,this._gameChanged=i=>this.onGameChanged(i),this._gameService.addEventListener("gamechanged",this._gameChanged)}onInitialized(){super.onInitialized(),this.add(this._effectLeft,this._effectRight),this.set(this.surface),this.setImage("table.png"),this.setHitBox(50,70)}onGameChanged(e){switch(e.player){case y.One:this._effectRight.play();break;case y.Two:this._effectLeft.play();break}this.refresh()}}class Xe extends w{constructor(e,i){super(i);n(this,"_gameService");this._gameService=e}onInitialized(){super.onInitialized(),this.add(new Fe(this._gameService)),this.isLoop=!1}}class qe extends EventTarget{constructor(e,i){super();n(this,"_engineCore");n(this,"_tableScene");n(this,"_playScene");n(this,"_menuScene");n(this,"_endScene");n(this,"_overlayScene");n(this,"gameState");n(this,"ballPosition");n(this,"ballDirection");n(this,"playerOneScore");n(this,"playerTwoScore");this.playerOneScore=0,this.playerTwoScore=0,this.gameState=m.Menu,this.ballPosition=new f,this.ballDirection=new f,this._engineCore=e,this._tableScene=new Xe(this,i),this._menuScene=new ze(this,i),this._endScene=new We(this,i),this._playScene=new He(this,i),this._overlayScene=new Ue(this,i)}initialize(){this._engineCore.add(this._tableScene,this._playScene,this._menuScene,this._endScene,this._overlayScene),this.gameMenu(),this._engineCore.start()}gameMenu(){this.playerOneScore=0,this.playerTwoScore=0,this._playScene.isEnabled=!1,this._endScene.isVisible=!1,this._menuScene.isVisible=!0,this.gameState=m.Menu;const e=new A("gamechanged");e.gameState=this.gameState,e.playerCount=0,this.dispatchEvent(e)}gamePlay(e){this._playScene.isEnabled=!0,this._endScene.isVisible=!1,this._menuScene.isVisible=!1,this.gameState=m.Play;const i=new A("gamechanged");i.gameState=this.gameState,i.playerCount=e,this.dispatchEvent(i)}gameOver(e){this._playScene.isEnabled=!1,this._menuScene.isVisible=!1,this._endScene.isVisible=!0,this.gameState=m.Over;const i=new A("gamechanged");i.gameState=this.gameState,i.player=e,i.playerCount=0,this.dispatchEvent(i)}gameScore(e){switch(e){case y.One:this.playerOneScore+=1;break;case y.Two:this.playerTwoScore+=1;break}const i=new A("gamechanged");i.gameState=m.Score,i.player=e,this.dispatchEvent(i),this.playerOneScore>9?this.gameOver(y.One):this.playerTwoScore>9&&this.gameOver(y.Two)}}class Ge{constructor(t){n(this,"_engine");n(this,"_assets");this._engine=t;const e=new W;this._assets=e.create(),this._assets.addAudio("./assets/pong/audios/theme.aac","./assets/pong/audios/select.aac","./assets/pong/audios/hit.aac","./assets/pong/audios/score.aac"),this._assets.addImage("./assets/pong/images/table.png","./assets/pong/images/over.png","./assets/pong/images/ball.png");for(let i=0;i<4;i++){const s=P(i,1);this._assets.addImage(`./assets/pong/images/player${s}.png`)}for(let i=0;i<2;i++){const s=P(i,1);this._assets.addImage(`./assets/pong/images/effect${s}.png`)}for(let i=0;i<6;i++){const s=P(i,1);this._assets.addImage(`./assets/pong/images/bat${s}.png`)}for(let i=0;i<5;i++){const s=P(i,1);this._assets.addImage(`./assets/pong/images/impact${s}.png`)}for(let i=0;i<30;i++){const s=P(i,1);this._assets.addImage(`./assets/pong/images/digit${s}.png`)}}async startAsync(){await this._assets.loadImagesAsync(),new qe(this._engine,this._assets).initialize()}}class $e{async initializeAsync(t,e){const i=T.getEngine(t,e);i&&await new Ge(i).startAsync()}}class X extends _{constructor(e){super();n(this,"_imageName");this._imageName=e}onInitialized(){super.onInitialized();const i=this.setImage(this._imageName).image;this.width=i.width,this.height=i.height}}class I extends _{constructor(e,i,s,r=0){super();n(this,"_backgroundLayer");n(this,"_backgroundLayerFlip");n(this,"_xOffset");this.velocity=e,this._backgroundLayer=new X(i),this._backgroundLayerFlip=new X(s),this._xOffset=r}onInitialized(){this.add(this._backgroundLayer,this._backgroundLayerFlip),this.set(this.surface),this._backgroundLayerFlip.x=this._backgroundLayer.width+this._xOffset}onUpdate(e){this._backgroundLayer.moveX(e,-this.velocity),this._backgroundLayer.x=this._backgroundLayer.x<-this._backgroundLayer.width?-this._backgroundLayer.width:this._backgroundLayer.x,this._backgroundLayerFlip.moveX(e,-this.velocity),this._backgroundLayerFlip.x=this._backgroundLayerFlip.x<-this._backgroundLayerFlip.width?-this._backgroundLayerFlip.width:this._backgroundLayerFlip.x,this._backgroundLayer.x+this._backgroundLayer.width<=0&&(this._backgroundLayer.x=this._backgroundLayerFlip.x+this._backgroundLayerFlip.width+this._xOffset),this._backgroundLayerFlip.x+this._backgroundLayerFlip.width<=0&&(this._backgroundLayerFlip.x=this._backgroundLayer.x+this._backgroundLayer.width+this._xOffset)}}class je extends _{onInitialized(){super.onInitialized(),this.add(new I(.5,"background00.png","background01.png",-1),new I(1,"background02.png","background03.png"),new I(10,"background04.png","background05.png"),new I(15,"background06.png","background07.png"))}}class q extends _{onInitialized(){const e=this.setImage("wheel.png").image;this.width=e.width*.8,this.height=e.height*.8}}class Ze extends _{constructor(){super();n(this,"_wheelLeft");n(this,"_wheelRight");this._wheelLeft=new q,this._wheelRight=new q}onInitialized(){super.onInitialized(),this.add(this._wheelLeft,this._wheelRight);const i=this.setImage("car.png").image;this.x=200,this.y=720,this.width=i.width*.8,this.height=i.height*.8,this._wheelLeft.x=this.x+58,this._wheelLeft.y=this.y+81,this._wheelRight.x=this._wheelLeft.x+308,this._wheelRight.y=this._wheelLeft.y}onUpdate(e){this._wheelLeft.rotateTo(e,10),this._wheelRight.rotateTo(e,10)}}class Je extends w{onInitialized(){super.onInitialized(),this.add(new je,new Ze)}}class Qe{constructor(t){n(this,"_engine");n(this,"_assets");this._engine=t;const e=new W;this._assets=e.create(),this._assets.addImage("./assets/street/images/title.png","./assets/street/images/car.png","./assets/street/images/wheel.png");for(let i=0;i<8;i++){const s=P(i,1);this._assets.addImage(`./assets/street/images/background${s}.png`)}}async startAsync(){await this._assets.loadImagesAsync(),this._engine.add(new Je(this._assets)),this._engine.start()}}class et{async initializeAsync(t,e){const i=T.getEngine(t,e);i&&await new Qe(i).startAsync()}}class tt extends w{constructor(e,i){super(e);n(this,"_element");this._element=i}onInitialized(){super.onInitialized(),this.add(this._element),this.isLoop=!1}}class B extends S{constructor(e,i){super();n(this,"_parent");n(this,"_cursorStyle");n(this,"_pressedDiff");n(this,"_pressedDiffParent");this._parent=e,this._cursorStyle=i,this._pressedDiff=new f,this._pressedDiffParent=new g}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.width=30,this.height=30}onDraw(e){super.onDraw(e),e.fillStyle="white",e.strokeStyle="black",e.lineWidth=4,e.fillRect(this.x,this.y,this.width,this.height),e.strokeRect(this.x,this.y,this.width,this.height)}onPointerEnter(e){super.onPointerEnter(e),this.opacity=1,this._parent.isHitTestVisible=!1,this.changeCursor(this._cursorStyle)}onPointerLeave(e){super.onPointerLeave(e),this.opacity=0,this._parent.isHitTestVisible=!0}onPointerPressed(e){super.onPointerPressed(e),this._pressedDiff.x=this.x-e.x,this._pressedDiff.y=this.y-e.y,this._pressedDiffParent.x=this._parent.x-e.x,this._pressedDiffParent.y=this._parent.y-e.y,this._pressedDiffParent.width=this._parent.getRight()-e.x,this._pressedDiffParent.height=this._parent.getBottom()-e.y}onPointerMove(e){this.isPointerPressed&&this._parent.resize(this,e,this._pressedDiffParent)}}n(B,"stateChangedEvent","statechanged");class v{static getProjection(t){return[[t,0,0],[0,t,0]]}static getTranslation(t){return[[1,0,t.x],[0,1,t.y],[0,0,1]]}static getScale(t){return[[t.x,0,0],[0,t.y,0],[0,0,1]]}static getRotationX(t){return[[1,0,0],[0,Math.cos(t),-Math.sin(t)],[0,Math.sin(t),Math.cos(t)]]}static getRotationY(t){return[[Math.cos(t),0,Math.sin(t)],[0,1,0],[-Math.sin(t),0,Math.cos(t)]]}static getRotationZ(t){return[[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]]}static multiplyMatrix(t,e){const i=e.x!==void 0&&e.y!==void 0&&e.z!==void 0?this.vectorToMatrix(e):e,s=t[0].length,r=t.length,o=i[0].length,a=i.length;if(s!==a)throw Error("ColumnsCount of matrixA doesn't match RowsCount of matrixB");const l=new Array;for(let u=0;u<r;u++)l.push(new Array);for(let u=0;u<r;u++)for(let d=0;d<o;d++){let p=0;for(let x=0;x<s;x++)p+=t[u][x]*i[x][d];l[u][d]=p}return l}static vectorToMatrix(t){return[[t.x],[t.y],[t.z]]}static matrixToVector(t){return t.length>2?new c(t[0][0],t[1][0],t[2][0]):t.length>1?new c(t[0][0],t[1][0],0):t.length>0?new c(t[0][0],0,0):new c(0,0,0)}}class it extends _{constructor(){super();n(this,"_cubePoints");n(this,"_arrowFrontPoints");n(this,"_arrowBackPoints");n(this,"_arrowLeftPoints");n(this,"_arrowRightPoints");n(this,"_maxRadius");n(this,"_elementX");n(this,"_elementY");n(this,"_distance");n(this,"_color");n(this,"_scaleMatrix");n(this,"_rotationXMatrix");n(this,"_rotationYMatrix");n(this,"_rotationZMatrix");n(this,"name");n(this,"isAutoRotate");n(this,"rotationX");n(this,"rotationY");n(this,"rotationZ");this.name="3D Cube",this._cubePoints=new Array(new c(-1,-1,-1),new c(1,-1,-1),new c(1,1,-1),new c(-1,1,-1),new c(-1,-1,1),new c(1,-1,1),new c(1,1,1),new c(-1,1,1)),this._arrowFrontPoints=new Array(new c(-.4,0,1),new c(0,.4,1),new c(0,.2,1),new c(.4,.2,1),new c(.4,-.2,1),new c(0,-.2,1),new c(0,-.4,1)),this._arrowBackPoints=new Array(new c(.4,0,-1),new c(0,-.4,-1),new c(0,-.2,-1),new c(-.4,-.2,-1),new c(-.4,.2,-1),new c(0,.2,-1),new c(0,.4,-1)),this._arrowLeftPoints=new Array(new c(-1,0,-.4),new c(-1,0,-.2),new c(-1,.4,-.2),new c(-1,.4,.2),new c(-1,0,.2),new c(-1,0,.4),new c(-1,-.4,0)),this._arrowRightPoints=new Array(new c(1,0,.4),new c(1,0,.2),new c(1,-.4,.2),new c(1,-.4,-.2),new c(1,0,-.2),new c(1,0,-.4),new c(1,.4,0)),this._elementX=0,this._elementY=0,this._distance=5,this._color="red",this._rotationXMatrix=[],this._rotationYMatrix=[],this._rotationZMatrix=[],this._scaleMatrix=[],this.isAutoRotate=!0,this.rotationX=0,this.rotationY=0,this.rotationZ=0,this._maxRadius=2*Math.PI}onUpdate(e){super.onUpdate(e),this._elementX=this.x+this.width*.5,this._elementY=this.y+this.height*.5,this.isAutoRotate&&(this.rotationX=(this.rotationX+this.getCalculatedValue(e,.01))%this._maxRadius,this.rotationY=(this.rotationY+this.getCalculatedValue(e,-.01))%this._maxRadius),this._rotationXMatrix=v.getRotationX(this.rotationX),this._rotationYMatrix=v.getRotationY(this.rotationY),this._rotationZMatrix=v.getRotationZ(this.rotationZ),this._scaleMatrix=v.getScale(new f(this.width*1.7,this.height*1.7)),this.refresh()}onDraw(e){super.onDraw(e),this.drawArrow(e,this._arrowBackPoints),this.drawArrow(e,this._arrowFrontPoints),this.drawArrow(e,this._arrowLeftPoints),this.drawArrow(e,this._arrowRightPoints),this.drawCube(e)}drawArrow(e,i){let s,r;e.fillStyle=this._color,e.beginPath(),i.forEach(o=>{const a=this.getProjected2dVector(o);e.lineTo(a[0].x,a[0].y),r?(e.globalAlpha=1,this.drawConnection(e,r,a,6,!1)):s=a,r=a}),e.globalAlpha=1,this.drawConnection(e,r,s,6,!1),e.globalAlpha=.2,e.closePath(),e.fill(),e.globalAlpha=1}drawCube(e){const i=new Array;this._cubePoints.forEach(s=>{const r=this.getProjected2dVector(s);i.push(r)}),e.fillStyle=this._color,this.drawArea(e,i[0][0],i[4][0],i[5][0],i[1][0]),this.drawArea(e,i[2][0],i[6][0],i[7][0],i[3][0]);for(let s=0;s<4;s++)this.drawConnection(e,i[s],i[(s+1)%4],6),this.drawConnection(e,i[s+4],i[(s+1)%4+4],6),this.drawConnection(e,i[s],i[s+4],6)}getProjected2dVector(e){let i=v.vectorToMatrix(e);i=v.multiplyMatrix(this._rotationXMatrix,i),i=v.multiplyMatrix(this._rotationYMatrix,i),i=v.multiplyMatrix(this._rotationZMatrix,i),i=v.multiplyMatrix(this._scaleMatrix,i);const s=1/(this._distance-i[2][0]),r=v.getProjection(s);i=v.multiplyMatrix(r,i);const o=v.matrixToVector(i);return o.x+=this._elementX,o.y+=this._elementY,[o,s]}drawConnection(e,i,s,r,o=!0){const a=(this.height<=this.width?this.height:this.width)*.002,l=this.createLinePath(i[0],s[0],a*this._distance*i[1]*r,a*this._distance*s[1]*r);e.fill(l),o&&this.drawCap(e,i)}drawArea(e,i,s,r,o){e.globalAlpha=.2,e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(s.x,s.y),e.lineTo(r.x,r.y),e.lineTo(o.x,o.y),e.closePath(),e.fill(),e.globalAlpha=1}drawCap(e,i){e.beginPath();const s=(this.height<=this.width?this.height:this.width)*.03;e.arc(i[0].x,i[0].y,s*i[1]*this._distance,0,2*Math.PI,!1),e.closePath(),e.fill()}createLinePath(e,i,s,r){const o=Math.atan2(i.y-e.y,i.x-e.x)+Math.PI*.5,a=new Path2D;return a.arc(e.x,e.y,s*.5,o,o+Math.PI),a.arc(i.x,i.y,r*.5,o+Math.PI,o),a.closePath(),a}}class re{constructor(){n(this,"name","");n(this,"x","");n(this,"y","");n(this,"width","");n(this,"height","");n(this,"rotationX","");n(this,"rotationY","");n(this,"transform","")}}class st extends S{constructor(e){super();n(this,"_shape");n(this,"_handles");n(this,"_pressedDiff");n(this,"_radianToDegree");n(this,"_rulerArea");n(this,"_minSize");n(this,"offset");n(this,"elementData");this._rulerArea=e,this._pressedDiff=new f,this._shape=new it,this._handles=new Array(new B(this,"nwse-resize"),new B(this,"nesw-resize"),new B(this,"nwse-resize"),new B(this,"nesw-resize")),this.elementData=new re,this.offset=0,this._radianToDegree=180/Math.PI,this._minSize=300}onInitialized(){super.onInitialized(),this.add(this._shape,...this._handles),this.receivePointerInput=!0,this.x=390,this.y=290,this.width=600,this.height=600,this.offset=62}onUpdate(e){super.onUpdate(e),this._shape.x=this.x+15,this._shape.y=this.y+15,this._shape.width=this.width-30,this._shape.height=this.height-30,this._shape.isAutoRotate=!this.isPointerPressed,this.updateHandlesPosition(),this.updateData()}updateData(){this.elementData.name="3D Cube (Weak Perspective Projection)",this.elementData.x=`${Math.round(this.x-this.offset)}px`,this.elementData.y=`${Math.round(this.y-this.offset)}px`,this.elementData.width=`${Math.round(this.width)}px`,this.elementData.height=`${Math.round(this.height)}px`,this.elementData.rotationX=`${Math.round(this._shape.rotationX*this._radianToDegree)}°`,this.elementData.rotationY=`${Math.round(this._shape.rotationY*this._radianToDegree*-1)}°`}onPointerEnter(e){super.onPointerEnter(e),this.updateHandlesVisibility(!0)}onPointerLeave(e){super.onPointerLeave(e),this.updateHandlesVisibility(!1)}onPointerPressed(e){super.onPointerPressed(e),this.changeCursor("move"),this._pressedDiff.x=this.x-e.x,this._pressedDiff.y=this.y-e.y}onPointerMove(e){if(super.onPointerMove(e),this._handles.find(r=>r.isPointerPressed))return;const i=e.x+this._pressedDiff.x,s=e.y+this._pressedDiff.y;this.checkAreaBounds(i,s,this.width,this.height)}resize(e,i,s){const r=this._handles.indexOf(e);let o=this.x,a=this.y,l=0,u=0,d=this.width,p=this.height;switch(r){case 0:l=this.x-i.x,u=this.y-i.y,d+=l,p+=u,this.checkAreaBounds(i.x+s.x,i.y+s.y,d,p),l=o-this.x,u=a-this.y,this.width+=l,this.height+=u;break;case 1:l=i.x+s.width-this.getRight(),u=this.y-i.y,d+=l,p+=u,d=this.checkWidthBounds(d),this.checkAreaBounds(this.x,i.y+s.y,d,p),u=a-this.y,this.height+=u,this.width=d;break;case 2:l=i.x+s.width-this.getRight(),u=i.y+s.height-this.getBottom(),d+=l,p+=u,d=this.checkWidthBounds(d),p=this.checkHeightBounds(p),this.width=d,this.height=p;break;case 3:l=this.x-i.x,u=i.y+s.height-this.getBottom(),d+=l,p+=u,p=this.checkHeightBounds(p),this.checkAreaBounds(i.x+s.x,this.y,d,p),l=o-this.x,this.width+=l,this.height=p;break}}checkWidthBounds(e){const i=this._rulerArea.getRight();return this.x+e>i&&(e=i-this.x),e<this._minSize&&(e=this._minSize),e}checkHeightBounds(e){const i=this._rulerArea.getBottom();return this.y+e>i&&(e=i-this.y),e<this._minSize&&(e=this._minSize),e}checkAreaBounds(e,i,s,r){const o=this._rulerArea.getRight(),a=this._rulerArea.getBottom(),l=this.offset,u=this.offset,d=o-s,p=a-r;e<l?this.x=l:e>d?this.x=d:s>=this._minSize&&(this.x=e),i<u?this.y=u:i>p?this.y=p:r>=this._minSize&&(this.y=i)}updateHandlesVisibility(e){this._handles.forEach(i=>i.opacity=e?1:0)}updateHandlesPosition(){const e=this._handles.find(i=>i.isPointerEntered);for(let i=0;i<this._handles.length;i++){const s=this._handles[i];if(!s)return;switch(s.opacity=this.isPointerEntered||e?1:0,i){case 0:s.x=this.x,s.y=this.y;break;case 1:const r=this.getTopRight();s.x=r.x-30,s.y=r.y;break;case 2:const o=this.getBottomRight();s.x=o.x-30,s.y=o.y-30;break;case 3:const a=this.getBottomLeft();s.x=a.x,s.y=a.y-30;break}}}}class ht extends _{constructor(e,i){super();n(this,"_service");n(this,"_propertiesWith");this._propertiesWith=e,this._service=i}onInitialized(){super.onInitialized();const e=this.surface;this.x=e.width-this._propertiesWith,this.width=this._propertiesWith,this.height=e.height}onDraw(e){super.onDraw(e),this.drawBackground(e),this.drawTitle(e),this.drawProperties(e)}drawBackground(e){e.lineWidth=3,e.fillStyle="#222",e.fillRect(this.x,this.y,this.width,this.height),e.strokeStyle="#000",e.strokeRect(this.x,this.y,this.width,this.height)}drawTitle(e){e.fillStyle="#fff",e.strokeStyle="#fff",e.font="42px Material Icons",e.fillText("",this.x+35,this.y+65),e.font="36px Roboto Medium";const i="Properties",s=e.measureText(i),r=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent,o=this.x+95,a=r+24;e.fillText(i,o,a)}drawProperties(e){const i=this._service.selectedElement;if(!i)return;let s=this.y+145;s=this.drawProperty(e,s,"Name",i.name),s=this.drawProperty(e,s,"X",i.x),s=this.drawProperty(e,s,"Y",i.y),s=this.drawProperty(e,s,"Width",i.width),s=this.drawProperty(e,s,"Height",i.height),s=this.drawProperty(e,s,"Rotation X",i.rotationX),this.drawProperty(e,s,"Rotation Y",i.rotationY)}drawProperty(e,i,s,r){const o=this.x+46,a=585,l=63,u=k(o,i,a,l,5);e.fillStyle="#fff",e.font="normal 100 30px Roboto Medium",e.fillText(s,o,i-20),e.fillStyle="#1a1a1a",e.fill(u),e.fillStyle="#fff",e.font="normal 100 29px Roboto Medium";const d=e.measureText(r.toString()),p=d.fontBoundingBoxAscent+d.fontBoundingBoxDescent;return e.fillText(r,o+19,i+p+8),e.lineWidth=3,e.strokeStyle="#666",e.stroke(u),i+l+76}}class nt extends _{constructor(e,i,s){super();n(this,"_rulerWidth");n(this,"_gridWidth");n(this,"_lineWidth");n(this,"_rulerColor");n(this,"_rulerBackground");n(this,"_rulerHighlight");n(this,"_propertiesWidth");this._gridWidth=30,this._lineWidth=3,this._rulerColor="#333",this._rulerBackground="#111",this._rulerWidth=e,this._propertiesWidth=i,this._rulerHighlight=s,this._rulerHighlight.lineWidth=this._lineWidth,this._rulerHighlight.rulerWidth=this._rulerWidth}onInitialized(){super.onInitialized(),this.set(this.surface),this.width-=this._propertiesWidth}onDraw(e){super.onDraw(e),this.drawBackground(e),this.drawVerticalRuler(e),this.drawHorizontalRuler(e),this.drawBorder(e)}drawHorizontalRuler(e){e.fillStyle=this._rulerColor,e.fillRect(this.x,this.y,this.width,this._rulerWidth),e.fillStyle="white",e.strokeStyle="white",e.lineWidth=this._lineWidth+2,e.beginPath(),e.moveTo(this._rulerWidth,this._rulerWidth),e.lineTo(this._rulerWidth-this.getLineLength(0),this._rulerWidth),e.stroke();let i=0,s=this._rulerWidth;for(;s<this.width;)e.lineWidth=this._lineWidth,i%10===0&&(e.fillText((i*30).toString(),s+10,30),e.lineWidth+=2),e.beginPath(),e.moveTo(s,this._rulerWidth),e.lineTo(s,this._rulerWidth-this.getLineLength(i)),e.stroke(),s+=this._gridWidth,i++}drawVerticalRuler(e){e.fillStyle=this._rulerColor,e.fillRect(this.x,this.y,this._rulerWidth,this.height),e.fillStyle="white",e.strokeStyle="white",e.lineWidth=this._lineWidth;let i=0,s=this._rulerWidth;for(;s<this.height;){if(e.lineWidth=this._lineWidth,i%10===0){let r=s+31;Array.from(String(i*30),Number).forEach(o=>{e.fillText(o.toString(),10,r),r+=28}),e.lineWidth+=2}e.beginPath(),e.moveTo(this._rulerWidth,s),e.lineTo(this._rulerWidth-this.getLineLength(i),s),e.stroke(),s+=this._gridWidth,i++}}drawBorder(e){e.strokeStyle="white",e.lineWidth=this._lineWidth,e.beginPath(),e.moveTo(this._rulerWidth,this._rulerWidth),e.lineTo(this.width,this._rulerWidth),e.stroke(),e.moveTo(this._rulerWidth,this._rulerWidth),e.lineTo(this._rulerWidth,this.height),e.stroke()}drawBackground(e){e.font="30px Roboto Medium",e.fillStyle=this._rulerBackground,e.fillRect(this.x,this.y,this.width,this.height),e.strokeStyle="white",e.lineWidth=this._lineWidth,e.globalAlpha=.1;let i=this._rulerWidth;for(;i<this.height;)e.beginPath(),e.moveTo(0,i),e.lineTo(this.width,i),e.stroke(),i+=this._gridWidth;for(i=this._rulerWidth;i<this.width;)e.beginPath(),e.moveTo(i,0),e.lineTo(i,this.height),e.stroke(),i+=this._gridWidth;e.globalAlpha=1}getLineLength(e){const i=this._rulerWidth-15;return e%10===0?i:e%5===0?i-10:i-20}}class rt extends S{constructor(e){super();n(this,"_properties");n(this,"_centerX");n(this,"_centerY");n(this,"lineWidth");n(this,"rulerWidth");this._centerX=0,this._centerY=0,this.lineWidth=0,this.rulerWidth=0,this._properties=e}onInitialized(){super.onInitialized(),this.set(this.surface),this.receivePointerInput=!0,this.isHitTestVisible=!1,this.x=this.rulerWidth,this.y=this.rulerWidth,this.width-=this.rulerWidth+this._properties.width,this.height-=this.rulerWidth,this.opacity=0}onUpdate(e){super.onUpdate(e)}onPointerHover(e){super.onPointerHover(e),this._centerX=e.x,this._centerY=e.y}onPointerEnter(e){super.onPointerEnter(e),this.opacity=1}onPointerLeave(e){super.onPointerLeave(e),this.opacity=0}onDraw(e){super.onDraw(e),e.globalAlpha=this.opacity,e.fillStyle="white",e.strokeStyle="white",e.lineWidth=this.lineWidth,e.beginPath(),e.moveTo(this.rulerWidth,this._centerY),e.lineTo(this.rulerWidth-20,this._centerY+15),e.lineTo(this.rulerWidth-20,this._centerY-15),e.fill(),e.moveTo(this._centerX,this.rulerWidth),e.lineTo(this._centerX+15,this.rulerWidth-20),e.lineTo(this._centerX-15,this.rulerWidth-20),e.fill(),e.moveTo(this.rulerWidth,this._centerY),e.lineTo(this.width+this.rulerWidth,this._centerY),e.moveTo(this._centerX,this.rulerWidth),e.lineTo(this._centerX,this.height+this.rulerWidth),e.stroke()}}class ot extends w{constructor(e,i){super(e);n(this,"_rulerHighlight");this._rulerHighlight=i}onInitialized(){super.onInitialized(),this.add(this._rulerHighlight),this.isLoop=!1}}class at extends w{constructor(e,i){super(e);n(this,"_properties");this._properties=i}onInitialized(){super.onInitialized(),this.add(this._properties)}}class lt extends w{constructor(e,i){super(e);n(this,"_ruler");this._ruler=i}onInitialized(){super.onInitialized(),this.add(this._ruler),this.isLoop=!1}}class ut{constructor(){n(this,"selectedElement");this.selectedElement=new re}}class ct{constructor(t){n(this,"_engine");n(this,"_assets");this._engine=t;const e=new W;this._assets=e.create()}async startAsync(){await this._assets.loadImagesAsync();const t=55,e=670,i=new ut,s=new ht(e,i),r=new rt(s),o=new nt(t,e,r),a=new st(o);i.selectedElement=a.elementData,this._engine.add(new lt(this._assets,o)),this._engine.add(new at(this._assets,s)),this._engine.add(new tt(this._assets,a)),this._engine.add(new ot(this._assets,r)),this._engine.start()}}class dt{async initializeAsync(t,e){const i=T.getEngine(t,e);i&&await new ct(i).startAsync()}}class gt extends _{constructor(){super();n(this,"_gridWidth");n(this,"_lineWidth");this.x=140,this.y=170,this.width=800,this.height=800,this._gridWidth=100,this._lineWidth=3}onDraw(e){super.onDraw(e),this.drawBackground(e),this.drawBorder(e),this.drawHorizontalRuler(e),this.drawVerticalRuler(e)}drawBackground(e){e.fillStyle="black",e.globalAlpha=.3,e.fillRect(this.x,this.y,this.width,this.height),e.lineWidth=this._lineWidth,e.font="30px Roboto Medium",e.strokeStyle="white",e.globalAlpha=.1;let i=this.y,s=this.height+this.y;for(;i<=s;)e.beginPath(),e.moveTo(this.x,i),e.lineTo(this.width+this.x,i),e.stroke(),i+=this._gridWidth;for(i=this.x,s=this.width+this.x;i<=s;)e.beginPath(),e.moveTo(i,this.y),e.lineTo(i,this.height+this.y),e.stroke(),i+=this._gridWidth;e.globalAlpha=1}drawBorder(e){e.strokeStyle="white",e.lineWidth=this._lineWidth,e.beginPath(),e.moveTo(this.x,this.y+this.height),e.lineTo(this.x+this.width,this.y+this.height),e.stroke(),e.moveTo(this.x,this.y),e.lineTo(this.x,this.y+this.height),e.stroke()}drawHorizontalRuler(e){e.strokeStyle="white",e.fillStyle="white";let i=0,s=this.x;for(;s<=this.x+this.width;)e.lineWidth=this._lineWidth,i%2===0&&(e.fillText((i*10).toString()+" °C",s+15,this.y+this.height+50),e.lineWidth+=2),e.beginPath(),e.moveTo(s,this.y+this.height),e.lineTo(s,this.y+this.height+this.getLineLength(i)),e.stroke(),s+=this._gridWidth,i++}drawVerticalRuler(e){e.fillStyle="white",e.strokeStyle="white";let i=10,s=this.y;for(;s<=this.y+this.height;)e.lineWidth=this._lineWidth,i%2===0&&(e.fillText((i*10).toString()+" %",this.x-80,s-15),e.lineWidth+=2),e.beginPath(),e.moveTo(this.x,s),e.lineTo(this.x-this.getLineLength(i),s),e.stroke(),s+=this._gridWidth,i--}getLineLength(e){return e%2===0?30:-20}}class _t extends _{constructor(){super();n(this,"text");n(this,"fontSize");n(this,"fontStyle");n(this,"padding");this.text="",this.fontSize=34,this.fontStyle="Roboto Medium",this.padding=20,this.isVisible=!1}onDraw(e){super.onDraw(e),e.font=`${this.fontSize}px ${this.fontStyle}`;const i=e.measureText(this.text),s=i.width,r=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this.width=s+this.padding*2,this.height=r+this.padding*2;const o=k(this.x,this.y,this.width,this.height,5);e.fillStyle="#333",e.fill(o),e.fillStyle="#fff",e.fillText(this.text,this.x+this.padding,this.y+r+this.padding),e.strokeStyle="000",e.lineWidth=3,e.stroke(o)}}class pt extends S{constructor(e,i,s){super();n(this,"_fanService");n(this,"_pressedDiff");n(this,"_step");n(this,"_toolTip");n(this,"_halfSize");n(this,"_position");n(this,"_circleAngle");n(this,"maxY");n(this,"minY");n(this,"color");this._toolTip=i,this._fanService=s,this._step=e,this._halfSize=0,this.width=35,this.height=35,this.maxY=0,this.minY=0,this.color="white",this._circleAngle=2*Math.PI,this._position=new f,this._pressedDiff=new f}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.add(this._toolTip)}onUpdate(e){super.onUpdate(e),this._position.x=this.x+this.width*.5,this._position.y=this.y+this.height*.5,this._halfSize=this.width*.5,this._toolTip.x=this.x+60,this._toolTip.y=this.y-60}onDraw(e){super.onDraw(e),e.fillStyle=this.color,e.strokeStyle="black",e.lineWidth=5,e.beginPath(),e.arc(this._position.x,this._position.y,this._halfSize,0,this._circleAngle),e.fill(),e.stroke()}onPointerEnter(e){super.onPointerEnter(e),this.scale=1.2,this._toolTip.isVisible=!0}onPointerLeave(e){super.onPointerLeave(e),this.scale=1,this._toolTip.isVisible=!1}onPointerPressed(e){super.onPointerPressed(e),this.changeCursor("ns-resize"),this._pressedDiff.x=this.x-e.x,this._pressedDiff.y=this.y-e.y}onPointerMove(e){super.onPointerMove(e);const i=e.y+this._pressedDiff.y;i<this.minY?this.y=this.minY:i>this.maxY?this.y=this.maxY:this.y=e.y+this._pressedDiff.y,this.updateStep()}updateStep(){const i=80/(this.maxY-this.minY),s=100-Math.round((this.y-this.minY)*i);this._fanService.setStep(this._step,s),this._toolTip.text=`${s}%`}}class ft extends _{constructor(e,i){super();n(this,"_fanService");n(this,"_handler");n(this,"_toolTips");n(this,"_handleOffset");n(this,"_maxY");n(this,"_minY");n(this,"_length");this.set(e),this._fanService=i,this._handler=new Array,this._toolTips=new Array;for(let r=0;r<5;r++){const o=i.stepKeys[r],a=new _t;this._handler.push(new pt(o,a,i)),this._toolTips.push(a)}const s=this._handler[0];this._handleOffset=s.width*.5,this._maxY=this.y+this.height-this._handleOffset,this._minY=this.y-this._handleOffset,this._length=this._maxY-this._minY}onInitialized(){super.onInitialized(),this.add(...this._handler),this.x-=this._handleOffset,this.y-=this._handleOffset,this.width+=this._handleOffset*2,this.height+=this._handleOffset*2;const i=this._length/80*100;for(let s=0;s<this._handler.length;s++){const r=this._handler[s],o=this._fanService.stepKeys[s],a=this._fanService.steps.get(o);r.x=this.x+200*s,r.y=this._minY+i-a*.01*i,r.maxY=this._maxY,r.minY=this._minY,r.updateStep(),s===2&&(r.color="yellow")}this._toolTips.forEach(s=>this.add(s))}onDraw(e){super.onDraw(e);const i=this._handler[0];let s=i.x+i.width*.5,r=i.y+i.height*.5;e.lineWidth=5,e.strokeStyle="red",e.fillStyle="red",e.beginPath(),e.moveTo(s,r),this._handler.forEach(o=>{s=o.x+o.width*.5,r=o.y+o.height*.5,e.lineTo(s,r)}),e.stroke(),r=this.y+this.height-i.height*.5,e.lineTo(s,r),s=this.x+i.height*.5,e.lineTo(s,r),e.closePath(),e.globalAlpha=.2,e.fill()}}class yt extends _{constructor(e){super();n(this,"_fanService");this._fanService=e}onInitialized(){var i;super.onInitialized(),this.setImage("fan-wheel.png");const e=(i=this._imageSource)==null?void 0:i.image;e&&(this.width=e.width*1.4,this.height=e.height*1.4,this.x=this.surface.width-(this.width+110),this.y=this.surface.height*.5-this.height*.5+25)}onUpdate(e){super.onUpdate(e),this.rotateTo(e,this._fanService.speed)}}class mt extends _{constructor(e,i){super();n(this,"_fanService");n(this,"_fanWheel");n(this,"_fanBackgroundPosition");n(this,"_fanBackgroundSize");n(this,"_circleAngle");this._fanService=i,this._fanWheel=e,this._fanBackgroundPosition=new f,this._fanBackgroundSize=0,this._circleAngle=2*Math.PI}onInitialized(){super.onInitialized()}onUpdate(e){super.onUpdate(e),this._fanBackgroundPosition.x=this._fanWheel.x+this._fanWheel.width*.5,this._fanBackgroundPosition.y=this._fanWheel.y+this._fanWheel.height*.5,this._fanBackgroundSize=this._fanWheel.width/1.9}onDraw(e){super.onDraw(e),this.drawTorqueBar(e),this.drawTemperatureBar(e),this.drawBackground(e),this.drawText(e)}drawBackground(e){e.fillStyle="#333333",e.strokeStyle="#000000",e.lineWidth=5,e.beginPath(),e.arc(this._fanBackgroundPosition.x,this._fanBackgroundPosition.y,this._fanBackgroundSize,0,this._circleAngle),e.fill(),e.stroke(),e.beginPath(),e.arc(this._fanBackgroundPosition.x,this._fanBackgroundPosition.y,this._fanBackgroundSize/6,0,this._circleAngle),e.fillStyle="black",e.globalAlpha=.5,e.fill(),e.strokeStyle="#666",e.globalAlpha=1,e.stroke()}drawText(e){e.globalAlpha=1,e.fillStyle="white",e.font="34px Roboto Medium";const i=`${this._fanService.temperature} °C`,s=`${this._fanService.torque} rpm`,r=e.measureText(i),o=e.measureText(s),a=r.width,l=o.width,u=r.fontBoundingBoxAscent+r.fontBoundingBoxDescent,d=this._fanWheel.x+this._fanWheel.width-l+50,p=this._fanWheel.y-30;e.fillText(s,d,p);const x=this._fanWheel.x+this._fanWheel.width-a+50,oe=this._fanWheel.y+this._fanWheel.height+u-25;e.fillText(i,x,oe)}drawTemperatureBar(e){const i=this._fanWheel.x,s=this._fanWheel.y+this._fanWheel.height+65,r=this._fanWheel.width,o=40,a=(r-35)*this._fanService.urgency*.01,l=k(i-10,s-10,r+20,o+20,5);e.fillStyle="black",e.globalAlpha=.3,e.fill(l);const u=e.createLinearGradient(i,s,i+r,s);u.addColorStop(.4,"limegreen"),u.addColorStop(.6,"yellow"),u.addColorStop(.9,"red"),e.globalAlpha=.8,e.fillStyle=u,e.fillRect(i+5,s+5,a-10,o-10),e.lineWidth=3,e.strokeStyle="#666",e.globalAlpha=1,e.stroke(l)}drawTorqueBar(e){const i=this._fanBackgroundPosition.x,s=this._fanBackgroundPosition.y;let r=this._fanBackgroundSize+60,o=r,a=2*Math.PI/2,l=a+Math.PI/1.44;e.beginPath(),e.moveTo(i,s),e.arc(i,s,o,a,l),e.closePath(),e.fillStyle="black",e.globalAlpha=.3,e.fill(),e.strokeStyle="#666",e.globalAlpha=1,e.lineWidth=3,e.stroke(),e.setLineDash([32.3,15]),r=this._fanBackgroundSize+29,o=r,a=2.025*Math.PI/2;const u=2.1/this._fanService.torqueMax,d=this._fanService.torque*u;e.beginPath(),e.arc(i,s,o,a,a+d);const p=e.createLinearGradient(1100,0,1600,0);p.addColorStop(0,"limegreen"),p.addColorStop(.7,"yellow"),p.addColorStop(1,"red"),e.strokeStyle=p,e.globalAlpha=.8,e.lineWidth=32,e.stroke(),e.setLineDash([])}}class wt extends _{constructor(e){super();n(this,"_fanCruve");this._fanCruve=e}onInitialized(){super.onInitialized(),this.set(this.surface),this.add(this._fanCruve)}onDraw(e){super.onDraw(e),e.fillStyle="#1b1b1b",e.fillRect(this.x,this.y,this.width,this.height),e.fillStyle="#333333",e.strokeStyle="#333333",e.lineWidth=10,e.strokeRect(this.x,this.y,this.width,this.height),e.fillStyle="#ffffff",e.font="48px Material Icons",e.fillText("",60,88),e.font="36px Roboto Medium",e.fillText("Fan Curve Settings",130,78)}}class vt extends w{constructor(e,i){super(e);n(this,"_fanCurve");this._fanCurve=i}onInitialized(){super.onInitialized(),this.add(new wt(this._fanCurve)),this.isLoop=!1}}class bt extends w{constructor(e,i,s){super(e);n(this,"_fanCurveArea");n(this,"_fanWheelArea");this._fanCurveArea=i,this._fanWheelArea=s}onInitialized(){super.onInitialized(),this.add(this._fanWheelArea,this._fanCurveArea),this.isLoop=!1}}class St extends w{constructor(e,i){super(e);n(this,"_fanWheel");this._fanWheel=i}onInitialized(){super.onInitialized(),this.add(this._fanWheel)}}class Pt{constructor(){n(this,"_speed");n(this,"_torque");n(this,"_torqueMax");n(this,"_temperature");n(this,"_urgency");n(this,"_steps");n(this,"_stepKeys");this._speed=2,this._torque=800,this._torqueMax=1500,this._urgency=0,this._temperature=50,this._stepKeys=new Array,this._stepKeys.push(0),this._stepKeys.push(20),this._stepKeys.push(40),this._stepKeys.push(60),this._stepKeys.push(80),this._steps=new Map,this._steps.set(this._stepKeys[0],50),this._steps.set(this._stepKeys[1],50),this._steps.set(this._stepKeys[2],55),this._steps.set(this._stepKeys[3],65),this._steps.set(this._stepKeys[4],90)}get speed(){return this._speed}get torque(){return this._torque}get torqueMax(){return this._torqueMax}get temperature(){return this._temperature}get urgency(){return this._urgency}get steps(){return this._steps}get stepKeys(){return this._stepKeys}setStep(t,e){this.steps.has(t)&&(this._steps.set(t,e),this.update())}update(){const t=this._stepKeys[2],e=this._steps.get(t),i=10*.01,s=this._torqueMax*.01,r=80*.01,o=1.25;this._speed=e*i,this._torque=e*s,this._temperature=100-Math.round(e*r),this._urgency=this._temperature*o}}class Et{constructor(t){n(this,"_engine");n(this,"_assets");this._engine=t;const e=new W;this._assets=e.create(),this._assets.addImage("./assets/fan/images/fan-wheel.png")}async startAsync(){await this._assets.loadImagesAsync();const t=new Pt,e=new gt,i=new ft(e,t),s=new yt(t),r=new mt(s,t);this._engine.add(new vt(this._assets,e)),this._engine.add(new bt(this._assets,i,r)),this._engine.add(new St(this._assets,s)),this._engine.start()}}class Tt{async initializeAsync(t,e){const i=T.getEngine(t,e);i&&await new Et(i).startAsync()}}window.addEventListener("load",async()=>{await xt();const h=new URLSearchParams(window.location.search);let t=h.has("games"),e=h.has("apps");!t&&!e&&(t=!0,e=!0),t&&G("first-row-disabled"),e&&G("second-row-disabled");const i=new Array;t!==null&&i.push(new Promise(()=>new $e().initializeAsync("pong",window)),new Promise(()=>new et().initializeAsync("street",window))),e!==null&&i.push(new Promise(()=>new Tt().initializeAsync("fan",window)),new Promise(()=>new dt().initializeAsync("ruler",window))),await Promise.all(i)});async function xt(){const h=new FontFace("Roboto Medium","url(./fonts/roboto-fontface/fonts/roboto/Roboto-Medium.woff)"),t=new FontFace("Material Icons","url(./fonts/material-icons/iconfont/material-icons.woff)"),e=new FontFace("Roboto Medium","url(./fonts/roboto-fontface/fonts/roboto/Roboto-Medium.woff2)"),i=new FontFace("Material Icons","url(./fonts/material-icons/iconfont/material-icons.woff2)");await Promise.all([h.load(),t.load(),e.load(),i.load()])}function G(h){Array.from(document.getElementsByClassName(h)).forEach(e=>e.classList.remove(h))}
