(()=>{"use strict";class t extends EventTarget{get frameRate(){return this._frameRate}set frameRate(e){if(this._frameRate===e)return;this._frameRate=e;const i=new Event(t.frameRateChangeEvent);this.dispatchEvent(i)}get frameLimit(){return this._frameLimit}set frameLimit(e){if(this._frameLimit===e)return;this._frameLimit=e;const i=new Event(t.frameLimitChangeEvent);this.dispatchEvent(i)}get targetResolution(){return this._targetResolution}set targetResolution(e){if(this._targetResolution.x===e.x&&this._targetResolution.y===e.y)return;this._targetResolution=e;const i=new Event(t.targetResolutionChangeEvent);this.dispatchEvent(i)}get maxResolution(){return this._maxResolution}set maxResolution(e){var i,s;if((null===(i=this._maxResolution)||void 0===i?void 0:i.x)===(null==e?void 0:e.x)&&(null===(s=this._maxResolution)||void 0===s?void 0:s.y)===(null==e?void 0:e.y))return;this._maxResolution=e;const n=new Event(t.maxResolutionChangeEvent);this.dispatchEvent(n)}constructor(t,e,i,s){super(),this._frameRate=t,this._frameLimit=e,this._targetResolution=i,this._maxResolution=s}}t.frameRateChangeEvent="frameratechange",t.frameLimitChangeEvent="framelimitchange",t.targetResolutionChangeEvent="targetresolutionchange",t.maxResolutionChangeEvent="maxresolutionchange";class e extends EventTarget{constructor(t=0,e=0){super(),this.x=t,this.y=e}}class i extends e{constructor(t=0,e=0,i=0,s=0){super(t,e),this.width=i,this.height=s}}i.prototype.set=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},i.prototype.getScale=function(t){const e=this.width/t.width,i=this.height/t.height;return e<i?e:i},i.prototype.getCenter=function(t){const i=new e;return i.x=t.x+.5*t.width-.5*this.width,i.y=t.y+.5*t.height-.5*this.height,i},i.prototype.getRight=function(){return this.x+this.width},i.prototype.getBottom=function(){return this.y+this.height},i.prototype.getTopRight=function(){return new e(this.x+this.width,this.y)},i.prototype.getBottomRight=function(){return new e(this.x+this.width,this.y+this.height)},i.prototype.getBottomLeft=function(){return new e(this.x,this.y+this.height)},i.prototype.intersectTop=function(t){return this.y<=t.y+t.height},i.prototype.intersectBottom=function(t){return this.y+this.height>=t.y},i.prototype.intersectLeft=function(t){return this.x<=t.x+t.width},i.prototype.intersectRight=function(t){return this.x+this.width>=t.x},i.prototype.intersectsWith=function(t){return this.intersectLeft(t)&&this.intersectRight(t)&&this.intersectTop(t)&&this.intersectBottom(t)},i.prototype.contains=function(t){return 0!==this.width&&0!==this.height&&this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},i.prototype.combine=function(t){if(0===this.width||0===this.height||0===t.width||0===t.height)return t;const e=this.getBottomLeft(),s=t.getBottomLeft(),n=this.getBottomRight(),h=t.getBottomRight(),o=e.y>s.y?e.y:s.y,r=n.x>h.x?n.x:h.x,a=new i;return a.x=this.x<t.x?this.x:t.x,a.y=this.y<t.y?this.y:t.y,a.width=r-a.x,a.height=o-a.y,a},e.prototype.set=function(t){this.x=t.x,this.y=t.y},e.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.getNormalize=function(){const t=this.getLength(),i=new e;return 0!=this.x&&(i.x=this.x/t),0!=this.y&&(i.y=this.y/t),i},e.prototype.getScalar=function(t){return this.x*t.x+this.y*t.y};class s extends e{constructor(t=0,e=0,i=0){super(t,e),this.z=i}}s.prototype.set=function(t){this.x=t.x,this.y=t.y,this.z=t.z},s.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},s.prototype.getNormalize=function(){const t=this.getLength(),e=new s;return 0!=this.x&&(e.x=this.x/t),0!=this.y&&(e.y=this.y/t),0!=this.z&&(e.z=this.z/t),e},s.prototype.getScalar=function(t){return this.x*t.x+this.y*t.y+this.z*t.z};class n extends i{get children(){return this._children}constructor(){super(),this._children=new Array}add(...t){t.forEach((t=>{this._children.push(t),this.initializeChild(t)}))}insert(t,...e){return!(t<0||t>=this._children.length||this._children.length<1||(e.forEach((e=>{this._children.splice(t,0,e),this.initializeChild(e)})),0))}remove(...t){t.forEach((t=>{const e=this._children.indexOf(t);e<0||e>=this._children.length||(this._children.splice(e,1),this.destroyChild(t))}))}destroy(){this._children.forEach((t=>this.destroyChild(t)))}}class h extends Event{get style(){return this._style}constructor(t,e,i){super(e,i),this._style=t}}class o extends n{constructor(){super(),this._onInvalidate=()=>this.invalidate(),this._onRefresh=()=>this.refresh(),this._onChangeCursor=t=>this.changeCursor(t.style)}invalidate(){this.dispatchEvent(new Event(o.invalidateEvent))}refresh(){this.dispatchEvent(new Event(o.refreshEvent))}changeCursor(t){this.dispatchEvent(new h(t,o.changeCursorEvent))}initializeChild(t){t.addEventListener(o.invalidateEvent,this._onInvalidate),t.addEventListener(o.refreshEvent,this._onRefresh),t.addEventListener(o.changeCursorEvent,this._onChangeCursor)}destroyChild(t){t.removeEventListener(o.invalidateEvent,this._onInvalidate),t.removeEventListener(o.refreshEvent,this._onRefresh),t.removeEventListener(o.changeCursorEvent,this._onChangeCursor),t.destroy()}}o.invalidateEvent="invalidate",o.refreshEvent="refresh",o.changeCursorEvent="changecursor";class r extends o{get isActive(){return this._isActive}set isActive(t){this._isActive!==t&&(this._isActive=t,this.isActiveChanged(t))}get isVisible(){return this._isVisible}set isVisible(t){this._isVisible!==t&&(this._isVisible&&(this._isEnabledVisible=this._isEnabled),this._isVisible=t,this.isEnabled=t?this._isEnabledVisible:t,this.isVisibleChanged(t))}get isEnabled(){return this._isEnabled}set isEnabled(t){this._isEnabled!==t&&(this._isEnabled=t,this.isEnabledChanged(t))}constructor(){super(),this._isActive=!0,this._isVisible=!0,this._isEnabled=!0,this._isEnabledVisible=!0}}class a extends r{constructor(){super(),this._hitBoxOffsetX=0,this._hitBoxOffsetY=0,this._drawHitBox=!1,this._lastHitBox=new i,this.zIndex=0,this.opacity=1,this.scale=1,this.velocity=0,this.rotation=0,this.hitBox=new i,this.direction=new e,this.transformOrigin=new e(.5,.5)}isActiveChanged(t){this.children.forEach((e=>e.isActive=t))}isVisibleChanged(t){this.children.forEach((e=>e.isVisible=t))}isEnabledChanged(t){this.children.forEach((e=>e.isEnabled=t))}}class d extends Error{constructor(t){super(`InvalidOperation: ${t}.`)}}class l extends d{constructor(t){super(`${t} is not initialized`)}}class c extends a{get assets(){if(!this._assets)throw new l("Entity");return this._assets}get surface(){if(!this._surface)throw new l("Entity");return this._surface}initialize(t,e){this._assets=t,this._surface=e,this.onInitialized()}update(t){if(this.hitBox&&(this._lastHitBox=this.setHitBox(this._hitBoxOffsetX,this._hitBoxOffsetY)),this.onUpdate(t),this.hitBox){const t=this.setHitBox(this._hitBoxOffsetX,this._hitBoxOffsetY);this.hitBox=this._lastHitBox.combine(t)}}collision(...t){this.onCollision(...t)}draw(t){var e;if(!this.isVisible)return;const i=this.x+this.width*this.transformOrigin.x,s=this.y+this.height*this.transformOrigin.y;t.save(),t.globalAlpha=this.opacity,t.translate(i,s),t.scale(this.scale,this.scale),t.rotate(this.rotation*Math.PI/180),t.translate(-i,-s),(null===(e=this._imageSource)||void 0===e?void 0:e.image)&&t.drawImage(this._imageSource.image,this.x,this.y,this.width,this.height),this.onDraw(t),t.restore(),this._drawHitBox&&(t.save(),t.strokeStyle="red",t.strokeRect(this.hitBox.x,this.hitBox.y,this.hitBox.width,this.hitBox.height),t.restore())}getCalculatedValue(t,e){return!this.surface||t.fps<=0?0:e/t.fps*this.surface.settings.frameRate}hitTest(t){return t=this.getLocalPositionBounds(t),this.hitBox.contains(t)}destroy(){super.destroy(),this.onDestroy()}initializeChild(t){super.initializeChild(t),t.initialize(this.assets,this.surface)}setHitBox(t,e){return this._hitBoxOffsetX=t,this._hitBoxOffsetY=e,this.hitBox=new i,this.hitBox.x=this.x+this._hitBoxOffsetX,this.hitBox.y=this.y+this._hitBoxOffsetY,this.hitBox.width=this.width-2*this._hitBoxOffsetX,this.hitBox.height=this.height-2*this._hitBoxOffsetY,this.hitBox}getLocalPositionBounds(t){if(Array.isArray(t)){const e=new Array;return t.forEach((t=>{const i=this.getLocalPositionBounds(t);e.push(i)})),e}const e=this.surface.clientBounds,s=this.surface.width/e.width,n=this.surface.height/e.height,h=new i;return h.x=(t.x-e.x)*s,h.y=(t.y-e.y)*n,h}setAudio(t,e=1,i=!1){return this._audioSource=this.assets.getAudio(t),this._audioSource&&(this._audioSource.loop=i,this._audioSource.volume=this.assets.isAudioMuted?0:e,this._audioSource.loop&&this._audioSource.isPlaying||this._audioSource.play()),this._audioSource}setImage(t){return this._imageSource=this.assets.getImage(t),this._imageSource}isActiveChanged(t){super.isActiveChanged(t),this.onIsActiveChanged(t)}isVisibleChanged(t){super.isVisibleChanged(t),this.onVisibleChanged(this.isEnabled)}isEnabledChanged(t){super.isEnabledChanged(t),this.onEnabledChanged(t)}onInitialized(){}onIsActiveChanged(t){}onVisibleChanged(t){}onEnabledChanged(t){}onUpdate(t){}onCollision(...t){}onDraw(t){}onDestroy(){}}c.prototype.moveX=function(t,e){this.x+=this.getCalculatedValue(t,e)},c.prototype.moveY=function(t,e){this.y+=this.getCalculatedValue(t,e)},c.prototype.scaleTo=function(t,e){this.scale+=this.getCalculatedValue(t,e)},c.prototype.rotateTo=function(t,e){this.rotation+=this.getCalculatedValue(t,e)};class u{get start(){return this._start}get end(){return this._end}get delta(){return this._delta}get fps(){return this._fps}constructor(t,e){this._start=t,this._end=e,this._delta=e-t,this._fps=this._delta>0?1/(.001*this._delta):0}}class _ extends n{get isActive(){return this._isActive}constructor(t,e){super(),this._isActive=!1,this._window=e,this._surfaceSettings=t}start(){this._isActive||(this._isActive=!0,this.request(0))}stop(){this._isActive=!1}destroy(){super.destroy(),this.stop()}request(t){this._window.requestAnimationFrame((e=>{const i=new u(t,e);this.loop(i)}))}loop(t){const e=this._surfaceSettings,i=e.frameLimit>0?1e3/e.frameLimit:t.delta;if(Math.round(i-t.delta)<=0)return this.children.forEach((e=>e.update(t))),void(this._isActive&&this.request(t.end));this._isActive&&this.request(t.start)}}class g extends _{constructor(t,e,i,s,n){super(t,n),this._contextFactory=i,this._surfaceFactory=e,this._input=s.create(this)}initializeChild(t){const e=this._surfaceFactory.create(this._contextFactory);t.initialize(e,this._input)}destroyChild(t){t.destroy()}}class p{}class y extends p{constructor(t,e){super(),this._document=e,this._engineCanvas=t,this._engineCanvas.style.width="100%",this._engineCanvas.style.height="100%",this._shadowRoot=this._engineCanvas.attachShadow({mode:"closed"});const i=this._document.createElement("div");i.style.width="100%",i.style.height="100%",i.tabIndex=0,this._shadowRoot.innerHTML="<style>div:focus{outline: none;}</style>",this._shadowRoot.appendChild(i)}create(){var t;const e=this._document.createElement("canvas");return e.style.position="absolute",e.style.pointerEvents="none",null===(t=this._shadowRoot.lastChild)||void 0===t||t.appendChild(e),e.getContext("2d")}}function f(t){t.destroy&&t.destroy()}class v{constructor(t,e){this._engineCore=t,this._inputReceiver=e,this._inputTypes=new Map}add(t,e){this._inputTypes.set(t,e),e.initialize(this._engineCore,this._inputReceiver)}get(t){return this._inputTypes.get(t)}remove(t){const e=this._inputTypes.get(t);e&&(f(e),this._inputTypes.delete(t))}clear(){this._inputTypes.forEach((t=>f(t))),this._inputTypes.clear()}refresh(){this._inputTypes.forEach((t=>{var e;(e=t).refresh&&e.refresh()}))}destroy(){this.clear()}}class m extends Event{get positions(){return this._positions}constructor(t,e,i){super(e,i),this._positions=t}}class w extends Event{get position(){return this._position}constructor(t,e,i){super(e,i),this._position=t}}class x extends KeyboardEvent{get focused(){return this._focused}constructor(t,e,i){super(e,i),this._focused=t}}class b extends EventTarget{constructor(t){super(),this._engineCanvas=t;const e=this._engineCanvas.ownerDocument.defaultView;this._keyEvent=t=>this.onKey(t),this._mouseEvent=t=>this.onMouse(t),this._touchEvent=t=>this.onTouch(t),e.addEventListener("keydown",this._keyEvent),e.addEventListener("keyup",this._keyEvent),this._engineCanvas.addEventListener("keydown",this._keyEvent),this._engineCanvas.addEventListener("keyup",this._keyEvent),this._engineCanvas.addEventListener("mousedown",this._mouseEvent),this._engineCanvas.addEventListener("mouseup",this._mouseEvent),this._engineCanvas.addEventListener("mousemove",this._mouseEvent),this._engineCanvas.addEventListener("mouseleave",this._mouseEvent),this._engineCanvas.addEventListener("touchstart",this._touchEvent,!1),this._engineCanvas.addEventListener("touchend",this._touchEvent,!1),this._engineCanvas.addEventListener("touchcancel",this._touchEvent,!1),this._engineCanvas.addEventListener("touchmove",this._touchEvent,!1)}destroy(){const t=this._engineCanvas.ownerDocument.defaultView;t.removeEventListener("keydown",this._keyEvent),t.removeEventListener("keyup",this._keyEvent),this._engineCanvas.removeEventListener("keydown",this._keyEvent),this._engineCanvas.removeEventListener("keyup",this._keyEvent),this._engineCanvas.removeEventListener("mousedown",this._mouseEvent),this._engineCanvas.removeEventListener("mouseup",this._mouseEvent),this._engineCanvas.removeEventListener("mousemove",this._mouseEvent),this._engineCanvas.removeEventListener("mouseleave",this._mouseEvent),this._engineCanvas.removeEventListener("touchstart",this._touchEvent,!1),this._engineCanvas.removeEventListener("touchend",this._touchEvent,!1),this._engineCanvas.removeEventListener("touchcancel",this._touchEvent,!1),this._engineCanvas.removeEventListener("touchmove",this._touchEvent,!1)}onKey(t){const e=this._engineCanvas.ownerDocument.activeElement===this._engineCanvas;e&&t.currentTarget instanceof Window||this.dispatchEvent(new x(e,t.type,t))}onMouse(t){const e=new i(t.clientX,t.clientY);this.dispatchEvent(new w(e,t.type,t))}onTouch(t){const e=this.getTouchPositions(t.changedTouches);this.dispatchEvent(new m(e,t.type,t))}getTouchPositions(t){const e=new Array,s=Array.from(t);for(let t of s){const s=new i(t.clientX,t.clientY);e.push(s)}return e}}class E{get engineCore(){if(!this._engineCore)throw new l("EngineCore");return this._engineCore}get inputReceiver(){if(!this._inputReceiver)throw new l("InputReceiver");return this._inputReceiver}initialize(t,e){this._inputReceiver=e,this._engineCore=t}}class P extends E{constructor(t){super(),this._hoveredEntity=null,this._pressedEntity=null,this._pointerPostion=new i,this._engineCanvas=t,this._mouseDown=t=>this.onPointerDown(t),this._mouseUp=t=>this.onPointerUp(t),this._mouseMove=t=>this.onPointerMove(t),this._mouseLeave=t=>this.onPointerLeave(t),this._touchStart=t=>this.onTouchStart(t),this._touchMove=t=>this.onTouchMove(t),this._touchEnd=t=>this.onTouchEnd(t)}initialize(t,e){super.initialize(t,e),this.inputReceiver.addEventListener("mousedown",this._mouseDown),this.inputReceiver.addEventListener("mouseup",this._mouseUp),this.inputReceiver.addEventListener("mousemove",this._mouseMove),this.inputReceiver.addEventListener("mouseleave",this._mouseLeave),this.inputReceiver.addEventListener("touchstart",this._touchStart),this.inputReceiver.addEventListener("touchmove",this._touchMove),this.inputReceiver.addEventListener("touchcancel",this._touchEnd),this.inputReceiver.addEventListener("touchend",this._touchEnd)}destroy(){this.inputReceiver.removeEventListener("mousedown",this._mouseDown),this.inputReceiver.removeEventListener("mouseup",this._mouseUp),this.inputReceiver.removeEventListener("mousemove",this._mouseMove),this.inputReceiver.removeEventListener("mouseleave",this._mouseLeave),this.inputReceiver.removeEventListener("touchstart",this._touchStart),this.inputReceiver.removeEventListener("touchmove",this._touchMove),this.inputReceiver.removeEventListener("touchcancel",this._touchEnd),this.inputReceiver.removeEventListener("touchend",this._touchEnd)}setStyle(t){const e=this._engineCanvas;"default"===t?(e.style.removeProperty("cursor"),e.getAttribute("style")||e.removeAttribute("style")):e.style.cursor=t}refresh(){this.onPointerUpdate(this._pointerPostion)}onPointerDown(t){this.pressed(this._hoveredEntity,t.position)}onPointerUp(t){this.tapped(this._hoveredEntity,t.position)}onPointerMove(t){this.onPointerUpdate(t.position)}onPointerLeave(t){this.onPointerExit(t.position)}onTouchStart(t){t.positions.forEach((e=>{var i;this.onPointerUpdate(e)&&(this.pressed(this._hoveredEntity,e,!0),null===(i=this._hoveredEntity)||void 0===i||i.touchStart(t.positions))}))}onTouchMove(t){t.positions.forEach((t=>{this.onPointerUpdate(t)}))}onTouchEnd(t){t.positions.forEach((t=>this.tapped(this._hoveredEntity,t))),this.removeHoveredEntity(this._hoveredEntity,this._pointerPostion)}onPointerUpdate(t){let e=!1;this._pointerPostion=t;let i=this.engineCore.children;i=[...i].reverse();for(const s of i)s.isVisible&&s.isEnabled&&(this.moveEnitities(s.children,t),this.updateEntities(s.children,e,t)&&(e=!0));return e||this.removeHoveredEntity(this._hoveredEntity,t),e}moveEnitities(t,e){t.forEach((t=>{var i;const s=t;null!==(i=null==s?void 0:s.receivePointerInput)&&void 0!==i&&i&&this.move(s,e),this.moveEnitities(t.children,e)}))}updateEntities(t,e,i){const s=[...t].reverse();for(const t of s)this.updateEntity(t,e,i)&&(e=!0);return e}updateEntity(t,e,i){var s;const n=t,h=null!==(s=null==n?void 0:n.receivePointerInput)&&void 0!==s&&s;if(this.isHovered(t,i)){if(!e)return this.addHoveredEntity(t,e,i)}else h&&n.isHovered&&(n.isHitTestVisible||this.leave(n,i));return!1}addHoveredEntity(t,e,i){var s,n,h;let o=this.updateEntities(t.children,e,i);if(o)return o;const r=t,a=null!==(s=null==r?void 0:r.receivePointerInput)&&void 0!==s&&s,d=null!==(h=null===(n=this._hoveredEntity)||void 0===n?void 0:n.isPointerPressed)&&void 0!==h&&h;return a&&!o&&(r.isHitTestVisible&&!d&&(r!==this._hoveredEntity&&(this.removeHoveredEntity(this._hoveredEntity,i),this.setPointerStyle(r,!0),this._hoveredEntity=r),o=!0),r.isHovered=!0,this.hover(r,!0,d,i)),o}removeHoveredEntity(t,e){!(null==t?void 0:t.isPointerEntered)||t.isEnabled&&t.isPointerPressed||(t.isHovered=!1,this.setPointerStyle(t,!1),this.hover(t,!1,!1,e),this._hoveredEntity=null)}onPointerExit(t){this.engineCore.children.forEach((e=>this.exitEntities(e.children,t)))}exitEntities(t,e){t.forEach((t=>{var i;const s=t,n=null!==(i=null==s?void 0:s.receivePointerInput)&&void 0!==i&&i;this.exitEntities(s.children,e),n&&s.isHovered&&this.leave(s,e)}))}hover(t,e,i,s){if(t)return e||t.isPointerPressed?(t.isPointerEntered||i||(t.isPointerEntered=!0,t.pointerEnter(s)),void t.pointerHover(s)):void(t.isPointerEntered&&(t.isPointerEntered=!1,t.pointerLeave(s)))}move(t,e){t&&t.isEnabled&&t.isPointerPressed&&t.pointerMove(e)}pressed(t,e,i=!1){if(!t)return;const s=this.isHovered(t,e),n=i&&t.isTouchHitBoxDisabled;t.isEnabled&&(n||s)&&(this._pressedEntity=t,this._pressedEntity.isPointerPressed=!0,this._pressedEntity.pointerPressed(e))}tapped(t,e){if(!t){if(!this._pressedEntity)return;t=this._pressedEntity}const i=this.isHovered(t,e),s=t.isPointerPressed;(i||s)&&t.pointerTapped(e),t.isPointerPressed=!1,t.pointerReleased(e),this.removeHoveredEntity(t,e),i&&this.onPointerUpdate(this._pointerPostion)}leave(t,e){t&&(t.isPointerPressed=!1,this.removeHoveredEntity(t,e))}isHovered(t,e){return!!t&&t.isEnabled&&t.hitTest(e)}setPointerStyle(t,e){!(null==t?void 0:t.isHitTestVisible)||t.isEnabled&&t.isPointerPressed||this.setStyle(e&&t.isEnabled?"pointer":"default")}}class S extends E{constructor(){super(),this._keyUp=t=>this.onKeyboardEventUp(t),this._keyDown=t=>this.onKeyboardEventDown(t)}initialize(t,e){super.initialize(t,e),this.inputReceiver.addEventListener("keydown",this._keyDown),this.inputReceiver.addEventListener("keyup",this._keyUp)}destroy(){this.inputReceiver.removeEventListener("keydown",this._keyDown),this.inputReceiver.removeEventListener("keyup",this._keyUp)}onKeyboardEventDown(t){const e=this.engineCore.children;this.updateScenes(e,(e=>e.keyDown(t)))}onKeyboardEventUp(t){const e=this.engineCore.children;this.updateScenes(e,(e=>e.keyUp(t)))}updateScenes(t,e){for(const i of t)i.isVisible&&i.isEnabled&&this.updateEntities(i.children,e)}updateEntities(t,e){var i;for(const s of t){const t=s,n=null!==(i=t.receiveKeyboardInput)&&void 0!==i&&i;this.updateEntities(s.children,e),n&&e(t)}}}class T extends p{constructor(t){super(),this._engineCanvas=t,this._inputReceiver=new b(t)}create(t){if(!t)throw new d("IEngineCore is needed for creation.");const e=new v(t,this._inputReceiver);return e.add("Pointer",new P(this._engineCanvas)),e.add("Keyboard",new S),e}}class C extends i{get context2d(){return this._context2d}get settings(){return this._settings}get clientBounds(){return this._clientBounds}constructor(t){super(0,0,t.targetResolution.x,t.targetResolution.y),this._settings=t,this._clientBounds=new i,this._update=()=>this.update()}initialize(e,i){this._window=i,this._context2d=e,this._window.addEventListener("resize",this._update),this._window.addEventListener("orientationchange",this._update),this._settings.addEventListener(t.maxResolutionChangeEvent,this._update),this.update()}update(){const t=this._context2d.canvas,e=t.parentElement.getBoundingClientRect(),s=this._window.devicePixelRatio>2?2:this._window.devicePixelRatio,n=new i(e.x,e.y,e.width,e.height),h=new i(0,0,this.width,this.height),o=n.getScale(h),r=new i(0,0,this.width*o,this.height*o),a=r.getCenter(n);t.style.left=`${a.x}px`,t.style.top=`${a.y}px`,t.style.width=`${r.width}px`,t.style.height=`${r.height}px`,s<=1?(t.width=this.width,t.height=this.height,this._context2d.setTransform(1,0,0,1,0,0)):(t.width=this.width*s,t.height=this.height*s,this._context2d.setTransform(s,0,0,s,0,0));const d=this._settings.maxResolution;d&&d.x>0&&d.y>0&&(t.width=t.width>d.x?d.x:t.width,t.height=t.height>d.y?d.y:t.height);const l=t.getBoundingClientRect();this._clientBounds.x=l.x,this._clientBounds.y=l.y,this._clientBounds.width=l.width,this._clientBounds.height=l.height,this.dispatchEvent(new Event(C.surfaceChangeEvent))}clear(){this._context2d&&this._context2d.clearRect(0,0,this.width,this.height)}destroy(){this._window.removeEventListener("resize",this._update),this._window.removeEventListener("orientationchange",this._update),this._settings.removeEventListener(t.maxResolutionChangeEvent,this._update)}}C.surfaceChangeEvent="surfacechange";class L extends p{constructor(t,e){super(),this._window=e,this._surfaceSettings=t}create(t){if(!t)throw new d("IFactoryContext is needed for creation.");const e=new C(this._surfaceSettings),i=t.create();return e.initialize(i,this._window),e}}class k extends HTMLElement{static getCanvas(t,e){return this.connectCanvas(e),this._window.document.getElementById(t)}static getEngine(t,e){this.connectCanvas(e);const i=k.getCanvas(t,e);return null==i?void 0:i._engineCore}static connectCanvas(t){t&&this._window!==t&&(this._window=t,t.customElements.define("engine-canvas",this))}connectedCallback(){const t=k._window;this.initializeEngine(t)}disconnectedCallback(){var t;null===(t=this._engineCore)||void 0===t||t.destroy(),this.replaceChildren()}initializeEngine(i){const s=this.getAttributeValue("target-frame-rate",60),n=this.getAttributeValue("target-frame-limit",0),h=this.getAttributeValue("target-resolution",new e(1920,1080)),o=this.getAttributeValue("max-resolution",new e),r=new T(this),a=new y(this,i.document),d=new t(s,n,h,o),l=new L(d,i);this._engineCore=new g(d,l,a,r,i)}getAttributeValue(t,i){let s=i;const n=this.getAttribute(t);if(!n)return s;if(i instanceof e){const t=n.toLowerCase().split("x");if(t.length>1){const i=new e;return i.x=parseInt(t[0]),i.y=parseInt(t[1]),i}}return parseInt(n)}}var I=function(t,e,i,s){return new(i||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}))};class B{constructor(t,e){this._images=t,this._audios=e,this._audiosLoaded=!1,this._imagesLoaded=!1,this.isAudioMuted=!0}loadImagesAsync(){return I(this,void 0,void 0,(function*(){this._imagesLoaded||(this._imagesLoaded=!0,yield this._images.loadAsync())}))}loadAudiosAsync(){return I(this,void 0,void 0,(function*(){this._audiosLoaded||(this._audiosLoaded=!0,yield this._audios.loadAsync())}))}addImage(...t){this._images.add(...t)}addAudio(...t){this._audios.add(...t)}removeImage(...t){this._images.remove(...t)}removeAudio(...t){this._audios.remove(...t)}setImage(t,e){this._images.set(t,e)}setAudio(t,e){this._audios.set(t,e)}getImage(t){return this._images.get(t)}getAudio(t){return this._audios.get(t)}}class A{get volume(){return this._gaineNode?this._gaineNode.gain.value:0}set volume(t){this._gaineNode&&(this._volume=t,this._gaineNode.gain.setValueAtTime(this._volume,0))}get loop(){var t,e;return null!==(e=null===(t=this._audioNode)||void 0===t?void 0:t.loop)&&void 0!==e&&e}set loop(t){this._audioNode&&(this._audioNode.loop=t)}get isPlaying(){return this._isPlaying}constructor(t,e){this._volume=1,this._startTime=0,this._endTime=0,this._isPlaying=!1,this._isPaused=!1,this._audioBuffer=t,this._audioContext=e,this._ended=t=>this.onEnded(t),this.createAudioNodes()}play(t,e,i){if(!this._audioNode)return;this._isPlaying&&(this._audioNode.stop(),this.createAudioNodes()),this._isPlaying=!0;const s=this._isPaused?this._endTime:void 0,n=null!=e?e:s;this._audioContext.resume(),this._startTime=Date.now(),this._audioNode.addEventListener("ended",this._ended),this._audioNode.start(t,n,i),this._isPaused=!1}pause(){var t;this._isPaused=!0,null===(t=this._audioNode)||void 0===t||t.stop()}stop(){var t;this._isPaused=!1,null===(t=this._audioNode)||void 0===t||t.stop()}createAudioNodes(){let t=1,e=!1;this._audioNode&&(e=this._audioNode.loop),this._gaineNode&&(t=this._gaineNode.gain.value),this._gaineNode=this._audioContext.createGain(),this._audioNode=this._audioContext.createBufferSource(),this._audioNode.buffer=this._audioBuffer,this._audioNode.connect(this._gaineNode),this._gaineNode.connect(this._audioContext.destination),this.loop=e,this.volume=t}onEnded(t){this._isPlaying=!1,this._endTime=Date.now()-this._startTime,t.target.removeEventListener("ended",this._ended),this.createAudioNodes()}}var z=function(t,e,i,s){return new(i||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}))};class R extends Map{constructor(){super(),this._audioPaths=new Array}add(...t){this._audioPaths.push(...t)}remove(...t){t.forEach((t=>{const e=this._audioPaths.indexOf(t);e<0||e>=this._audioPaths.length||(this._audioPaths.splice(e,1),this.delete(t))}))}loadAsync(){return z(this,void 0,void 0,(function*(){const t=new AudioContext;yield Promise.all(this._audioPaths.map((e=>z(this,void 0,void 0,(function*(){yield this.loadAudioAsync(e,t)}))))),yield t.resume()}))}loadAudioAsync(t,e){return z(this,void 0,void 0,(function*(){let i=!1;const s=new XMLHttpRequest,n=()=>{s.removeEventListener("error",n),s.removeEventListener("load",n),e.decodeAudioData(s.response,(i=>{const s=new A(i,e);this.set(t.split("/").pop(),s)})),i=!0};for(s.responseType="arraybuffer",s.open("GET",t,!0),s.addEventListener("error",n),s.addEventListener("load",n),s.send();!i;)yield this.delay(1)}))}delay(t){return new Promise((e=>setTimeout(e,t)))}}class M{get name(){return this._name}get image(){return this._image}constructor(t,e){this._name=t,this._image=e}}var W,D,O=function(t,e,i,s){return new(i||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}))};class H extends Map{constructor(){super(),this._imagePaths=new Array}add(...t){this._imagePaths.push(...t)}remove(...t){t.forEach((t=>{const e=this._imagePaths.indexOf(t);e<0||e>=this._imagePaths.length||(this._imagePaths.splice(e,1),this.delete(t))}))}loadAsync(){return O(this,void 0,void 0,(function*(){yield Promise.all(this._imagePaths.map((t=>O(this,void 0,void 0,(function*(){const e=new Image;e.src=t,yield e.decode();const i=t.split("/").pop();this.set(i,new M(i,e))})))))}))}}class Y extends p{create(){const t=new H,e=new R;return new B(t,e)}}function N(t,e){let i=t.toString();if(i.length>e)return i;let s="";const n=1+i.length-e;for(let t=0;t<n;t++)s+="0";return s+i}class V extends r{get isLoop(){return this._isLoop}set isLoop(t){this._isLoop!==t&&(this._isLoop=t)}get assets(){if(!this._assets)throw new l("Scene");return this._assets}get surface(){if(!this._surface)throw new l("Scene");return this._surface}get input(){if(!this._input)throw new l("Scene");return this._input}constructor(t){super(),this._isLoop=!0,this._assets=t}initialize(t,e){this._surface&&this._surface.removeEventListener(C.surfaceChangeEvent,this._onRefresh),this._input=e,this._surface=t,this._surface.addEventListener(C.surfaceChangeEvent,this._onRefresh),this.onInitialized()}destroy(){super.destroy(),this.surface.removeEventListener(C.surfaceChangeEvent,this._onRefresh)}update(t){var e;this.isActive&&this.isVisible&&(this.isLoop||(this.isActive=!1),null===(e=this._surface)||void 0===e||e.clear(),this.updateEntities(this.children,t))}refresh(){this.isLoop||(this.isActive=!0)}invalidate(){var t;null===(t=this._input)||void 0===t||t.refresh()}onInitialized(){}initializeChild(t){super.initializeChild(t),t.initialize(this.assets,this.surface)}changeCursor(t){const e=this.input.get("Pointer");null==e||e.setStyle(t)}isActiveChanged(t){this.children.forEach((e=>e.isActive=t))}isVisibleChanged(t){var e;t||null===(e=this._surface)||void 0===e||e.clear()}isEnabledChanged(t){this.children.forEach((e=>e.isEnabled=t))}updateEntities(t,e){const i=new Array,s=this.surface.context2d;this.getGroups(t,i).forEach((t=>t.forEach((t=>{t.update(e),t.collision(...this.getCollisions(t,i)),t.draw(s),this.updateEntities(t.children,e)}))))}getGroups(t,e){return t.reduce(((t,i)=>{var s;return t[i.zIndex]=null!==(s=t[i.zIndex])&&void 0!==s?s:[],t[i.zIndex].push(i),i.hitBox&&e.push(i),t}),[])}getCollisions(t,e){return e.reduce(((e,i)=>(i!==t&&t.hitBox.intersectsWith(i.hitBox)&&e.push(i),e)),[])}}class U extends Event{}!function(t){t[t.Menu=0]="Menu",t[t.Play=1]="Play",t[t.Score=2]="Score",t[t.Over=3]="Over"}(W||(W={})),function(t){t[t.None=0]="None",t[t.One=1]="One",t[t.Two=2]="Two"}(D||(D={}));class K extends c{constructor(){super(),this.isHovered=!1,this.isPointerEntered=!1,this.isPointerPressed=!1,this.isHitTestVisible=!0,this.isTouchHitBoxDisabled=!1,this.receivePointerInput=!1,this.receiveKeyboardInput=!1}pointerEnter(t){t=this.getLocalPositionBounds(t),this.onPointerEnter(t),this.refresh()}pointerLeave(t){t=this.getLocalPositionBounds(t),this.onPointerLeave(t),this.refresh()}pointerMove(t){t=this.getLocalPositionBounds(t),this.onPointerMove(t),this.refresh()}pointerHover(t){t=this.getLocalPositionBounds(t),this.onPointerHover(t),this.refresh()}pointerPressed(t){t=this.getLocalPositionBounds(t),this.onPointerPressed(t),this.refresh()}pointerReleased(t){t=this.getLocalPositionBounds(t),this.onPointerReleased(t),this.refresh()}pointerTapped(t){t=this.getLocalPositionBounds(t),this.onPointerTapped(t),this.refresh()}touchStart(t){t=this.getLocalPositionBounds(t),this.onTouchStart(t),this.refresh()}touchMove(t){t=this.getLocalPositionBounds(t),this.onTouchMove(t),this.refresh()}touchEnd(t){t=this.getLocalPositionBounds(t),this.onTouchEnd(t),this.refresh()}keyDown(t){this.onKeyDown(t),this.refresh()}keyUp(t){this.onKeyUp(t),this.refresh()}onEnabledChanged(t){super.onEnabledChanged(t),this.invalidate(),this.refresh()}onPointerEnter(t){}onPointerLeave(t){}onPointerMove(t){}onPointerHover(t){}onPointerPressed(t){}onPointerReleased(t){}onPointerTapped(t){}onTouchStart(t){}onTouchMove(t){}onTouchEnd(t){}onKeyDown(t){}onKeyUp(t){}}class X extends K{constructor(t,e){super(),this._player=t,this._service=e,t===D.One?this._playerText="One Player":this._playerText="Two Players";const i=this._player===D.One;this._selectedText=i?"":"",this._isSelected=i}setSibling(t){this._sibling=t}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.receiveKeyboardInput=!0,this.setHitBox(-220,-40),this.width=300,this.height=60}onPointerEnter(t){super.onPointerEnter(t),this.isEnabled&&this.setSelection(!0)}onPointerTapped(t){super.onPointerTapped(t),this.isEnabled&&this.startGame()}onDraw(t){super.onDraw(t),t.font="80px Roboto Medium",t.fillStyle="#fff",t.globalAlpha=this._isSelected?.8:.4,t.fillText(this._playerText,this.x,this.y+this.height),this._isSelected&&(t.font="100px Material Icons",t.fillText(this._selectedText,this.x-140,this.y+this.height+20))}onKeyUp(t){if(super.onKeyUp(t),this.isEnabled)switch(t.key){case"w":case"s":case"ArrowDown":case"ArrowUp":this._isSelected=!this._isSelected;break;case" ":case"Enter":this.startGame()}}setSelection(t){this._isSelected!==t&&(this._isSelected=t,this._sibling.setSelection(!t))}startGame(){this._isSelected&&(this._service.gamePlay(this._player),this.setAudio("select.aac"))}}function F(t,e,i,s,n){i<2*n&&(n=i/2),s<2*n&&(n=s/2);const h=new Path2D;return h.moveTo(t+n,e),h.arcTo(t+i,e,t+i,e+s,n),h.arcTo(t+i,e+s,t,e+s,n),h.arcTo(t,e+s,t,e,n),h.arcTo(t,e,t+i,e,n),h.closePath(),h}class G extends K{constructor(t){super(),this._gameService=t,this._selectionBounds=new i,this._selectionBounds.x=810,this._selectionBounds.y=462,this._playerOne=new X(D.One,this._gameService),this._playerTwo=new X(D.Two,this._gameService),this._playerOne.setSibling(this._playerTwo),this._playerTwo.setSibling(this._playerOne),this._playerOne.set(this._selectionBounds),this._playerTwo.set(this._selectionBounds),this._playerTwo.y=this._playerOne.y+150}onInitialized(){super.onInitialized(),this.add(this._playerOne,this._playerTwo),this.set(this.surface),this.receiveKeyboardInput=!0}onDraw(t){super.onDraw(t);const e=F(565,300,790,640,20);t.globalAlpha=.6,t.fillStyle="#333",t.strokeStyle="#fff",t.lineWidth=3,t.fillRect(this.x,this.y,this.width,this.height),t.fill(e),t.stroke(e),t.globalAlpha=.8,t.font="40px Roboto Medium",t.fillStyle="#fff",t.fillText("Menu",600,360)}}class $ extends c{constructor(t,e){super(),this._upText=t,this._downText=e}onDraw(t){super.onDraw(t),t.globalAlpha=.6,t.fillStyle="#333",t.strokeStyle="#fff",t.lineWidth=3,t.font="60px Roboto Medium",t.fillStyle="#fff",t.fillText(this._upText,this.x+110,this.y+90),t.fillText(this._downText,this.x+270,this.y+90),t.font="70px Material Icons",t.fillText("",this.x+25,this.y+100),t.fillText("",this.x+190,this.y+105)}}class q extends c{constructor(){super(),this._playerOneControl=new $("W","S"),this._playerOneControl.x=565,this._playerOneControl.y=810,this._playerTwoControl=new $("8","5"),this._playerTwoControl.x=1005,this._playerTwoControl.y=this._playerOneControl.y}onInitialized(){super.onInitialized(),this.add(this._playerOneControl,this._playerTwoControl)}onDraw(t){super.onDraw(t),t.globalAlpha=.8,t.font="40px Roboto Medium",t.fillStyle="#fff",t.fillText("Controls",600,790)}}class Z extends V{constructor(t,e){super(e),this._gameService=t}onInitialized(){super.onInitialized(),this.add(new G(this._gameService),new q),this.isLoop=!1}}class j extends K{constructor(t){super(),this._gameService=t,this._gameOverText="Game Over",this._iconText="",this._gameChanged=t=>this.onGameChanged(t)}onInitialized(){super.onInitialized(),this.set(this.surface),this.receivePointerInput=!0,this.receiveKeyboardInput=!0,this._gameService.addEventListener("gamechanged",this._gameChanged)}onGameChanged(t){this._gameState=t.gameState,this._gameState===W.Over&&this.setAudio("select.aac")}onKeyUp(t){super.onKeyUp(t),this.isEnabled&&(" "!==t.key&&"Enter"!==t.key&&"Escape"!==t.key||this._gameService.gameMenu())}onPointerTapped(t){super.onPointerTapped(t),this._gameState===W.Over&&this._gameService.gameMenu()}onDraw(t){super.onDraw(t);const e=F(565,425,790,230,20);t.globalAlpha=.6,t.fillStyle="#333",t.strokeStyle="#fff",t.lineWidth=4,t.fillRect(this.x,this.y,this.width,this.height),t.fill(e),t.stroke(e),t.font="70px Roboto Medium",t.fillStyle="#fff",t.globalAlpha=.7,t.fillText(this._gameOverText,855,565),t.font="100px Material Icons",t.fillText(this._iconText,695,590)}}class J extends V{constructor(t,e){super(e),this._gameService=t}onInitialized(){super.onInitialized(),this.add(new j(this._gameService)),this.isLoop=!1}}class Q extends c{onInitialized(){super.onInitialized(),this.set(this.surface),this.setHitBox(50,70)}}class tt extends K{constructor(t,e){super(),this.velocity=10,this._player=t,this._touchY=0,this._playerCount=0,this._scoreTime=0,this._collisionTime=0,this._imageName="",this._computedInput=!0,this._isArrowKeyUp=!1,this._isArrowKeyDown=!1,this._gameService=e,this._keyUpKeys=new Array,this._keyDownKeys=new Array;const i=this._player===D.One;this._keyUpKeys.push(...i?["w","ArrowUp"]:["8"]),this._keyDownKeys.push(...i?["s","ArrowDown"]:["5"]),this.setHitBox(140,45),this._gameChanged=t=>this.onGameChanged(t)}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.receiveKeyboardInput=!0,this.isTouchHitBoxDisabled=!0,this._gameService.addEventListener("gamechanged",this._gameChanged)}onUpdate(t){if(super.onUpdate(t),this.isEnabled=!this._computedInput,this.isEnabled&&(this._isArrowKeyUp&&this.moveY(t,-this.velocity),this._isArrowKeyDown&&this.moveY(t,this.velocity),this._touchY>0&&(this.y=this._touchY)),this._collisionTime>0){if(this._collisionTime-=t.delta,this._imageName!==this._imageCollision){const t=this.setImage(this._imageCollision);this._imageName=t.name}}else if(this._scoreTime>0){if(this._scoreTime-=t.delta,this._imageName!==this._imageScore){const t=this.setImage(this._imageScore);this._imageName=t.name}}else{if(this._imageName!==this._imageNormal){const t=this.setImage(this._imageNormal);this._imageName=t.name}this._computedInput&&this.computedInput(t)}}onCollision(...t){super.onCollision(...t),t.forEach((t=>{this.ballCollision(t),this.backgroundCollision(t)}))}setImages(t,e,i){let s=this.setImage(t);return this._imageNormal=s.name,s=this.setImage(e),this._imageCollision=s.name,s=this.setImage(i),this._imageScore=s.name,s}onKeyDown(t){super.onKeyDown(t),this.onKeyChanged(t)}onKeyUp(t){super.onKeyUp(t),this.onKeyChanged(t)}onPointerMove(t){super.onPointerMove(t),this.onTouchChanged(t,!1)}onPointerReleased(t){super.onPointerReleased(t),this.onTouchChanged(t,!0)}onTouchChanged(t,e){if(this.isEnabled&&!this._computedInput){if(this._touchPosition){const e=this.surface.width/2;this._player===D.One&&t.x<e&&(this._touchY=t.y-this.height/2),this._player===D.Two&&t.x>e&&(this._touchY=t.y-this.height/2)}this._touchPosition=t,e&&(this._touchY=0)}}onKeyChanged(t){this._computedInput||(this._keyUpKeys.indexOf(t.key)>-1?this._isArrowKeyUp="keydown"===t.type:this._keyDownKeys.indexOf(t.key)>-1&&(this._isArrowKeyDown="keydown"===t.type))}onGameChanged(t){switch(t.gameState){case W.Menu:case W.Play:case W.Over:this.y=this.getCenter(this.surface).y,this._playerCount=t.playerCount,this._computedInput=this._player>this._playerCount;break;case W.Score:t.player!==this._player&&(this._scoreTime=600)}}ballCollision(t){t instanceof ht&&(this._collisionTime=200)}backgroundCollision(t){if(!(t instanceof Q)||t.hitBox.contains(this.hitBox))return;const e=this._lastHitBox;this.y=e.y-this._hitBoxOffsetY}computedInput(t){this.shouldMoveToCenterY()?this.moveToCenterY(t):this.moveToBallY(t)}shouldMoveToCenterY(){const t=this._gameService.ballPosition,e=this._gameService.ballDirection,i=this.surface.width/2,s=i>t.x,n=i<t.x,h=this._player===D.One?s:n,o=this._player===D.One&&e.x>0,r=this._player===D.Two&&e.x<0;return!h||o||r}moveToCenterY(t){let e=this.velocity/2,i=this.y+this.height/2;const s=this.surface.height/2;for(;i>s&&e>0;)e--,this.moveY(t,-1),i=this.y+this.height/2;for(;i<s&&e>0;)e--,this.moveY(t,1),i=this.y+this.height/2}moveToBallY(t){let e=this.velocity,i=this.y+this.height/2;const s=this._gameService.ballPosition;for(;s.y<i&&e>0;)e--,this.moveY(t,-1),i=this.y+this.height/2;for(;s.y>i&&e>0;)e--,this.moveY(t,1),i=this.y+this.height/2}}class et extends tt{constructor(t){super(D.One,t)}onInitialized(){super.onInitialized();const t=this.setImages("bat00.png","bat01.png","bat02.png").image;this.width=2*t.width,this.height=2*t.height,this.x=-80,this.y=this.getCenter(this.surface).y}}class it extends tt{constructor(t){super(D.Two,t)}onInitialized(){super.onInitialized();const t=this.setImages("bat03.png","bat04.png","bat05.png").image;this.width=2*t.width,this.height=2*t.height;const e=this.getCenter(this.surface);this.x=this.surface.width-240,this.y=e.y}}class st extends c{constructor(){super(),this._runTime=200}onUpdate(t){super.onUpdate(t),this._runTime<=0?this.isVisible=!1:(this._runTime<40?this.setImage("impact04.png"):this._runTime<80?this.setImage("impact03.png"):this._runTime<120?this.setImage("impact02.png"):this._runTime<160?this.setImage("impact01.png"):this._runTime<200&&this.setImage("impact00.png"),this._runTime-=t.delta)}}function nt(t,e){return Math.random()*(e-t)+t}class ht extends c{constructor(t){super(),this._gameService=t,this._playerCount=0,this._pauseTime=1e3,this._gameChanged=t=>this.onGameChanged(t),this._gameService.addEventListener("gamechanged",this._gameChanged)}onInitialized(){super.onInitialized();const t=this.setImage("ball.png").image;this.width=2.5*t.width,this.height=2.5*t.height,this.setHitBox(15,15),this.reset(!0)}onUpdate(t){if(super.onUpdate(t),this.setAudio("theme.aac",.2,!0),this._pauseTime>0)this._pauseTime-=t.delta;else{this._pauseTime=0;const e=this.direction.getNormalize(),i=e.x*this.velocity,s=e.y*this.velocity;this.moveX(t,i),this.moveY(t,s)}this._gameService.ballPosition=this,this._gameService.ballDirection=this.direction,this.removeObsolete()}onCollision(...t){super.onCollision(...t),t.forEach((t=>{this.backgroundCollision(t),this._pauseTime<=0&&this.playerCollision(t)}))}onGameChanged(t){this._playerCount=t.playerCount,t.gameState!==W.Play?t.gameState===W.Menu&&(this.velocity=15):this.play()}playerCollision(t){if(!(t instanceof et||t instanceof it))return;const e=t.hitBox,i=this.direction.x<0?e.x+e.width+this.velocity:e.x-this.hitBox.width-this.velocity;this.direction.x*=-1,this.direction.y=this.getCollisionAngle(e),this.x=i-this._hitBoxOffsetX,this.y=this.hitBox.y-this._hitBoxOffsetY,this.increaseSpeed(),this.playEffect(),this.playHitSound()}backgroundCollision(t){const e=t.hitBox;if(t instanceof Q&&!e.contains(this.hitBox))if(this.hitBox.x<=e.x||this.hitBox.x+this.hitBox.width>=e.x+e.width){const t=this.hitBox.x<=e.x;this.direction.x*=-1,this._gameService.gameState===W.Play&&this._gameService.gameScore(t?2:1),this.reset(t)}else if(this.hitBox.y<=e.y||this.hitBox.y+this.hitBox.height>=e.y+e.height){const t=this.hitBox.y<=e.y;this.direction.y*=-1,this.y=t?e.y-this._hitBoxOffsetY+this.velocity:e.y+e.height-(this._hitBoxOffsetY+this.hitBox.height+this.velocity),this.playHitSound(),this.playEffect()}}getCollisionAngle(t){const e=t.y+t.height/2,i=e-t.y,s=this.hitBox.y+this.hitBox.height/2-e;let n=.5*Math.abs(s/i);return(this.direction.y<0&&n>0||this.direction.y>0&&n<0)&&(n*=-1),0!==n?n:nt(-.1,.1)}playEffect(){const t=new st;t.set(this.hitBox),t.width=2*this.width,t.height=2*this.height,t.x-=this.width/2,t.y-=this.height/2,this.add(t)}play(){const t=Math.round(nt(0,1));this.reset(t)}reset(t){const e=this.getCenter(this.surface);this.x=e.x,this.y=e.y,this.velocity=15,this.direction.y=0,this.direction.x=t?-1:1,this._lastHitBox=this.setHitBox(15,15),this._pauseTime=1e3}removeObsolete(){this.children.forEach((t=>{t.isVisible||this.remove(t)}))}increaseSpeed(){!(this._playerCount<1)&&this.velocity<40&&(this.velocity+=1)}playHitSound(){this.setAudio("hit.aac",1)}}class ot extends c{set number(t){this._number=t}set highlight(t){this._useHighlight=t}constructor(){super(),this._number=0,this._highlightStep=0,this._imageName="",this._useHighlight=!1,this._scoreMap=new Map}addGreenNumbers(){for(let t=20;t<30;t++)this.addScoreImage(t);this._highlightStep=20}addBlueNumbers(){for(let t=10;t<20;t++)this.addScoreImage(t);this._highlightStep=10}onInitialized(){var t;super.onInitialized();for(let t=0;t<10;t++)this.addScoreImage(t);const e=null===(t=this._imageSource)||void 0===t?void 0:t.image;e&&(this.width=1.4*e.width,this.height=1.4*e.height)}onUpdate(t){super.onUpdate(t);let e=this.getScoreName(this._number);if(this._useHighlight){const t=this._number+this._highlightStep;e=this.getScoreName(t)}if(this._imageName!=e){const t=this.setImage(e);this._imageName=t.name}}addScoreImage(t){const e=this.getScoreName(t),i=this.setImage(e);this._imageName=i.name,this._scoreMap.set(t,e)}getScoreName(t){return`digit${N(t,1)}.png`}}class rt extends c{set number(t){t>0&&t!=this._number&&(this._effectTime=600),this._number=t,this._numberRight.number=t%10,this._numberLeft.number=Math.trunc(t/10)}set highlight(t){this._numberRight.highlight=t,this._numberLeft.highlight=t}constructor(t,e){super(),this._number=0,this._effectTime=0,this._player=t,this._gameService=e,this._gameState=W.Menu,this._numberLeft=new ot,this._numberRight=new ot,this._gameChanged=t=>this.onGameChanged(t),this._gameService.addEventListener("gamechanged",this._gameChanged)}onInitialized(){super.onInitialized(),this.add(this._numberLeft,this._numberRight)}onGameChanged(t){this._gameState=t.gameState}onUpdate(t){if(super.onUpdate(t),this._numberLeft.x=this.x,this._numberLeft.y=this.y,this._numberRight.x=this._numberLeft.x+this._numberLeft.width,this._numberRight.y=this.y,this._effectTime>0)return this.highlight=!0,void(this._effectTime-=t.delta);this.highlight=this._gameState===W.Over}addBlueNumbers(){this._numberLeft.addBlueNumbers(),this._numberRight.addBlueNumbers()}addGreenNumbers(){this._numberLeft.addGreenNumbers(),this._numberRight.addGreenNumbers()}}class at extends rt{constructor(t){super(D.One,t),this.x=700,this.y=135}onInitialized(){super.onInitialized(),this.addGreenNumbers()}onUpdate(t){super.onUpdate(t),this.number=this._gameService.playerOneScore}}class dt extends rt{constructor(t){super(D.Two,t),this.x=1015,this.y=135}onInitialized(){super.onInitialized(),this.addBlueNumbers()}onUpdate(t){super.onUpdate(t),this.number=this._gameService.playerTwoScore}}class lt extends V{constructor(t,e){super(e),this._gameService=t}onInitialized(){super.onInitialized(),this.add(new Q,new et(this._gameService),new it(this._gameService),new at(this._gameService),new dt(this._gameService),new ht(this._gameService))}}class ct extends K{constructor(t){super(),this._iconText=t,this.width=100,this.height=100,this._disabledOpacity=.1,this._backgroundOpacityNormal=.2,this._backgroundOpacityHover=.4,this._backgroundOpacityPressed=.5,this._backgroundOpacity=this._backgroundOpacityNormal}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.setHitBox(0,0)}onPointerEnter(t){super.onPointerEnter(t),this._backgroundOpacity=this._backgroundOpacityHover}onPointerLeave(t){super.onPointerLeave(t),this._backgroundOpacity=this._backgroundOpacityNormal}onPointerPressed(t){super.onPointerPressed(t),this._backgroundOpacity=this._backgroundOpacityPressed}onPointerReleased(t){super.onPointerReleased(t),this._backgroundOpacity=this._backgroundOpacityNormal}onDraw(t){super.onDraw(t),t.font="70px Material Icons",t.textAlign="left",t.textBaseline="top",t.fillStyle="#000",t.strokeStyle="#fff",t.lineWidth=3,t.globalAlpha=this.isEnabled?this._backgroundOpacity:this._backgroundOpacityNormal;const e=this.width/2;t.beginPath(),t.arc(this.x+e,this.y+e,e,0,2*Math.PI),t.fill(),t.globalAlpha=this.isEnabled?.5:this._disabledOpacity,t.stroke(),t.fillStyle="#fff",t.fillText(this._iconText,this.x+16,this.y+16)}}class ut extends ct{constructor(){super(""),this._offIconText="",this._onIconText=""}onPointerTapped(t){super.onPointerTapped(t),this.setAudio("select.aac"),this.onToggle()}onToggle(){return t=this,e=void 0,s=function*(){const t=this._iconText===this._onIconText;if(this._iconText=t?this._offIconText:this._onIconText,!t)return yield this.assets.loadAudiosAsync(),void(this.assets.isAudioMuted=!1);this.assets.isAudioMuted=!0},new((i=void 0)||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class _t extends ct{constructor(t){super(""),this._gameService=t}onPointerTapped(t){super.onPointerTapped(t),this._gameService.gameMenu(),this.setAudio("select.aac")}}class gt extends c{constructor(t){super(),this._gameService=t,this._audioButton=new ut,this._exitButton=new _t(t),this._leftPosition=new e(570,140),this._rightPosition=new e(1260,140),this._exitButton.isEnabled=!1,this._gameChanged=t=>this.onGameChanged(t)}onInitialized(){super.onInitialized(),this.add(this._audioButton,this._exitButton),this.set(this.surface),this.setPositions(this._audioButton,this._exitButton),this._gameService.addEventListener("gamechanged",this._gameChanged)}onGameChanged(t){switch(t.gameState){case W.Play:this._exitButton.isEnabled=!0;break;case W.Menu:this._exitButton.isEnabled=!1}}setPositions(t,e){t&&(t.x=this._leftPosition.x,t.y=this._leftPosition.y),e&&(e.x=this._rightPosition.x,e.y=this._rightPosition.y)}}class pt extends V{constructor(t,e){super(e),this._gameService=t}onInitialized(){super.onInitialized(),this.add(new gt(this._gameService)),this.isLoop=!1}}class yt extends c{constructor(t){super(),this.isVisible=!1,this._imageName=t,this._runTime=0,this._runTimeCount=0}play(){this._runTime=this._runTimeCount,this.setAudio("score.aac",1)}onInitialized(){super.onInitialized(),this.setImage(this._imageName),this.set(this.surface)}onUpdate(t){if(super.onUpdate(t),this._runTimeCount=this.getCalculatedValue(t,600),this._runTime<=0){const t=this.isVisible;return this.isVisible=!1,void(t&&this.refresh())}this.isVisible=!0,this._runTime-=t.delta,this.refresh()}}class ft extends c{constructor(t){super(),this._effectLeft=new yt("effect00.png"),this._effectRight=new yt("effect01.png"),this._gameService=t,this._gameChanged=t=>this.onGameChanged(t),this._gameService.addEventListener("gamechanged",this._gameChanged)}onInitialized(){super.onInitialized(),this.add(this._effectLeft,this._effectRight),this.set(this.surface),this.setImage("table.png"),this.setHitBox(50,70)}onGameChanged(t){switch(t.player){case D.One:this._effectRight.play();break;case D.Two:this._effectLeft.play()}this.refresh()}}class vt extends V{constructor(t,e){super(e),this._gameService=t}onInitialized(){super.onInitialized(),this.add(new ft(this._gameService)),this.isLoop=!1}}class mt extends EventTarget{constructor(t,i){super(),this.playerOneScore=0,this.playerTwoScore=0,this.gameState=W.Menu,this.ballPosition=new e,this.ballDirection=new e,this._engineCore=t,this._tableScene=new vt(this,i),this._menuScene=new Z(this,i),this._endScene=new J(this,i),this._playScene=new lt(this,i),this._overlayScene=new pt(this,i)}initialize(){this._engineCore.add(this._tableScene,this._playScene,this._menuScene,this._endScene,this._overlayScene),this.gameMenu(),this._engineCore.start()}gameMenu(){this.playerOneScore=0,this.playerTwoScore=0,this._playScene.isEnabled=!1,this._endScene.isVisible=!1,this._menuScene.isVisible=!0,this.gameState=W.Menu;const t=new U("gamechanged");t.gameState=this.gameState,t.playerCount=0,this.dispatchEvent(t)}gamePlay(t){this._playScene.isEnabled=!0,this._endScene.isVisible=!1,this._menuScene.isVisible=!1,this.gameState=W.Play;const e=new U("gamechanged");e.gameState=this.gameState,e.playerCount=t,this.dispatchEvent(e)}gameOver(t){this._playScene.isEnabled=!1,this._menuScene.isVisible=!1,this._endScene.isVisible=!0,this.gameState=W.Over;const e=new U("gamechanged");e.gameState=this.gameState,e.player=t,e.playerCount=0,this.dispatchEvent(e)}gameScore(t){switch(t){case D.One:this.playerOneScore+=1;break;case D.Two:this.playerTwoScore+=1}const e=new U("gamechanged");e.gameState=W.Score,e.player=t,this.dispatchEvent(e),this.playerOneScore>9?this.gameOver(D.One):this.playerTwoScore>9&&this.gameOver(D.Two)}}class wt{constructor(t){this._engine=t;const e=new Y;this._assets=e.create(),this._assets.addAudio("./assets/pong/audios/theme.aac","./assets/pong/audios/select.aac","./assets/pong/audios/hit.aac","./assets/pong/audios/score.aac"),this._assets.addImage("./assets/pong/images/table.png","./assets/pong/images/over.png","./assets/pong/images/ball.png");for(let t=0;t<4;t++){const e=N(t,1);this._assets.addImage(`./assets/pong/images/player${e}.png`)}for(let t=0;t<2;t++){const e=N(t,1);this._assets.addImage(`./assets/pong/images/effect${e}.png`)}for(let t=0;t<6;t++){const e=N(t,1);this._assets.addImage(`./assets/pong/images/bat${e}.png`)}for(let t=0;t<5;t++){const e=N(t,1);this._assets.addImage(`./assets/pong/images/impact${e}.png`)}for(let t=0;t<30;t++){const e=N(t,1);this._assets.addImage(`./assets/pong/images/digit${e}.png`)}}startAsync(){return t=this,e=void 0,s=function*(){yield this._assets.loadImagesAsync(),new mt(this._engine,this._assets).initialize()},new((i=void 0)||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class xt{initializeAsync(t,e){return i=this,s=void 0,h=function*(){const i=k.getEngine(t,e);if(i){const t=new wt(i);yield t.startAsync()}},new((n=void 0)||(n=Promise))((function(t,e){function o(t){try{a(h.next(t))}catch(t){e(t)}}function r(t){try{a(h.throw(t))}catch(t){e(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,r)}a((h=h.apply(i,s||[])).next())}));var i,s,n,h}}class bt extends c{constructor(t){super(),this._imageName=t}onInitialized(){super.onInitialized();const t=this.setImage(this._imageName).image;this.width=t.width,this.height=t.height}}class Et extends c{constructor(t,e,i,s=0){super(),this.velocity=t,this._backgroundLayer=new bt(e),this._backgroundLayerFlip=new bt(i),this._xOffset=s}onInitialized(){this.add(this._backgroundLayer,this._backgroundLayerFlip),this.set(this.surface),this._backgroundLayerFlip.x=this._backgroundLayer.width+this._xOffset}onUpdate(t){this._backgroundLayer.moveX(t,-this.velocity),this._backgroundLayer.x=this._backgroundLayer.x<-this._backgroundLayer.width?-this._backgroundLayer.width:this._backgroundLayer.x,this._backgroundLayerFlip.moveX(t,-this.velocity),this._backgroundLayerFlip.x=this._backgroundLayerFlip.x<-this._backgroundLayerFlip.width?-this._backgroundLayerFlip.width:this._backgroundLayerFlip.x,this._backgroundLayer.x+this._backgroundLayer.width<=0&&(this._backgroundLayer.x=this._backgroundLayerFlip.x+this._backgroundLayerFlip.width+this._xOffset),this._backgroundLayerFlip.x+this._backgroundLayerFlip.width<=0&&(this._backgroundLayerFlip.x=this._backgroundLayer.x+this._backgroundLayer.width+this._xOffset)}}class Pt extends c{onInitialized(){super.onInitialized(),this.add(new Et(.5,"background00.png","background01.png",-1),new Et(1,"background02.png","background03.png"),new Et(10,"background04.png","background05.png"),new Et(15,"background06.png","background07.png"))}}class St extends c{onInitialized(){const t=this.setImage("wheel.png").image;this.width=.8*t.width,this.height=.8*t.height}}class Tt extends c{constructor(){super(),this._wheelLeft=new St,this._wheelRight=new St}onInitialized(){super.onInitialized(),this.add(this._wheelLeft,this._wheelRight);const t=this.setImage("car.png").image;this.x=200,this.y=720,this.width=.8*t.width,this.height=.8*t.height,this._wheelLeft.x=this.x+58,this._wheelLeft.y=this.y+81,this._wheelRight.x=this._wheelLeft.x+308,this._wheelRight.y=this._wheelLeft.y}onUpdate(t){this._wheelLeft.rotateTo(t,10),this._wheelRight.rotateTo(t,10)}}class Ct extends c{constructor(){super(),this._isBackwards=!1}onInitialized(){const t=this.setImage("title.png").image;this.x=350,this.y=100,this.width=t.width,this.height=t.height}onUpdate(t){if(super.onUpdate(t),!this._isBackwards){if(this.scale<1)return this.scaleTo(t,.002),void(this.scale=this.scale>1?1:this.scale);this._isBackwards=!0}if(this._isBackwards){if(this.scale>.8)return this.scaleTo(t,-.002),void(this.scale=this.scale<.8?.8:this.scale);this._isBackwards=!1}}}class Lt extends V{onInitialized(){super.onInitialized(),this.add(new Pt,new Ct,new Tt)}}class kt{constructor(t){this._engine=t;const e=new Y;this._assets=e.create(),this._assets.addImage("./assets/street/images/title.png","./assets/street/images/car.png","./assets/street/images/wheel.png");for(let t=0;t<8;t++){const e=N(t,1);this._assets.addImage(`./assets/street/images/background${e}.png`)}}startAsync(){return t=this,e=void 0,s=function*(){yield this._assets.loadImagesAsync(),this._engine.add(new Lt(this._assets)),this._engine.start()},new((i=void 0)||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class It{initializeAsync(t,e){return i=this,s=void 0,h=function*(){const i=k.getEngine(t,e);if(i){const t=new kt(i);yield t.startAsync()}},new((n=void 0)||(n=Promise))((function(t,e){function o(t){try{a(h.next(t))}catch(t){e(t)}}function r(t){try{a(h.throw(t))}catch(t){e(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,r)}a((h=h.apply(i,s||[])).next())}));var i,s,n,h}}class Bt extends V{constructor(t,e){super(t),this._element=e}onInitialized(){super.onInitialized(),this.add(this._element),this.isLoop=!1}}class At extends K{constructor(t,s){super(),this._parent=t,this._cursorStyle=s,this._pressedDiff=new e,this._pressedDiffParent=new i}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.width=30,this.height=30}onDraw(t){super.onDraw(t),t.fillStyle="white",t.strokeStyle="black",t.lineWidth=4,t.fillRect(this.x,this.y,this.width,this.height),t.strokeRect(this.x,this.y,this.width,this.height)}onPointerEnter(t){super.onPointerEnter(t),this.opacity=1,this._parent.isHitTestVisible=!1,this.changeCursor(this._cursorStyle)}onPointerLeave(t){super.onPointerLeave(t),this.opacity=0,this._parent.isHitTestVisible=!0}onPointerPressed(t){super.onPointerPressed(t),this._pressedDiff.x=this.x-t.x,this._pressedDiff.y=this.y-t.y,this._pressedDiffParent.x=this._parent.x-t.x,this._pressedDiffParent.y=this._parent.y-t.y,this._pressedDiffParent.width=this._parent.getRight()-t.x,this._pressedDiffParent.height=this._parent.getBottom()-t.y}onPointerMove(t){this.isPointerPressed&&this._parent.resize(this,t,this._pressedDiffParent)}}At.stateChangedEvent="statechanged";class zt{static getProjection(t){return[[t,0,0],[0,t,0]]}static getTranslation(t){return[[1,0,t.x],[0,1,t.y],[0,0,1]]}static getScale(t){return[[t.x,0,0],[0,t.y,0],[0,0,1]]}static getRotationX(t){return[[1,0,0],[0,Math.cos(t),-Math.sin(t)],[0,Math.sin(t),Math.cos(t)]]}static getRotationY(t){return[[Math.cos(t),0,Math.sin(t)],[0,1,0],[-Math.sin(t),0,Math.cos(t)]]}static getRotationZ(t){return[[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]]}static multiplyMatrix(t,e){const i=void 0!==e.x&&void 0!==e.y&&void 0!==e.z?this.vectorToMatrix(e):e,s=t[0].length,n=t.length,h=i[0].length;if(s!==i.length)throw Error("ColumnsCount of matrixA doesn't match RowsCount of matrixB");const o=new Array;for(let t=0;t<n;t++)o.push(new Array);for(let e=0;e<n;e++)for(let n=0;n<h;n++){let h=0;for(let o=0;o<s;o++)h+=t[e][o]*i[o][n];o[e][n]=h}return o}static vectorToMatrix(t){return[[t.x],[t.y],[t.z]]}static matrixToVector(t){return t.length>2?new s(t[0][0],t[1][0],t[2][0]):t.length>1?new s(t[0][0],t[1][0],0):t.length>0?new s(t[0][0],0,0):new s(0,0,0)}}class Rt extends c{constructor(){super(),this.name="3D Cube",this._cubePoints=new Array(new s(-1,-1,-1),new s(1,-1,-1),new s(1,1,-1),new s(-1,1,-1),new s(-1,-1,1),new s(1,-1,1),new s(1,1,1),new s(-1,1,1)),this._arrowFrontPoints=new Array(new s(-.4,0,1),new s(0,.4,1),new s(0,.2,1),new s(.4,.2,1),new s(.4,-.2,1),new s(0,-.2,1),new s(0,-.4,1)),this._arrowBackPoints=new Array(new s(.4,0,-1),new s(0,-.4,-1),new s(0,-.2,-1),new s(-.4,-.2,-1),new s(-.4,.2,-1),new s(0,.2,-1),new s(0,.4,-1)),this._arrowLeftPoints=new Array(new s(-1,0,-.4),new s(-1,0,-.2),new s(-1,.4,-.2),new s(-1,.4,.2),new s(-1,0,.2),new s(-1,0,.4),new s(-1,-.4,0)),this._arrowRightPoints=new Array(new s(1,0,.4),new s(1,0,.2),new s(1,-.4,.2),new s(1,-.4,-.2),new s(1,0,-.2),new s(1,0,-.4),new s(1,.4,0)),this._elementX=0,this._elementY=0,this._distance=5,this._color="red",this._rotationXMatrix=[],this._rotationYMatrix=[],this._rotationZMatrix=[],this._scaleMatrix=[],this.isAutoRotate=!0,this.rotationX=0,this.rotationY=0,this.rotationZ=0,this._maxRadius=2*Math.PI}onUpdate(t){super.onUpdate(t),this._elementX=this.x+.5*this.width,this._elementY=this.y+.5*this.height,this.isAutoRotate&&(this.rotationX=(this.rotationX+this.getCalculatedValue(t,.01))%this._maxRadius,this.rotationY=(this.rotationY+this.getCalculatedValue(t,-.01))%this._maxRadius),this._rotationXMatrix=zt.getRotationX(this.rotationX),this._rotationYMatrix=zt.getRotationY(this.rotationY),this._rotationZMatrix=zt.getRotationZ(this.rotationZ),this._scaleMatrix=zt.getScale(new e(1.7*this.width,1.7*this.height)),this.refresh()}onDraw(t){super.onDraw(t),this.drawArrow(t,this._arrowBackPoints),this.drawArrow(t,this._arrowFrontPoints),this.drawArrow(t,this._arrowLeftPoints),this.drawArrow(t,this._arrowRightPoints),this.drawCube(t)}drawArrow(t,e){let i,s;t.fillStyle=this._color,t.beginPath(),e.forEach((e=>{const n=this.getProjected2dVector(e);t.lineTo(n[0].x,n[0].y),s?(t.globalAlpha=1,this.drawConnection(t,s,n,6,!1)):i=n,s=n})),t.globalAlpha=1,this.drawConnection(t,s,i,6,!1),t.globalAlpha=.2,t.closePath(),t.fill(),t.globalAlpha=1}drawCube(t){const e=new Array;this._cubePoints.forEach((t=>{const i=this.getProjected2dVector(t);e.push(i)})),t.fillStyle=this._color,this.drawArea(t,e[0][0],e[4][0],e[5][0],e[1][0]),this.drawArea(t,e[2][0],e[6][0],e[7][0],e[3][0]);for(let i=0;i<4;i++)this.drawConnection(t,e[i],e[(i+1)%4],6),this.drawConnection(t,e[i+4],e[(i+1)%4+4],6),this.drawConnection(t,e[i],e[i+4],6)}getProjected2dVector(t){let e=zt.vectorToMatrix(t);e=zt.multiplyMatrix(this._rotationXMatrix,e),e=zt.multiplyMatrix(this._rotationYMatrix,e),e=zt.multiplyMatrix(this._rotationZMatrix,e),e=zt.multiplyMatrix(this._scaleMatrix,e);const i=1/(this._distance-e[2][0]),s=zt.getProjection(i);e=zt.multiplyMatrix(s,e);const n=zt.matrixToVector(e);return n.x+=this._elementX,n.y+=this._elementY,[n,i]}drawConnection(t,e,i,s,n=!0){const h=this.createLinePath(e[0],i[0],this._distance*e[1]*s,this._distance*i[1]*s);t.fill(h),n&&this.drawCap(t,e)}drawArea(t,e,i,s,n){t.globalAlpha=.2,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.lineTo(s.x,s.y),t.lineTo(n.x,n.y),t.closePath(),t.fill(),t.globalAlpha=1}drawCap(t,e){t.beginPath(),t.arc(e[0].x,e[0].y,.03*this.width*e[1]*this._distance,0,2*Math.PI,!1),t.closePath(),t.fill()}createLinePath(t,e,i,s){const n=Math.atan2(e.y-t.y,e.x-t.x)+.5*Math.PI,h=new Path2D;return h.arc(t.x,t.y,.5*i,n,n+Math.PI),h.arc(e.x,e.y,.5*s,n+Math.PI,n),h.closePath(),h}}class Mt{constructor(){this.name="",this.x="",this.y="",this.width="",this.height="",this.rotationX="",this.rotationY="",this.transform=""}}class Wt extends K{constructor(t){super(),this._rulerArea=t,this._pressedDiff=new e,this._shape=new Rt,this._handles=new Array(new At(this,"nwse-resize"),new At(this,"nesw-resize"),new At(this,"nwse-resize"),new At(this,"nesw-resize")),this.elementData=new Mt,this.offset=0,this._radianToDegree=180/Math.PI,this._minSize=100}onInitialized(){super.onInitialized(),this.add(this._shape,...this._handles),this.receivePointerInput=!0,this.x=390,this.y=290,this.width=600,this.height=600,this.offset=62}onUpdate(t){super.onUpdate(t),this._shape.x=this.x+15,this._shape.y=this.y+15,this._shape.width=this.width-30,this._shape.height=this.height-30,this._shape.isAutoRotate=!this.isPointerPressed,this.updateHandlesPosition(),this.updateData()}updateData(){this.elementData.name="3D Cube (Weak Perspective Projection)",this.elementData.x=`${Math.round(this.x-this.offset)}px`,this.elementData.y=`${Math.round(this.y-this.offset)}px`,this.elementData.width=`${Math.round(this.width)}px`,this.elementData.height=`${Math.round(this.height)}px`,this.elementData.rotationX=`${Math.round(this._shape.rotationX*this._radianToDegree)}°`,this.elementData.rotationY=`${Math.round(this._shape.rotationY*this._radianToDegree*-1)}°`}onPointerEnter(t){super.onPointerEnter(t),this.updateHandlesVisibility(!0)}onPointerLeave(t){super.onPointerLeave(t),this.updateHandlesVisibility(!1)}onPointerPressed(t){super.onPointerPressed(t),this.changeCursor("move"),this._pressedDiff.x=this.x-t.x,this._pressedDiff.y=this.y-t.y}onPointerMove(t){if(super.onPointerMove(t),this._handles.find((t=>t.isPointerPressed)))return;const e=t.x+this._pressedDiff.x,i=t.y+this._pressedDiff.y;this.checkAreaBounds(e,i,this.width,this.height)}resize(t,e,i){const s=this._handles.indexOf(t);let n=this.x,h=this.y,o=0,r=0,a=this.width,d=this.height;switch(s){case 0:o=this.x-e.x,r=this.y-e.y,a+=o,d+=r,this.checkAreaBounds(e.x+i.x,e.y+i.y,a,d),o=n-this.x,r=h-this.y,this.width+=o,this.height+=r;break;case 1:o=e.x+i.width-this.getRight(),r=this.y-e.y,a+=o,d+=r,a=this.checkWidthBounds(a),this.checkAreaBounds(this.x,e.y+i.y,a,d),r=h-this.y,this.height+=r,this.width=a;break;case 2:o=e.x+i.width-this.getRight(),r=e.y+i.height-this.getBottom(),a+=o,d+=r,a=this.checkWidthBounds(a),d=this.checkHeightBounds(d),this.width=a,this.height=d;break;case 3:o=this.x-e.x,r=e.y+i.height-this.getBottom(),a+=o,d+=r,d=this.checkHeightBounds(d),this.checkAreaBounds(e.x+i.x,this.y,a,d),o=n-this.x,this.width+=o,this.height=d}}checkWidthBounds(t){const e=this._rulerArea.getRight();return this.x+t>e&&(t=e-this.x),t<this._minSize&&(t=this._minSize),t}checkHeightBounds(t){const e=this._rulerArea.getBottom();return this.y+t>e&&(t=e-this.y),t<this._minSize&&(t=this._minSize),t}checkAreaBounds(t,e,i,s){const n=this._rulerArea.getRight(),h=this._rulerArea.getBottom(),o=this.offset,r=this.offset,a=n-i,d=h-s;t<o?this.x=o:t>a?this.x=a:i>=this._minSize&&(this.x=t),e<r?this.y=r:e>d?this.y=d:s>=this._minSize&&(this.y=e)}updateHandlesVisibility(t){this._handles.forEach((e=>e.opacity=t?1:0))}updateHandlesPosition(){const t=this._handles.find((t=>t.isPointerEntered));for(let e=0;e<this._handles.length;e++){const i=this._handles[e];if(!i)return;switch(i.opacity=this.isPointerEntered||t?1:0,e){case 0:i.x=this.x,i.y=this.y;break;case 1:const t=this.getTopRight();i.x=t.x-30,i.y=t.y;break;case 2:const e=this.getBottomRight();i.x=e.x-30,i.y=e.y-30;break;case 3:const s=this.getBottomLeft();i.x=s.x,i.y=s.y-30}}}}class Dt extends c{constructor(t,e){super(),this._propertiesWith=t,this._service=e}onInitialized(){super.onInitialized();const t=this.surface;this.x=t.width-this._propertiesWith,this.width=this._propertiesWith,this.height=t.height}onDraw(t){super.onDraw(t),this.drawBackground(t),this.drawTitle(t),this.drawProperties(t)}drawBackground(t){t.lineWidth=3,t.fillStyle="#222",t.fillRect(this.x,this.y,this.width,this.height),t.strokeStyle="#000",t.strokeRect(this.x,this.y,this.width,this.height)}drawTitle(t){t.fillStyle="#fff",t.strokeStyle="#fff",t.font="42px Material Icons",t.fillText("",this.x+35,this.y+65),t.font="36px Roboto Medium";const e="Properties",i=t.measureText(e),s=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent,n=this.x+95,h=s+24;t.fillText(e,n,h)}drawProperties(t){const e=this._service.selectedElement;if(!e)return;let i=this.y+145;i=this.drawProperty(t,i,"Name",e.name),i=this.drawProperty(t,i,"X",e.x),i=this.drawProperty(t,i,"Y",e.y),i=this.drawProperty(t,i,"Width",e.width),i=this.drawProperty(t,i,"Height",e.height),i=this.drawProperty(t,i,"Rotation X",e.rotationX),this.drawProperty(t,i,"Rotation Y",e.rotationY)}drawProperty(t,e,i,s){const n=this.x+46,h=F(n,e,585,63,5);t.fillStyle="#fff",t.font="normal 100 30px Roboto Medium",t.fillText(i,n,e-20),t.fillStyle="#1a1a1a",t.fill(h),t.fillStyle="#fff",t.font="normal 100 29px Roboto Medium";const o=t.measureText(s.toString()),r=o.fontBoundingBoxAscent+o.fontBoundingBoxDescent;return t.fillText(s,n+19,e+r+8),t.lineWidth=3,t.strokeStyle="#666",t.stroke(h),e+63+76}}class Ot extends c{constructor(t,e,i){super(),this._gridWidth=30,this._lineWidth=3,this._rulerColor="#333",this._rulerBackground="#111",this._rulerWidth=t,this._propertiesWidth=e,this._rulerHighlight=i,this._rulerHighlight.lineWidth=this._lineWidth,this._rulerHighlight.rulerWidth=this._rulerWidth}onInitialized(){super.onInitialized(),this.set(this.surface),this.width-=this._propertiesWidth}onDraw(t){super.onDraw(t),this.drawBackground(t),this.drawVerticalRuler(t),this.drawHorizontalRuler(t),this.drawBorder(t)}drawHorizontalRuler(t){t.fillStyle=this._rulerColor,t.fillRect(this.x,this.y,this.width,this._rulerWidth),t.fillStyle="white",t.strokeStyle="white",t.lineWidth=this._lineWidth+2,t.beginPath(),t.moveTo(this._rulerWidth,this._rulerWidth),t.lineTo(this._rulerWidth-this.getLineLength(0),this._rulerWidth),t.stroke();let e=0,i=this._rulerWidth;for(;i<this.width;)t.lineWidth=this._lineWidth,e%10==0&&(t.fillText((30*e).toString(),i+10,30),t.lineWidth+=2),t.beginPath(),t.moveTo(i,this._rulerWidth),t.lineTo(i,this._rulerWidth-this.getLineLength(e)),t.stroke(),i+=this._gridWidth,e++}drawVerticalRuler(t){t.fillStyle=this._rulerColor,t.fillRect(this.x,this.y,this._rulerWidth,this.height),t.fillStyle="white",t.strokeStyle="white",t.lineWidth=this._lineWidth;let e=0,i=this._rulerWidth;for(;i<this.height;){if(t.lineWidth=this._lineWidth,e%10==0){let s=i+31;Array.from(String(30*e),Number).forEach((e=>{t.fillText(e.toString(),10,s),s+=28})),t.lineWidth+=2}t.beginPath(),t.moveTo(this._rulerWidth,i),t.lineTo(this._rulerWidth-this.getLineLength(e),i),t.stroke(),i+=this._gridWidth,e++}}drawBorder(t){t.strokeStyle="white",t.lineWidth=this._lineWidth,t.beginPath(),t.moveTo(this._rulerWidth,this._rulerWidth),t.lineTo(this.width,this._rulerWidth),t.stroke(),t.moveTo(this._rulerWidth,this._rulerWidth),t.lineTo(this._rulerWidth,this.height),t.stroke()}drawBackground(t){t.font="30px Roboto Medium",t.fillStyle=this._rulerBackground,t.fillRect(this.x,this.y,this.width,this.height),t.strokeStyle="white",t.lineWidth=this._lineWidth,t.globalAlpha=.1;let e=this._rulerWidth;for(;e<this.height;)t.beginPath(),t.moveTo(0,e),t.lineTo(this.width,e),t.stroke(),e+=this._gridWidth;for(e=this._rulerWidth;e<this.width;)t.beginPath(),t.moveTo(e,0),t.lineTo(e,this.height),t.stroke(),e+=this._gridWidth;t.globalAlpha=1}getLineLength(t){const e=this._rulerWidth-15;return t%10==0?e:t%5==0?e-10:e-20}}class Ht extends K{constructor(t){super(),this._centerX=0,this._centerY=0,this.lineWidth=0,this.rulerWidth=0,this._properties=t}onInitialized(){super.onInitialized(),this.set(this.surface),this.receivePointerInput=!0,this.isHitTestVisible=!1,this.x=this.rulerWidth,this.y=this.rulerWidth,this.width-=this.rulerWidth+this._properties.width,this.height-=this.rulerWidth,this.opacity=0}onUpdate(t){super.onUpdate(t)}onPointerHover(t){super.onPointerHover(t),this._centerX=t.x,this._centerY=t.y}onPointerEnter(t){super.onPointerEnter(t),this.opacity=1}onPointerLeave(t){super.onPointerLeave(t),this.opacity=0}onDraw(t){super.onDraw(t),t.globalAlpha=this.opacity,t.fillStyle="white",t.strokeStyle="white",t.lineWidth=this.lineWidth,t.beginPath(),t.moveTo(this.rulerWidth,this._centerY),t.lineTo(this.rulerWidth-20,this._centerY+15),t.lineTo(this.rulerWidth-20,this._centerY-15),t.fill(),t.moveTo(this._centerX,this.rulerWidth),t.lineTo(this._centerX+15,this.rulerWidth-20),t.lineTo(this._centerX-15,this.rulerWidth-20),t.fill(),t.moveTo(this.rulerWidth,this._centerY),t.lineTo(this.width+this.rulerWidth,this._centerY),t.moveTo(this._centerX,this.rulerWidth),t.lineTo(this._centerX,this.height+this.rulerWidth),t.stroke()}}class Yt extends V{constructor(t,e){super(t),this._rulerHighlight=e}onInitialized(){super.onInitialized(),this.add(this._rulerHighlight),this.isLoop=!1}}class Nt extends V{constructor(t,e){super(t),this._properties=e}onInitialized(){super.onInitialized(),this.add(this._properties)}}class Vt extends V{constructor(t,e){super(t),this._ruler=e}onInitialized(){super.onInitialized(),this.add(this._ruler),this.isLoop=!1}}class Ut{constructor(){this.selectedElement=new Mt}}class Kt{constructor(t){this._engine=t;const e=new Y;this._assets=e.create()}startAsync(){return t=this,e=void 0,s=function*(){yield this._assets.loadImagesAsync();const t=new Ut,e=new Dt(670,t),i=new Ht(e),s=new Ot(55,670,i),n=new Wt(s);t.selectedElement=n.elementData,this._engine.add(new Vt(this._assets,s)),this._engine.add(new Nt(this._assets,e)),this._engine.add(new Bt(this._assets,n)),this._engine.add(new Yt(this._assets,i)),this._engine.start()},new((i=void 0)||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class Xt{initializeAsync(t,e){return i=this,s=void 0,h=function*(){const i=k.getEngine(t,e);if(i){const t=new Kt(i);yield t.startAsync()}},new((n=void 0)||(n=Promise))((function(t,e){function o(t){try{a(h.next(t))}catch(t){e(t)}}function r(t){try{a(h.throw(t))}catch(t){e(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,r)}a((h=h.apply(i,s||[])).next())}));var i,s,n,h}}class Ft extends c{constructor(){super(),this.x=140,this.y=170,this.width=800,this.height=800,this._gridWidth=100,this._lineWidth=3}onDraw(t){super.onDraw(t),this.drawBackground(t),this.drawBorder(t),this.drawHorizontalRuler(t),this.drawVerticalRuler(t)}drawBackground(t){t.fillStyle="black",t.globalAlpha=.3,t.fillRect(this.x,this.y,this.width,this.height),t.lineWidth=this._lineWidth,t.font="30px Roboto Medium",t.strokeStyle="white",t.globalAlpha=.1;let e=this.y,i=this.height+this.y;for(;e<=i;)t.beginPath(),t.moveTo(this.x,e),t.lineTo(this.width+this.x,e),t.stroke(),e+=this._gridWidth;for(e=this.x,i=this.width+this.x;e<=i;)t.beginPath(),t.moveTo(e,this.y),t.lineTo(e,this.height+this.y),t.stroke(),e+=this._gridWidth;t.globalAlpha=1}drawBorder(t){t.strokeStyle="white",t.lineWidth=this._lineWidth,t.beginPath(),t.moveTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.stroke(),t.moveTo(this.x,this.y),t.lineTo(this.x,this.y+this.height),t.stroke()}drawHorizontalRuler(t){t.strokeStyle="white",t.fillStyle="white";let e=0,i=this.x;for(;i<=this.x+this.width;)t.lineWidth=this._lineWidth,e%2==0&&(t.fillText((10*e).toString()+" °C",i+15,this.y+this.height+50),t.lineWidth+=2),t.beginPath(),t.moveTo(i,this.y+this.height),t.lineTo(i,this.y+this.height+this.getLineLength(e)),t.stroke(),i+=this._gridWidth,e++}drawVerticalRuler(t){t.fillStyle="white",t.strokeStyle="white";let e=10,i=this.y;for(;i<=this.y+this.height;)t.lineWidth=this._lineWidth,e%2==0&&(t.fillText((10*e).toString()+" %",this.x-80,i-15),t.lineWidth+=2),t.beginPath(),t.moveTo(this.x,i),t.lineTo(this.x-this.getLineLength(e),i),t.stroke(),i+=this._gridWidth,e--}getLineLength(t){return t%2==0?30:-20}}class Gt extends c{constructor(){super(),this.text="",this.fontSize=34,this.fontStyle="Roboto Medium",this.padding=20,this.isVisible=!1}onDraw(t){super.onDraw(t),t.font=`${this.fontSize}px ${this.fontStyle}`;const e=t.measureText(this.text),i=e.width,s=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent;this.width=i+2*this.padding,this.height=s+2*this.padding;const n=F(this.x,this.y,this.width,this.height,5);t.fillStyle="#333",t.fill(n),t.fillStyle="#fff",t.fillText(this.text,this.x+this.padding,this.y+s+this.padding),t.strokeStyle="000",t.lineWidth=3,t.stroke(n)}}class $t extends K{constructor(t,i,s){super(),this._toolTip=i,this._fanService=s,this._step=t,this._halfSize=0,this.width=35,this.height=35,this.maxY=0,this.minY=0,this.color="white",this._circleAngle=2*Math.PI,this._position=new e,this._pressedDiff=new e}onInitialized(){super.onInitialized(),this.receivePointerInput=!0,this.add(this._toolTip)}onUpdate(t){super.onUpdate(t),this._position.x=this.x+.5*this.width,this._position.y=this.y+.5*this.height,this._halfSize=.5*this.width,this._toolTip.x=this.x+60,this._toolTip.y=this.y-60}onDraw(t){super.onDraw(t),t.fillStyle=this.color,t.strokeStyle="black",t.lineWidth=5,t.beginPath(),t.arc(this._position.x,this._position.y,this._halfSize,0,this._circleAngle),t.fill(),t.stroke()}onPointerEnter(t){super.onPointerEnter(t),this.scale=1.2,this._toolTip.isVisible=!0}onPointerLeave(t){super.onPointerLeave(t),this.scale=1,this._toolTip.isVisible=!1}onPointerPressed(t){super.onPointerPressed(t),this.changeCursor("ns-resize"),this._pressedDiff.x=this.x-t.x,this._pressedDiff.y=this.y-t.y}onPointerMove(t){super.onPointerMove(t);const e=t.y+this._pressedDiff.y;e<this.minY?this.y=this.minY:e>this.maxY?this.y=this.maxY:this.y=t.y+this._pressedDiff.y,this.updateStep()}updateStep(){const t=80/(this.maxY-this.minY),e=100-Math.round((this.y-this.minY)*t);this._fanService.setStep(this._step,e),this._toolTip.text=`${e}%`}}class qt extends c{constructor(t,e){super(),this.set(t),this._fanService=e,this._handler=new Array,this._toolTips=new Array;for(let t=0;t<5;t++){const i=e.stepKeys[t],s=new Gt;this._handler.push(new $t(i,s,e)),this._toolTips.push(s)}const i=this._handler[0];this._handleOffset=.5*i.width,this._maxY=this.y+this.height-this._handleOffset,this._minY=this.y-this._handleOffset,this._length=this._maxY-this._minY}onInitialized(){super.onInitialized(),this.add(...this._handler),this.x-=this._handleOffset,this.y-=this._handleOffset,this.width+=2*this._handleOffset,this.height+=2*this._handleOffset;const t=this._length/80*100;for(let e=0;e<this._handler.length;e++){const i=this._handler[e],s=this._fanService.stepKeys[e],n=this._fanService.steps.get(s);i.x=this.x+200*e,i.y=this._minY+t-.01*n*t,i.maxY=this._maxY,i.minY=this._minY,i.updateStep(),2===e&&(i.color="yellow")}this._toolTips.forEach((t=>this.add(t)))}onDraw(t){super.onDraw(t);const e=this._handler[0];let i=e.x+.5*e.width,s=e.y+.5*e.height;t.lineWidth=5,t.strokeStyle="red",t.fillStyle="red",t.beginPath(),t.moveTo(i,s),this._handler.forEach((e=>{i=e.x+.5*e.width,s=e.y+.5*e.height,t.lineTo(i,s)})),t.stroke(),s=this.y+this.height-.5*e.height,t.lineTo(i,s),i=this.x+.5*e.height,t.lineTo(i,s),t.closePath(),t.globalAlpha=.2,t.fill()}}class Zt extends c{constructor(t){super(),this._fanService=t}onInitialized(){var t;super.onInitialized(),this.setImage("fan-wheel.png");const e=null===(t=this._imageSource)||void 0===t?void 0:t.image;e&&(this.width=1.4*e.width,this.height=1.4*e.height,this.x=this.surface.width-(this.width+110),this.y=.5*this.surface.height-.5*this.height+25)}onUpdate(t){super.onUpdate(t),this.rotateTo(t,this._fanService.speed)}}class jt extends c{constructor(t,i){super(),this._fanService=i,this._fanWheel=t,this._fanBackgroundPosition=new e,this._fanBackgroundSize=0,this._circleAngle=2*Math.PI}onInitialized(){super.onInitialized()}onUpdate(t){super.onUpdate(t),this._fanBackgroundPosition.x=this._fanWheel.x+.5*this._fanWheel.width,this._fanBackgroundPosition.y=this._fanWheel.y+.5*this._fanWheel.height,this._fanBackgroundSize=this._fanWheel.width/1.9}onDraw(t){super.onDraw(t),this.drawTorqueBar(t),this.drawTemperatureBar(t),this.drawBackground(t),this.drawText(t)}drawBackground(t){t.fillStyle="#333333",t.strokeStyle="#000000",t.lineWidth=5,t.beginPath(),t.arc(this._fanBackgroundPosition.x,this._fanBackgroundPosition.y,this._fanBackgroundSize,0,this._circleAngle),t.fill(),t.stroke(),t.beginPath(),t.arc(this._fanBackgroundPosition.x,this._fanBackgroundPosition.y,this._fanBackgroundSize/6,0,this._circleAngle),t.fillStyle="black",t.globalAlpha=.5,t.fill(),t.strokeStyle="#666",t.globalAlpha=1,t.stroke()}drawText(t){t.globalAlpha=1,t.fillStyle="white",t.font="34px Roboto Medium";const e=`${this._fanService.temperature} °C`,i=`${this._fanService.torque} rpm`,s=t.measureText(e),n=t.measureText(i),h=s.width,o=n.width,r=s.fontBoundingBoxAscent+s.fontBoundingBoxDescent,a=this._fanWheel.x+this._fanWheel.width-o+50,d=this._fanWheel.y-30;t.fillText(i,a,d);const l=this._fanWheel.x+this._fanWheel.width-h+50,c=this._fanWheel.y+this._fanWheel.height+r-25;t.fillText(e,l,c)}drawTemperatureBar(t){const e=this._fanWheel.x,i=this._fanWheel.y+this._fanWheel.height+65,s=this._fanWheel.width,n=(s-35)*this._fanService.urgency*.01,h=F(e-10,i-10,s+20,60,5);t.fillStyle="black",t.globalAlpha=.3,t.fill(h);const o=t.createLinearGradient(e,i,e+s,i);o.addColorStop(.4,"limegreen"),o.addColorStop(.6,"yellow"),o.addColorStop(.9,"red"),t.globalAlpha=.8,t.fillStyle=o,t.fillRect(e+5,i+5,n-10,30),t.lineWidth=3,t.strokeStyle="#666",t.globalAlpha=1,t.stroke(h)}drawTorqueBar(t){const e=this._fanBackgroundPosition.x,i=this._fanBackgroundPosition.y;let s=this._fanBackgroundSize+60,n=s,h=2*Math.PI/2,o=h+Math.PI/1.44;t.beginPath(),t.moveTo(e,i),t.arc(e,i,n,h,o),t.closePath(),t.fillStyle="black",t.globalAlpha=.3,t.fill(),t.strokeStyle="#666",t.globalAlpha=1,t.lineWidth=3,t.stroke(),t.setLineDash([32.3,15]),s=this._fanBackgroundSize+29,n=s,h=2.025*Math.PI/2;const r=2.1/this._fanService.torqueMax,a=this._fanService.torque*r;t.beginPath(),t.arc(e,i,n,h,h+a);const d=t.createLinearGradient(1100,0,1600,0);d.addColorStop(0,"limegreen"),d.addColorStop(.7,"yellow"),d.addColorStop(1,"red"),t.strokeStyle=d,t.globalAlpha=.8,t.lineWidth=32,t.stroke(),t.setLineDash([])}}class Jt extends c{constructor(t){super(),this._fanCruve=t}onInitialized(){super.onInitialized(),this.set(this.surface),this.add(this._fanCruve)}onDraw(t){super.onDraw(t),t.fillStyle="#1b1b1b",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#333333",t.strokeStyle="#333333",t.lineWidth=10,t.strokeRect(this.x,this.y,this.width,this.height),t.fillStyle="#ffffff",t.font="48px Material Icons",t.fillText("",60,88),t.font="36px Roboto Medium",t.fillText("Fan Curve Settings",130,78)}}class Qt extends V{constructor(t,e){super(t),this._fanCurve=e}onInitialized(){super.onInitialized(),this.add(new Jt(this._fanCurve)),this.isLoop=!1}}class te extends V{constructor(t,e,i){super(t),this._fanCurveArea=e,this._fanWheelArea=i}onInitialized(){super.onInitialized(),this.add(this._fanWheelArea,this._fanCurveArea),this.isLoop=!1}}class ee extends V{constructor(t,e){super(t),this._fanWheel=e}onInitialized(){super.onInitialized(),this.add(this._fanWheel)}}class ie{get speed(){return this._speed}get torque(){return this._torque}get torqueMax(){return this._torqueMax}get temperature(){return this._temperature}get urgency(){return this._urgency}get steps(){return this._steps}get stepKeys(){return this._stepKeys}constructor(){this._speed=2,this._torque=800,this._torqueMax=1500,this._urgency=0,this._temperature=50,this._stepKeys=new Array,this._stepKeys.push(0),this._stepKeys.push(20),this._stepKeys.push(40),this._stepKeys.push(60),this._stepKeys.push(80),this._steps=new Map,this._steps.set(this._stepKeys[0],50),this._steps.set(this._stepKeys[1],50),this._steps.set(this._stepKeys[2],55),this._steps.set(this._stepKeys[3],65),this._steps.set(this._stepKeys[4],90)}setStep(t,e){this.steps.has(t)&&(this._steps.set(t,e),this.update())}update(){const t=this._stepKeys[2],e=this._steps.get(t),i=.01*this._torqueMax;this._speed=.1*e,this._torque=e*i,this._temperature=100-Math.round(.8*e),this._urgency=1.25*this._temperature}}class se{constructor(t){this._engine=t;const e=new Y;this._assets=e.create(),this._assets.addImage("./assets/fan/images/fan-wheel.png")}startAsync(){return t=this,e=void 0,s=function*(){yield this._assets.loadImagesAsync();const t=new ie,e=new Ft,i=new qt(e,t),s=new Zt(t),n=new jt(s,t);this._engine.add(new Qt(this._assets,e)),this._engine.add(new te(this._assets,i,n)),this._engine.add(new ee(this._assets,s)),this._engine.start()},new((i=void 0)||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class ne{initializeAsync(t,e){return i=this,s=void 0,h=function*(){const i=k.getEngine(t,e);if(i){const t=new se(i);yield t.startAsync()}},new((n=void 0)||(n=Promise))((function(t,e){function o(t){try{a(h.next(t))}catch(t){e(t)}}function r(t){try{a(h.throw(t))}catch(t){e(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,r)}a((h=h.apply(i,s||[])).next())}));var i,s,n,h}}var he=function(t,e,i,s){return new(i||(i=Promise))((function(n,h){function o(t){try{a(s.next(t))}catch(t){h(t)}}function r(t){try{a(s.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}))};function oe(t){Array.from(document.getElementsByClassName(t)).forEach((e=>e.classList.remove(t)))}window.addEventListener("load",(()=>he(void 0,void 0,void 0,(function*(){yield function(){return he(this,void 0,void 0,(function*(){const t=new FontFace("Roboto Medium","url(./fonts/roboto-fontface/fonts/roboto/Roboto-Medium.woff)"),e=new FontFace("Material Icons","url(./fonts/material-icons/iconfont/material-icons.woff)"),i=new FontFace("Roboto Medium","url(./fonts/roboto-fontface/fonts/roboto/Roboto-Medium.woff2)"),s=new FontFace("Material Icons","url(./fonts/material-icons/iconfont/material-icons.woff2)");yield Promise.all([t.load(),e.load(),i.load(),s.load()])}))}();const t=new URLSearchParams(window.location.search),e=t.get("games"),i=t.get("apps");null!==e&&oe("first-row-disabled"),null!==i&&oe("second-row-disabled");const s=new Array;null!==e&&s.push(new Promise((()=>he(void 0,void 0,void 0,(function*(){const t=new xt;yield t.initializeAsync("pong",window)})))),new Promise((()=>he(void 0,void 0,void 0,(function*(){(new It).initializeAsync("street",window)}))))),null!==i&&s.push(new Promise((()=>he(void 0,void 0,void 0,(function*(){(new ne).initializeAsync("fan",window)})))),new Promise((()=>he(void 0,void 0,void 0,(function*(){(new Xt).initializeAsync("ruler",window)}))))),yield Promise.all(s)}))))})();